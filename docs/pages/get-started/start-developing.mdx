import React, { useState, useEffect } from 'react';
import { MapPin, Car, Star, X } from 'lucide-react';

// --- Mock Data for Drivers ---
const mockDrivers = [
  { id: 1, name: 'josh lubamba ', car: 'Toyota Prius', rating: 4.8, eta: 5, price: 12.50, avatar: 'https://placehold.co/100x100/E9D5FF/4C1D95?text=JD' },
  { id: 2, name: 'Joel ejiba', car: 'Peugeot 208', rating: 4.9, eta: 3, price: 10.00, avatar: 'https://placehold.co/100x100/A7F3D0/065F46?text=AD' },
  { id: 3, name: 'justice lubiji', car: 'Hyundai Kona', rating: 4.7, eta: 8, price: 15.00, avatar: 'https://placehold.co/100x100/FDE68A/854D0E?text=MT' }
];

// --- Helper Components ---

const DriverCard = ({ driver, onBook }) => (
  <div className="bg-gray-800 p-4 rounded-lg flex items-center space-x-4 transition-transform hover:scale-105 duration-300">
    <img src={driver.avatar} alt={`Avatar de ${driver.name}`} className="w-16 h-16 rounded-full border-2 border-teal-400"/>
    <div className="flex-grow">
      <h3 className="font-bold text-lg text-white">{driver.name}</h3>
      <div className="flex items-center text-sm text-gray-400 mt-1">
        <Car size={16} className="mr-2 text-teal-400" />
        <span>{driver.car}</span>
        <Star size={16} className="ml-4 mr-1 text-yellow-400" />
        <span>{driver.rating}</span>
      </div>
      <p className="text-sm text-gray-300 mt-1">Arrivée dans {driver.eta} minutes</p>
    </div>
    <div className="text-right">
      <p className="text-xl font-bold text-teal-400">{driver.price.toFixed(2)} €</p>
      <button 
        onClick={() => onBook(driver)}
        className="mt-2 bg-teal-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-600 transition-colors duration-300"
      >
        Réserver
      </button>
    </div>
  </div>
);

const BookingModal = ({ driver, onClose }) => {
    if (!driver) return null;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div className="bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center relative animate-fade-in-up">
                <button onClick={onClose} className="absolute top-4 right-4 text-gray-500 hover:text-white">
                    <X size={24} />
                </button>
                <h2 className="text-2xl font-bold text-teal-400 mb-4">Réservation Confirmée !</h2>
                <img src={driver.avatar} alt={`Avatar de ${driver.name}`} className="w-24 h-24 rounded-full border-4 border-teal-400 mx-auto mb-4"/>
                <p className="text-white text-lg">Votre chauffeur, <span className="font-bold">{driver.name}</span>, est en route.</p>
                <p className="text-gray-400 mt-2">Il arrivera dans environ {driver.eta} minutes avec sa {driver.car}.</p>
                 <button 
                    onClick={onClose}
                    className="mt-6 w-full bg-teal-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-600 transition-colors duration-300"
                >
                    Terminé
                </button>
            </div>
        </div>
    );
};


// --- Main App Component ---

export default function App() {
  const [pickup, setPickup] = useState('');
  const [destination, setDestination] = useState('');
  const [drivers, setDrivers] = useState([]);
  const [isSearching, setIsSearching] = useState(false);
  const [selectedDriver, setSelectedDriver] = useState(null);

  // Function to handle the search for drivers
  const handleSearch = (e) => {
    e.preventDefault();
    if (!pickup || !destination) {
        alert("Veuillez entrer un lieu de départ et une destination.");
        return;
    }
    setIsSearching(true);
    setDrivers([]); // Clear previous results
    // Simulate an API call
    setTimeout(() => {
      setDrivers(mockDrivers);
      setIsSearching(false);
    }, 2000);
  };

  // Function to handle booking a driver
  const handleBookDriver = (driver) => {
    console.log("Booking driver:", driver);
    setSelectedDriver(driver);
  };

  // Function to close the confirmation modal
  const handleCloseModal = () => {
    setSelectedDriver(null);
    setPickup('');
    setDestination('');
    setDrivers([]);
  };
  
  // Add CSS for animations
  useEffect(() => {
    const style = document.createElement('style');
    style.innerHTML = `
      @keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in-up {
        animation: fade-in-up 0.5s ease-out forwards;
      }
       @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      .animate-spin-slow {
        animation: spin 2s linear infinite;
      }
    `;
    document.head.appendChild(style);
    return () => {
      document.head.removeChild(style);
    };
  }, []);


  return (
    <div className="bg-gray-900 min-h-screen font-sans text-gray-300">
      <div className="container mx-auto p-4 max-w-4xl">
        
        {/* --- Header --- */}
        <header className="text-center my-8">
          <h1 className="text-5xl font-extrabold text-white tracking-tight">
            Chauffeur <span className="text-teal-400">Privé</span>
          </h1>
          <p className="text-gray-400 mt-2 text-lg">Votre course, en toute simplicité.</p>
        </header>

        <main className="bg-gray-800/50 backdrop-blur-sm p-6 md:p-8 rounded-2xl shadow-2xl border border-gray-700">
          
          {/* --- Booking Form --- */}
          <form onSubmit={handleSearch} className="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
            <div className="relative">
                <label htmlFor="pickup" className="block text-sm font-medium text-gray-300 mb-1">Lieu de départ</label>
                <MapPin className="absolute left-3 top-9 text-gray-500" size={20} />
                <input
                    id="pickup"
                    type="text"
                    value={pickup}
                    onChange={(e) => setPickup(e.target.value)}
                    placeholder="ex: 123 Avenue des Champs-Élysées"
                    className="w-full bg-gray-900 border border-gray-700 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                    required
                />
            </div>
            <div className="relative">
                <label htmlFor="destination" className="block text-sm font-medium text-gray-300 mb-1">Destination</label>
                <MapPin className="absolute left-3 top-9 text-gray-500" size={20} />
                <input
                    id="destination"
                    type="text"
                    value={destination}
                    onChange={(e) => setDestination(e.target.value)}
                    placeholder="ex: Musée du Louvre"
                    className="w-full bg-gray-900 border border-gray-700 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                    required
                />
            </div>
            <div className="md:col-span-2 mt-4">
                 <button 
                    type="submit"
                    className="w-full bg-teal-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-600 transition-all duration-300 ease-in-out shadow-lg hover:shadow-teal-500/50 flex items-center justify-center disabled:bg-gray-600"
                    disabled={isSearching}
                >
                    {isSearching ? (
                        <>
                            <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin-slow mr-3"></div>
                            Recherche en cours...
                        </>
                    ) : 'Rechercher un chauffeur'}
                </button>
            </div>
          </form>

          {/* --- Driver List --- */}
          { (isSearching || drivers.length > 0) && (
              <div className="mt-8">
                <h2 className="text-2xl font-bold text-white mb-4 border-b-2 border-gray-700 pb-2">Chauffeurs disponibles</h2>
                {isSearching ? (
                    <div className="text-center p-8 text-gray-400">
                        <p>Nous recherchons les meilleurs chauffeurs pour vous...</p>
                    </div>
                ) : (
                    <div className="space-y-4">
                        {drivers.map(driver => (
                            <DriverCard key={driver.id} driver={driver} onBook={handleBookDriver} />
                        ))}
                    </div>
                )}
              </div>
          )}

        </main>
        
        {/* --- Footer --- */}
        <footer className="text-center text-gray-600 mt-12 pb-8">
            <p>&copy; {new Date().getFullYear()} Chauffeur Privé. Tous droits réservés.</p>
        </footer>

        {/* --- Booking Confirmation Modal --- */}
        <BookingModal driver={selectedDriver} onClose={handleCloseModal} />

      </div>
    </div>
  );
}
