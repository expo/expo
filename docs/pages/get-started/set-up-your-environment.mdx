import React, { useState, useEffect } from "react";

// BudgetControlApp.jsx // Single-file React component prototype for an AI-aware budget control tool. // Features: // - Create monthly budgets and set alert threshold (percentage or fixed amount) // - Add expenses (choose shop from dropdown). Sample shops provided; replace with your list. // - Persistent storage via localStorage // - Popup alerts when spending approaches a budget limit (Notification API + in-app modal) // - Simple month-to-month rollover control // - English UI

// How to use: // 1) Drop this file into a React project (Create React App, Vite, Next.js page, etc.). // 2) Tailwind classes are used for styling. If Tailwind is not available, the layout still works but looks plain. // 3) Replace sampleShops with the list of shops you will provide.

const sampleShops = ["Shoprite", "Pick n Pay", "Woolworths", "Spar"]; // replace with your shops

function useLocalStorage(key, initial) { const [state, setState] = useState(() => { try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : initial; } catch (e) { return initial; } }); useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch (e) { // ignore } }, [key, state]); return [state, setState]; }

export default function BudgetControlApp() { // budgets structure: [{ id, name, month (YYYY-MM), limit, thresholdPct, spent }] const [budgets, setBudgets] = useLocalStorage("budgets_v1", []); // expenses: [{ id, budgetId, date, shop, amount, note }] const [expenses, setExpenses] = useLocalStorage("expenses_v1", []);

const [selectedBudgetId, setSelectedBudgetId] = useState(budgets[0]?.id || ""); const [showAlertModal, setShowAlertModal] = useState(null); // {budget, remaining, pct}

useEffect(() => { // request notification permission once if (typeof Notification !== "undefined" && Notification.permission === "default") { Notification.requestPermission().catch(() => {}); } }, []);

useEffect(() => { // recalc spent on budgets const updated = budgets.map((b) => { const monthExpenses = expenses.filter((e) => e.budgetId === b.id); const spent = monthExpenses.reduce((s, x) => s + Number(x.amount || 0), 0); return { ...b, spent }; }); setBudgets(updated); // check alerts updated.forEach((b) => { if (!b.limit) return; const remaining = b.limit - (b.spent || 0); const pctRemaining = (remaining / b.limit) * 100; if (b.thresholdPct !== undefined && pctRemaining <= b.thresholdPct) { // trigger popup/notification once per budget per session const key = alerted_${b.id}; if (!sessionStorage.getItem(key)) { sessionStorage.setItem(key, "1"); triggerAlert(b, remaining, Math.round(pctRemaining)); } } }); // eslint-disable-next-line react-hooks/exhaustive-deps }, [expenses]);

function triggerAlert(budget, remaining, pctRemaining) { // in-app modal setShowAlertModal({ budget, remaining, pctRemaining }); // browser notification if (typeof Notification !== "undefined" && Notification.permission === "granted") { try { new Notification("Budget alert", { body: ${budget.name}: ${pctRemaining}% remaining (R${remaining.toFixed(2)}), }); } catch (e) { // ignore } } }

function createBudget({ name, month, limit, thresholdPct }) { const id = ${Date.now()}; const newB = { id, name, month, limit: Number(limit), thresholdPct: Number(thresholdPct), spent: 0 }; setBudgets((prev) => [newB, ...prev]); setSelectedBudgetId(id); }

function addExpense({ budgetId, date, shop, amount, note }) { const id = ${Date.now()}; const exp = { id, budgetId, date, shop, amount: Number(amount), note }; setExpenses((prev) => [exp, ...prev]); }

function deleteExpense(id) { setExpenses((prev) => prev.filter((e) => e.id !== id)); sessionStorage.clear(); // allow alerts to re-fire if needed }

function nextMonth(yyyymm) { const [y, m] = yyyymm.split("-").map(Number); const d = new Date(y, m - 1 + 1, 1); return ${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}; }

// UI small helpers const budgetsByMonth = budgets.reduce((acc, b) => { acc[b.month] = acc[b.month] || []; acc[b.month].push(b); return acc; }, {});

return ( <div className="p-4 max-w-4xl mx-auto font-sans"> <header className="mb-6"> <h1 className="text-2xl font-bold">Budget Control — Prototype</h1> <p className="text-sm text-gray-600">English UI. Popup alerts when budgets approach threshold.</p> </header>

<main className="grid md:grid-cols-2 gap-6">
    <section className="space-y-4">
      <Card>
        <h2 className="text-lg font-semibold">Create monthly budget</h2>
        <BudgetForm onCreate={createBudget} />
      </Card>

      <Card>
        <h2 className="text-lg font-semibold">Add expense</h2>
        <ExpenseForm
          budgets={budgets}
          shops={sampleShops}
          onAdd={(v) => addExpense(v)}
          defaultBudgetId={selectedBudgetId}
        />
      </Card>

      <Card>
        <h2 className="text-lg font-semibold">Recent expenses</h2>
        <ExpenseList expenses={expenses} onDelete={deleteExpense} />
      </Card>
    </section>

    <section className="space-y-4">
      <Card>
        <h2 className="text-lg font-semibold">Budgets overview</h2>
        {budgets.length === 0 ? (
          <p className="text-sm text-gray-500">No budgets yet. Create one to get started.</p>
        ) : (
          <div className="space-y-3">
            {Object.keys(budgetsByMonth)
              .sort((a, b) => b.localeCompare(a))
              .map((month) => (
                <div key={month}>
                  <h3 className="font-medium">{month}</h3>
                  <div className="space-y-2 mt-2">
                    {budgetsByMonth[month].map((b) => (
                      <BudgetCard key={b.id} budget={b} expenses={expenses.filter((e) => e.budgetId === b.id)} />
                    ))}
                  </div>
                </div>
              ))}
          </div>
        )}
      </Card>

      <Card>
        <h2 className="text-lg font-semibold">Month controls</h2>
        <p className="text-sm text-gray-600">Move budgets forward or clear for new month.</p>
        <div className="flex gap-2 mt-3">
          <button
            className="px-3 py-2 rounded bg-gray-100"
            onClick={() => {
              // simple rollover: copy budgets to next month with reset spent
              const uniqueMonths = Array.from(new Set(budgets.map((b) => b.month))).sort();
              if (uniqueMonths.length === 0) return;
              const latest = uniqueMonths[0];
              const next = nextMonth(latest);
              const toCopy = budgets.filter((b) => b.month === latest).map((b) => ({ ...b, id: `${Date.now()}_${Math.random()}`, month: next, spent: 0 }));
              setBudgets((prev) => [...toCopy, ...prev]);
            }}
          >
            Copy latest to next month
          </button>

          <button
            className="px-3 py-2 rounded bg-red-50 text-red-600"
            onClick={() => {
              if (confirm("Clear all budgets and expenses? This cannot be undone in local storage.")) {
                setBudgets([]);
                setExpenses([]);
                sessionStorage.clear();
              }
            }}
          >
            Clear all
          </button>
        </div>
      </Card>
    </section>
  </main>

  {showAlertModal && (
    <Modal onClose={() => setShowAlertModal(null)}>
      <h3 className="text-lg font-semibold">Budget approaching limit</h3>
      <p className="mt-2">Budget: {showAlertModal.budget.name}</p>
      <p>Remaining: R{showAlertModal.remaining.toFixed(2)}</p>
      <p>{showAlertModal.pctRemaining}% remaining</p>
      <div className="mt-4 flex justify-end">
        <button className="px-3 py-1 bg-blue-600 text-white rounded" onClick={() => setShowAlertModal(null)}>
          Dismiss
        </button>
      </div>
    </Modal>
  )}
</div>

); }

function Card({ children }) { return <div className="p-4 bg-white rounded shadow-sm">{children}</div>; }

function BudgetForm({ onCreate }) { const today = new Date(); const defaultMonth = ${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, "0")}; const [name, setName] = useState("Main budget"); const [month, setMonth] = useState(defaultMonth); const [limit, setLimit] = useState(5000); const [thresholdPct, setThresholdPct] = useState(15); // notify when remaining <= 15%

return ( <form onSubmit={(e) => { e.preventDefault(); onCreate({ name, month, limit: Number(limit), thresholdPct: Number(thresholdPct) }); setName("Main budget"); }} className="space-y-3" > <div> <label className="block text-sm">Name</label> <input value={name} onChange={(e) => setName(e.target.value)} className="mt-1 block w-full rounded border p-2" /> </div>

<div>
    <label className="block text-sm">Month (YYYY-MM)</label>
    <input value={month} onChange={(e) => setMonth(e.target.value)} className="mt-1 block w-full rounded border p-2" />
  </div>

  <div>
    <label className="block text-sm">Limit (R)</label>
    <input type="number" value={limit} onChange={(e) => setLimit(e.target.value)} className="mt-1 block w-full rounded border p-2" />
  </div>

  <div>
    <label className="block text-sm">Alert threshold (percentage remaining)</label>
    <input type="number" value={thresholdPct} onChange={(e) => setThresholdPct(e.target.value)} className="mt-1 block w-full rounded border p-2" />
    <p className="text-xs text-gray-500 mt-1">When the budget has this percent or less remaining, a popup will fire.</p>
  </div>

  <div className="pt-2">
    <button className="px-3 py-2 rounded bg-green-600 text-white">Create budget</button>
  </div>
</form>

); }

function ExpenseForm({ budgets, shops, onAdd, defaultBudgetId }) { const [budgetId, setBudgetId] = useState(defaultBudgetId || budgets[0]?.id || ""); const [date, setDate] = useState(new Date().toISOString().slice(0, 10)); const [shop, setShop] = useState(shops[0] || ""); const [amount, setAmount] = useState(0); const [note, setNote] = useState("");

useEffect(() => setBudgetId(defaultBudgetId || budgets[0]?.id || ""), [defaultBudgetId, budgets]);

return ( <form onSubmit={(e) => { e.preventDefault(); if (!budgetId) return alert("Please select a budget."); onAdd({ budgetId, date, shop, amount: Number(amount), note }); setAmount(0); setNote(""); }} className="space-y-2" > <div> <label className="block text-sm">Budget</label> <select value={budgetId} onChange={(e) => setBudgetId(e.target.value)} className="mt-1 block w-full rounded border p-2"> <option value="">-- select budget --</option> {budgets.map((b) => ( <option key={b.id} value={b.id}> {b.name} ({b.month}) </option> ))} </select> </div>

<div>
    <label className="block text-sm">Date</label>
    <input type="date" value={date} onChange={(e) => setDate(e.target.value)} className="mt-1 block w-full rounded border p-2" />
  </div>

  <div>
    <label className="block text-sm">Shop</label>
    <select value={shop} onChange={(e) => setShop(e.target.value)} className="mt-1 block w-full rounded border p-2">
      {shops.map((s) => (
        <option key={s} value={s}>{s}</option>
      ))}
    </select>
    <p className="text-xs text-gray-500 mt-1">Replace the shop list with your specific shops when ready.</p>
  </div>

  <div>
    <label className="block text-sm">Amount (R)</label>
    <input type="number" value={amount} onChange={(e) => setAmount(e.target.value)} className="mt-1 block w-full rounded border p-2" />
  </div>

  <div>
    <label className="block text-sm">Note</label>
    <input value={note} onChange={(e) => setNote(e.target.value)} className="mt-1 block w-full rounded border p-2" />
  </div>

  <div>
    <button className="px-3 py-2 rounded bg-blue-600 text-white">Add expense</button>
  </div>
</form>

); }

function ExpenseList({ expenses, onDelete }) { if (expenses.length === 0) return <p className="text-sm text-gray-500">No expenses yet.</p>; return ( <div className="space-y-2"> {expenses.slice(0, 20).map((e) => ( <div key={e.id} className="flex items-center justify-between border rounded p-2"> <div> <div className="text-sm font-medium">{e.shop} — R{Number(e.amount).toFixed(2)}</div> <div className="text-xs text-gray-500">{e.date} {e.note ? · ${e.note} : ""}</div> </div> <div> <button className="text-red-500 text-sm" onClick={() => onDelete(e.id)}>Delete</button> </div> </div> ))} </div> ); }

function BudgetCard({ budget, expenses }) { const spent = expenses.reduce((s, x) => s + Number(x.amount || 0), 0); const limit = Number(budget.limit || 0); const remaining = limit - spent; const pct = limit ? Math.max(0, Math.round((spent / limit) * 100)) : 0; return ( <div className="border p-3 rounded"> <div className="flex justify-between items-center"> <div> <div className="font-medium">{budget.name}</div> <div className="text-xs text-gray-500">{budget.month}</div> </div> <div className="text-sm font-semibold">R{limit.toFixed(2)}</div> </div>

<div className="mt-3">
    <ProgressBar value={pct} />
    <div className="flex justify-between text-xs mt-2">
      <div>Spent R{spent.toFixed(2)}</div>
      <div>Remaining R{remaining.toFixed(2)}</div>
    </div>
  </div>
</div>

); }

function ProgressBar({ value }) { return ( <div className="w-full bg-gray-100 rounded h-3 overflow-hidden"> <div style={{ width: ${value}% }} className="h-3 rounded bg-blue-500" /> </div> ); }

function Modal({ children, onClose }) { return ( <div className="fixed inset-0 flex items-center justify-center z-50"> <div className="absolute inset-0 bg-black opacity-30" onClick={onClose} /> <div className="relative bg-white rounded p-4 max-w-md w-full shadow-lg">{children}</div> </div> ); }
