import React, { useState } from 'react';
import { Alert, Pressable, SafeAreaView, Text, TextInput, View } from 'react-native';
import * as SMS from 'expo-sms';
import * as Location from 'expo-location';
import * as Haptics from 'expo-haptics';

export default function App() {
  const [numbers, setNumbers] = useState(''); // ex: +33601020304,+33655667788
  const [loading, setLoading] = useState(false);

  async function sendSOS() {
    try {
      if (loading) return;
      setLoading(true);

      await Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);

      const isAvailable = await SMS.isAvailableAsync();
      if (!isAvailable) {
        Alert.alert('SMS indisponible', "Ton t√©l√©phone ne peut pas envoyer de SMS depuis l‚Äôapp.");
        return;
      }

      const { status } = await Location.requestForegroundPermissionsAsync();
      if (status !== 'granted') {
        Alert.alert('Permission refus√©e', 'Autorise la localisation pour envoyer ta position en cas d‚Äôurgence.');
        return;
      }

      const pos = await Location.getCurrentPositionAsync({ accuracy: Location.Accuracy.Balanced });
      const { latitude, longitude } = pos.coords;
      const mapsLink = `https://maps.google.com/?q=${latitude},${longitude}`;

      const message = `üö® SOS ‚Äî j‚Äôai besoin d‚Äôaide !\nMa position: ${mapsLink}\nAppelle le 17 / 112 si je ne r√©ponds pas.`;

      const list = numbers.split(',').map(n => n.trim()).filter(Boolean);
      if (list.length === 0) {
        Alert.alert('Aucun contact', 'Ajoute au moins un num√©ro au format +33‚Ä¶');
        return;
      }

      await SMS.sendSMSAsync(list, message);
    } catch (e) {
      console.error(e);
      Alert.alert('Erreur', e?.message ?? 'Une erreur est survenue');
    } finally {
      setLoading(false);
    }
  }

  return (
    <SafeAreaView style={{ flex: 1, backgroundColor: '#0f172a' }}>
      <View style={{ flex: 1, alignItems: 'center', justifyContent: 'center', padding: 24, gap: 24 }}>
        <Text style={{ color: 'white', fontSize: 20, fontWeight: '600' }}>Vous n‚Äô√™tes pas seul¬∑e</Text>

        <Pressable
          onLongPress={sendSOS}
          delayLongPress={1500}
          style={{
            width: 220, height: 220, borderRadius: 110, alignItems: 'center', justifyContent: 'center',
            backgroundColor: loading ? '#7f1d1d' : '#dc2626',
            shadowColor: '#000', shadowOpacity: 0.25, shadowRadius: 12
          }}
        >
          <Text style={{ color: 'white', fontSize: 28, fontWeight: '800' }}>{loading ? '‚Ä¶' : 'SOS'}</Text>
          <Text style={{ color: 'white', opacity: 0.8, marginTop: 8, fontSize: 12 }}>Maintiens 1,5 s</Text>
        </Pressable>

        <View style={{ width: '100%', gap: 8 }}>
          <Text style={{ color: 'white' }}>Contacts (s√©par√©s par virgules) :</Text>
          <TextInput
            value={numbers}
            onChangeText={setNumbers}
            placeholder="+33601020304, +33655667788"
            placeholderTextColor="#94a3b8"
            autoCapitalize="none"
            keyboardType="phone-pad"
            style={{
              backgroundColor: '#111827', color: 'white', padding: 12, borderRadius: 10,
              borderWidth: 1, borderColor: '#334155'
            }}
          />
        </View>

        <Text style={{ color: '#94a3b8', textAlign: 'center', fontSize: 12 }}>
          ‚ö†Ô∏è En cas de danger imm√©diat, appelle le 17 / 112.  
          Cette app envoie un SMS pr√©rempli √† tes contacts de confiance.
        </Text>
      </View>
    </SafeAreaView>
  );
}  href="/workflow/configuration/"
  Icon={BookOpen02Icon}
/>

## Properties

<AppConfigSchemaTable schema={schema} />
