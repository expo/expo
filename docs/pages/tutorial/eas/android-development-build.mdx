import React, { useState, useEffect } from 'react';
import { View, Text, Button, TextInput, StyleSheet, ScrollView, Alert } from 'react-native';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';

const affirmations = [
  "Hoy elijo crecer, respirar y avanzar con confianza.",
  "Me llena de energía y calma al respirar profundamente.",
  "Cada día es una oportunidad para mejorar mi bienestar."
];

function HomeScreen({ navigation }) {
  const [dailyAffirmation, setDailyAffirmation] = useState('');

  useEffect(() => {
    const dayIndex = new Date().getDate() % affirmations.length;
    setDailyAffirmation(affirmations[dayIndex]);
  }, []);

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Bienvenido, Marcos</Text>
      <Text style={styles.affirmation}>{dailyAffirmation}</Text>
      <Button
        title="Iniciar Respiración Wim Hof"
        onPress={() => navigation.navigate('WimHof')}
      />
      <View style={{ height: 10 }} />
      <Button
        title="Bitácora Personal"
        onPress={() => navigation.navigate('Journal')}
      />
    </View>
  );
}

function WimHofScreen() {
  const [count, setCount] = useState(0);
  const startRound = () => {
    setCount(0);
    const interval = setInterval(() => {
      setCount(c => {
        if (c >= 30) {
          clearInterval(interval);
          Alert.alert('¡Ronda completa!', 'Felicidades por completar 30 respiraciones.');
          return c;
        }
        return c + 1;
      });
    }, 2000);
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Rutina Wim Hof</Text>
      <Text style={styles.count}>{count} / 30</Text>
      <Button title="Iniciar ronda básica" onPress={startRound} />
    </View>
  );
}

function JournalScreen() {
  const [text, setText] = useState('');
  const [entries, setEntries] = useState([]);

  const saveEntry = () => {
    if (!text.trim()) return;
    const today = new Date().toLocaleDateString();
    setEntries([{ date: today, text }, ...entries]);
    setText('');
    Alert.alert('Guardado', 'Entrada de bitácora guardada localmente.');
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.title}>Bitácora Personal</Text>
      <TextInput
        style={styles.input}
        multiline
        placeholder="Escribe cómo te sientes hoy..."
        value={text}
        onChangeText={setText}
      />
      <Button title="Guardar entrada del día" onPress={saveEntry} />
      <View style={{ height: 20 }} />
      {entries.map((e, i) => (
        <View key={i} style={styles.entry}>
          <Text style={styles.entryDate}>{e.date}</Text>
          <Text>{e.text}</Text>
        </View>
      ))}
    </ScrollView>
  );
}

const Stack = createStackNavigator();

export default function App() {
  return (
    <NavigationContainer>
      <Stack.Navigator initialRouteName="Home">
        <Stack.Screen name="Home" component={HomeScreen} />
        <Stack.Screen name="WimHof" component={WimHofScreen} />
        <Stack.Screen name="Journal" component={JournalScreen} />
      </Stack.Navigator>
    </NavigationContainer>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, alignItems: 'center', padding: 20 },
  title: { fontSize: 24, fontWeight: 'bold', marginVertical: 20 },
  affirmation: { fontSize: 18, fontStyle: 'italic', marginBottom: 30, textAlign: 'center' },
  count: { fontSize: 48, marginVertical: 20 },
  input: { width: '100%', height: 100, borderColor: '#ccc', borderWidth: 1, padding: 10, borderRadius: 8 },
  entry: { backgroundColor: '#f2f2f2', padding: 10, marginVertical: 5, width: '100%', borderRadius: 5 },
  entryDate: { fontWeight: 'bold' }
});
