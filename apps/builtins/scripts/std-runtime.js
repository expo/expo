#!/usr/bin/env node
/**
 * Bundle script for the builtins package.
 *
 * This script:
 * 1. Updates the cache-bust comment in index.ts to invalidate Metro's cache
 * 2. Runs the expo export command to create the bytecode bundle
 */
const fs = require('fs');
const path = require('path');

const INDEX_PATH = path.join(__dirname, '../index.js');

const MANIFEST = require('@expo/cli/static/std-runtime.json');

function main() {
  fs.writeFileSync(INDEX_PATH, `
// This file is generated by scripts/std-runtime.js
// @generate-builtins ${MANIFEST.generatedAt}
const EXPOSE = (name, getter) => __expo__d((_, __, ___, ____, module) => {module.exports=getter()}, \`expo:\${name}\`);

${MANIFEST.modules.map((moduleName) =>`EXPOSE(${JSON.stringify(moduleName)}, () => require(${JSON.stringify(moduleName)}));`).join('\n')}
    `);
}

main();
