name: Check Template Bare Minimum Diffs

on:
  workflow_dispatch: {}

concurrency:
  group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  bare-diffs:
    runs-on: ubuntu-24.04
    steps:
      - name: ğŸ‘€ Checkout
        uses: actions/checkout@v4
      - name: â¬¢ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22
      - name: â™»ï¸ Restore caches
        uses: ./.github/actions/expo-caches
        id: expo-caches
        with:
          yarn-docs: 'true'
          yarn-tools: 'true'
      - name: â• Add `bin` to GITHUB_PATH
        run: echo "$(pwd)/bin" >> $GITHUB_PATH
      - name: ğŸ§ Check diffs
        run: |
          echo "Checking that expo-template-bare-minimum diffs are updated"
          bin/expotools generate-bare-diffs --check
      - name: ğŸ”” Notify on Slack
        uses: ./.github/actions/slack-notify
        if: failure() && github.event.ref == 'refs/heads/main'
        with:
          webhook: ${{ secrets.slack_webhook_docs }}
          author_name: Check for Changes in Bare Diffs
      - name: ğŸ’¾ Store artifacts of diff failures
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: template-bare-minimum-bare-diff-failure
          path: docs/public/static/diffs/template-bare-minimum/raw
