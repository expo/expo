{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://expo.dev/schemas/spm.config.json",
    "title": "SPM Config",
    "description": "Configuration for Swift Package Manager packages and targets in Expo modules",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "JSON Schema reference"
        },
        "products": {
            "type": "array",
            "description": "List of SPM products to generate with their targets",
            "items": {
                "$ref": "#/definitions/product"
            }
        }
    },
    "required": [ "products" ],
    "definitions": {
        "productPlatform": {
            "type": "string",
            "description": "Supported platform versions",
            "enum": [
                "iOS(.v15)",
                "macOS(.v11)",
                "tvOS(.v15)",
                "macCatalyst(.v15)",
                "iOS(.v15_1)",
                "tvOS(.v15_1)" ]
        },
        "product": {
            "type": "object",
            "description": "A Swift Package product definition with its targets",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "The name of the product"
                },
                "podName": {
                    "type": "string",
                    "description": "The CocoaPods pod name for this product. Must match the name in the corresponding .podspec file."
                },
                "codegenName": {
                    "type": "string",
                    "description": "The React Native codegen module name (from package.json codegenConfig.name). Only required for packages that use React Native codegen."
                },
                "platforms": {
                    "type": "array",
                    "description": "Supported platforms for this product",
                    "items": {
                        "$ref": "#/definitions/productPlatform"
                    },
                    "default": [ ]
                },
                "externalDependencies": {
                    "type": "array",
                    "description": "List of external Swift Package dependencies for this product (e.g., 'Hermes', 'ReactNativeDependencies', 'React', or expo packages)",
                    "items": {
                        "type": "string"
                    },
                    "default": [ ]
                },
                "swiftLanguageVersions": {
                    "type": "array",
                    "description": "Optional list of Swift language versions supported by this product",
                    "items": {
                        "type": "string"
                    },
                    "default": [ ]
                },
                "textualHeaders": {
                    "type": "array",
                    "description": "Glob patterns for headers that should be marked as 'textual' in the final xcframework modulemap. Textual headers are not compiled as part of the module, which is necessary for headers that have external dependencies (like React headers) that won't be available at module compile time. This allows Swift to import the module without needing those dependencies at compile time.",
                    "items": {
                        "type": "string"
                    },
                    "default": [ ]
                },
                "targets": {
                    "type": "array",
                    "description": "List of targets included in this product",
                    "items": {
                        "$ref": "#/definitions/target"
                    }
                }
            },
            "required": [ "name", "podName", "targets" ],
            "additionalProperties": false
        },
        "target": {
            "oneOf": [
                { "$ref": "#/definitions/frameworkTarget" },
                { "$ref": "#/definitions/objcTarget" },
                { "$ref": "#/definitions/swiftTarget" },
                { "$ref": "#/definitions/cppTarget" }
            ]
        },
        "frameworkTarget": {
            "type": "object",
            "description": "A binary xcframework target",
            "properties": {
                "type": {
                    "const": "framework",
                    "description": "Target type identifier"
                },
                "name": {
                    "type": "string",
                    "description": "The name of the target"
                },
                "path": {
                    "type": "string",
                    "description": "Path to the xcframework relative to package root"
                },
                "includeDirectories": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Header locations within the framework bundle",
                    "default": [ ]
                },
                "headerMapPath": {
                    "type": "string",
                    "description": "Path to a header map file (.hmap) for header resolution"
                },
                "vfsOverlayPath": {
                    "type": "string",
                    "description": "Path to a VFS overlay file (.yaml) for virtual filesystem mapping"
                },
                "linkedFrameworks": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "System frameworks to link",
                    "default": [ ]
                }
            },
            "required": [ "type", "name", "path" ],
            "additionalProperties": false
        },
        "objcTarget": {
            "type": "object",
            "description": "An Objective-C source target",
            "properties": {
                "type": {
                    "const": "objc",
                    "description": "Target type identifier"
                },
                "name": {
                    "type": "string",
                    "description": "The name of the target"
                },
                "moduleName": {
                    "type": "string",
                    "description": "The module name to use when organizing headers in include directory (defaults to product name)"
                },
                "path": {
                    "type": "string",
                    "description": "Path to source files relative to package root"
                },
                "pattern": {
                    "type": "string",
                    "description": "Glob pattern to filter source files within the path"
                },
                "headerPattern": {
                    "type": "string",
                    "description": "Glob pattern to filter header files within the path"
                },
                "dependencies": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Names of other targets this target depends on",
                    "default": [ ]
                },
                "exclude": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Paths to exclude from compilation",
                    "default": [ ]
                },
                "includeDirectories": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Header search paths relative to the target path",
                    "default": [ "include" ]
                },
                "linkedFrameworks": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "System frameworks to link (e.g., 'Foundation', 'UIKit')",
                    "default": [ ]
                },
                "resources": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/resource" },
                    "description": "Resources to bundle with the target (e.g., Metal shaders, assets)",
                    "default": [ ]
                },
                "compilerFlags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Additional compiler flags for C/C++/ObjC (e.g., [\"-include\", \"Foundation/Foundation.h\"])",
                    "default": [ ]
                },
                "debugCompilerFlags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Additional compiler flags applied only for Debug builds (e.g., [\"-DHERMES_ENABLE_DEBUGGER=1\"])",
                    "default": [ ]
                },
                "fileMapping": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/fileMapping" },
                    "description": "File mappings to reorganize files during source generation. Files matching 'from' pattern will be copied to the 'to' location",
                    "default": [ ]
                },
                "moduleMapContent": {
                    "type": "string",
                    "description": "Custom module.modulemap content for this target. If provided, this will be written to the include directory instead of letting Clang auto-generate one. Useful for C++ headers that have conflicting type definitions and need to be marked as 'textual header'"
                },
                "publicHeaders": {
                    "type": "boolean",
                    "description": "Whether to expose headers as public module headers. Set to false to make headers private/internal, which prevents Clang from building a module from them. Default is true.",
                    "default": true
                }
            },
            "required": [ "type", "name", "path" ],
            "additionalProperties": false
        },
        "swiftTarget": {
            "type": "object",
            "description": "A Swift source target",
            "properties": {
                "type": {
                    "const": "swift",
                    "description": "Target type identifier"
                },
                "name": {
                    "type": "string",
                    "description": "The name of the target"
                },
                "moduleName": {
                    "type": "string",
                    "description": "The module name to use when organizing headers in include directory (defaults to product name)"
                },
                "path": {
                    "type": "string",
                    "description": "Path to source files relative to package root"
                },
                "pattern": {
                    "type": "string",
                    "description": "Glob pattern to filter source files within the path"
                },
                "headerPattern": {
                    "type": "string",
                    "description": "Glob pattern to filter header files within the path"
                },
                "dependencies": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Names of other targets this target depends on",
                    "default": [ ]
                },
                "exclude": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Paths to exclude from compilation",
                    "default": [ ]
                },
                "includeDirectories": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Header search paths relative to the target path",
                    "default": [ ]
                },
                "linkedFrameworks": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "System frameworks to link",
                    "default": [ ]
                },
                "resources": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/resource" },
                    "description": "Resources to bundle with the target (e.g., Metal shaders, assets)",
                    "default": [ ]
                },
                "compilerFlags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Additional compiler flags for C/C++/ObjC (e.g., [\"-include\", \"Foundation/Foundation.h\"])",
                    "default": [ ]
                },
                "debugCompilerFlags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Additional compiler flags applied only for Debug builds (e.g., [\"-DHERMES_ENABLE_DEBUGGER=1\"])",
                    "default": [ ]
                },
                "fileMapping": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/fileMapping" },
                    "description": "File mappings to reorganize files during source generation. Files matching 'from' pattern will be copied to the 'to' location",
                    "default": [ ]
                },
                "moduleMapContent": {
                    "type": "string",
                    "description": "Custom module.modulemap content for this target. If provided, this will be written to the include directory instead of letting Clang auto-generate one. Useful for C++ headers that have conflicting type definitions and need to be marked as 'textual header'"
                },
                "publicHeaders": {
                    "type": "boolean",
                    "description": "Whether to expose headers as public module headers. Set to false to make headers private/internal, which prevents Clang from building a module from them. Default is true.",
                    "default": true
                }
            },
            "required": [ "type", "name", "path" ],
            "additionalProperties": false
        },
        "cppTarget": {
            "type": "object",
            "description": "A C++ source target (extends ObjCTarget)",
            "properties": {
                "type": {
                    "const": "cpp",
                    "description": "Target type identifier"
                },
                "name": {
                    "type": "string",
                    "description": "The name of the target"
                },
                "moduleName": {
                    "type": "string",
                    "description": "The module name to use when organizing headers in include directory (defaults to product name)"
                },
                "path": {
                    "type": "string",
                    "description": "Path to source files relative to package root"
                },
                "pattern": {
                    "type": "string",
                    "description": "Glob pattern to filter source files within the path"
                },
                "headerPattern": {
                    "type": "string",
                    "description": "Glob pattern to filter header files within the path"
                },
                "dependencies": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Names of other targets this target depends on",
                    "default": [ ]
                },
                "exclude": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Paths to exclude from compilation",
                    "default": [ ]
                },
                "includeDirectories": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Header search paths relative to the target path",
                    "default": [ "include" ]
                },
                "linkedFrameworks": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "System frameworks to link",
                    "default": [ ]
                },
                "resources": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/resource" },
                    "description": "Resources to bundle with the target (e.g., Metal shaders, assets)",
                    "default": [ ]
                },
                "compilerFlags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Additional compiler flags for C/C++/ObjC (e.g., [\"-include\", \"Foundation/Foundation.h\"])",
                    "default": [ ]
                },
                "debugCompilerFlags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Additional compiler flags applied only for Debug builds (e.g., [\"-DHERMES_ENABLE_DEBUGGER=1\"])",
                    "default": [ ]
                },
                "fileMapping": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/fileMapping" },
                    "description": "File mappings to reorganize files during source generation. Files matching 'from' pattern will be copied to the 'to' location",
                    "default": [ ]
                },
                "moduleMapContent": {
                    "type": "string",
                    "description": "Custom module.modulemap content for this target. If provided, this will be written to the include directory instead of letting Clang auto-generate one. Useful for C++ headers that have conflicting type definitions and need to be marked as 'textual header'"
                },
                "publicHeaders": {
                    "type": "boolean",
                    "description": "Whether to expose headers as public module headers. Set to false to make headers private/internal, which prevents Clang from building a module from them. Default is true.",
                    "default": true
                }
            },
            "required": [ "type", "name", "path" ],
            "additionalProperties": false
        },
        "resource": {
            "type": "object",
            "description": "A resource to include in the target bundle",
            "properties": {
                "path": {
                    "type": "string",
                    "description": "Path or glob pattern to the resource(s) relative to the target path"
                },
                "rule": {
                    "type": "string",
                    "enum": [ "process", "copy" ],
                    "description": "How to handle the resource: 'process' optimizes for platform, 'copy' includes as-is",
                    "default": "process"
                }
            },
            "required": [ "path" ],
            "additionalProperties": false
        },
        "fileMapping": {
            "type": "object",
            "description": "Defines how files from a source location should be copied to a different destination path during source generation",
            "properties": {
                "from": {
                    "type": "string",
                    "description": "Glob pattern to match source files relative to the target path, or source path for symlink type"
                },
                "to": {
                    "type": "string",
                    "description": "Destination path relative to the generated target folder. Use '{filename}' as placeholder for the matched filename"
                },
                "type": {
                    "type": "string",
                    "enum": [ "source", "header", "symlink" ],
                    "description": "Whether this is for header files (placed in include/), source files (placed in target root), or symlink (creates directory symlink in include/)"
                }
            },
            "required": [ "from", "to", "type" ],
            "additionalProperties": false
        }
    }
}
