{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/aes/index.ts"],"names":[],"mappings":"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","sourcesContent":["import AesCryptoModule from './AesModule';\nimport {\n  ArrayBufferDecryptOptions,\n  Base64DecryptOptions,\n  DecryptOptions,\n  EncryptOptions,\n  BinaryInput,\n  SealedDataConfig,\n} from './aes.types';\nimport { uint8ArrayToBase64 } from './web-utils';\n\nexport * from './aes.types';\n\n// Native functions don't yet support all `BinaryInput` formats\nconst nativeFromCombined = AesCryptoModule.SealedData.fromCombined;\nconst nativeFromParts = AesCryptoModule.SealedData.fromParts;\nAesCryptoModule.SealedData.fromCombined = function fromCombined(\n  combined: BinaryInput,\n  config?: SealedDataConfig\n) {\n  const processedInput = convertBinaryInput(combined);\n  return nativeFromCombined(processedInput, config);\n};\nAesCryptoModule.SealedData.fromParts = function fromParts(\n  iv: BinaryInput,\n  ciphertext: BinaryInput,\n  tag?: BinaryInput | number\n) {\n  const processedIV = convertBinaryInput(iv);\n  const processedCiphertext = convertBinaryInput(ciphertext);\n\n  if (!tag || typeof tag === 'number') {\n    return nativeFromParts(processedIV, processedCiphertext, tag as number);\n  } else {\n    const processedTag = convertBinaryInput(tag);\n    return nativeFromParts(processedIV, processedCiphertext, processedTag);\n  }\n};\n\n/**\n * Represents an AES encryption key that can be used for encryption and decryption operations.\n * This class provides methods to generate, import, and export encryption keys.\n */\nexport class EncryptionKey extends AesCryptoModule.EncryptionKey {}\n\n/**\n * Represents encrypted data including the ciphertext, initialization vector, and authentication tag.\n * This class provides methods to create sealed data from various formats and extract its components.\n */\nexport class SealedData extends AesCryptoModule.SealedData {}\n\n/**\n * Encrypts the given plaintext using AES-GCM with the specified key.\n * @param plaintext The data to encrypt. When providing a string, it must be base64-encoded.\n * @param key The encryption key to use.\n * @param options Optional encryption parameters including nonce, tag length, and additional data.\n * @returns A promise that resolves to a SealedData instance containing the encrypted data.\n */\nexport function encryptAsync(\n  plaintext: BinaryInput,\n  key: EncryptionKey,\n  options: EncryptOptions = {}\n): Promise<SealedData> {\n  type NativeEncryptOptions = Omit<EncryptOptions, 'nonce'> & {\n    nonce?: number | BinaryInput | undefined;\n  };\n\n  const { nonce: iv, additionalData: aad, ...rest } = options;\n  let nativeOptions: NativeEncryptOptions = { ...rest };\n  if (iv) {\n    const nonce = 'bytes' in iv ? convertBinaryInput(iv.bytes, true) : iv?.length;\n    nativeOptions = { ...nativeOptions, nonce };\n  }\n  if (aad) {\n    const additionalData = convertBinaryInput(aad, true);\n    nativeOptions = { ...nativeOptions, additionalData };\n  }\n  return AesCryptoModule.encryptAsync(convertBinaryInput(plaintext), key, nativeOptions);\n}\n\n/**\n * Decrypts the given sealed data using the specified key and options.\n * @param sealedData The data to decrypt.\n * @param key The key to use for decryption.\n * @param options Options for decryption, including output encoding and additional data.\n * @returns A promise that resolves to the decrypted data string.\n */\nexport function decryptAsync(\n  sealedData: SealedData,\n  key: EncryptionKey,\n  options: Base64DecryptOptions\n): Promise<string>;\n/**\n * Decrypts the given sealed data using the specified key and options.\n * @param sealedData The data to decrypt.\n * @param key The key to use for decryption.\n * @param options Options for decryption, including output encoding and additional data.\n * @returns A promise that resolves to the decrypted data buffer.\n */\nexport function decryptAsync(\n  sealedData: SealedData,\n  key: EncryptionKey,\n  options?: ArrayBufferDecryptOptions\n): Promise<Uint8Array>;\nexport function decryptAsync(\n  sealedData: SealedData,\n  key: EncryptionKey,\n  options: DecryptOptions = {}\n): Promise<string | Uint8Array> {\n  const { additionalData, ...rest } = options;\n\n  const nativeOptions = {\n    ...rest,\n    additionalData: additionalData ? convertBinaryInput(additionalData, true) : undefined,\n  };\n  return AesCryptoModule.decryptAsync(sealedData, key, nativeOptions);\n}\n\nfunction convertBinaryInput(input: BinaryInput, useBase64: boolean = false): BinaryInput {\n  // Native implementations don't support ArrayBuffers directly yet\n  const bytes = input instanceof ArrayBuffer ? new Uint8Array(input) : input;\n\n  if (typeof bytes !== 'string' && useBase64) {\n    return uint8ArrayToBase64(bytes);\n  }\n  return bytes;\n}\n"]}