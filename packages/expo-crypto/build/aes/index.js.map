{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/aes/index.ts"],"names":[],"mappings":"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","sourcesContent":["import AesCryptoModule from './AesModule';\nimport {\n  ArrayBufferDecryptOptions,\n  Base64DecryptOptions,\n  AESDecryptOptions,\n  AESEncryptOptions,\n  BinaryInput,\n  AESSealedDataConfig,\n} from './aes.types';\nimport { uint8ArrayToBase64 } from './web-utils';\n\nexport * from './aes.types';\n\n/**\n * Represents an AES encryption key that can be used for encryption and decryption operations.\n * This class provides methods to generate, import, and export encryption keys.\n */\nexport class AESEncryptionKey extends AesCryptoModule.EncryptionKey {}\n\n/**\n * Represents encrypted data including the ciphertext, initialization vector, and authentication tag.\n * This class provides methods to create sealed data from various formats and extract its components.\n */\nexport class AESSealedData extends AesCryptoModule.SealedData {\n  /**\n   * Static method. Creates a SealedData instance from separate nonce, ciphertext, and optionally a tag.\n   * @param iv The initialization vector. When providing a string, it must be base64-encoded.\n   * @param ciphertext The encrypted data. Should not include GCM tag. When providing a string, it must be base64-encoded.\n   * @param tag The authentication tag. When providing a string, it must be base64-encoded.\n   * @returns A SealedData object.\n   */\n  static fromParts(iv: BinaryInput, ciphertext: BinaryInput, tag: BinaryInput): AESSealedData;\n  /**\n   * Static method. Creates a SealedData instance from separate nonce, ciphertext, and optionally a tag.\n   * @param iv The initialization vector. When providing a string, it must be base64-encoded.\n   * @param ciphertextWithTag The encrypted data with GCM tag appended. When providing a string, it must be base64-encoded.\n   * @param tagLength Authentication tag length in bytes. Defaults to 16.\n   * @returns A SealedData object.\n   */\n  static fromParts(\n    iv: BinaryInput,\n    ciphertextWithTag: BinaryInput,\n    tagLength?: number\n  ): AESSealedData;\n\n  static fromParts(\n    iv: BinaryInput,\n    ciphertext: BinaryInput,\n    tag?: BinaryInput | number\n  ): AESSealedData {\n    const processedIV = convertBinaryInput(iv);\n    const processedCiphertext = convertBinaryInput(ciphertext);\n\n    if (!tag || typeof tag === 'number') {\n      return AesCryptoModule.SealedData.fromParts(processedIV, processedCiphertext, tag as number);\n    } else {\n      const processedTag = convertBinaryInput(tag);\n      return AesCryptoModule.SealedData.fromParts(processedIV, processedCiphertext, processedTag);\n    }\n  }\n\n  /**\n   * Static method. Creates a SealedData instance from a combined byte array, including the IV, ciphertext, and tag.\n   * @param combined The combined data array. When providing a string, it must be base64-encoded.\n   * @param config Configuration specifying IV and tag lengths.\n   * @returns A SealedData object.\n   */\n  static fromCombined(combined: BinaryInput, config?: AESSealedDataConfig): AESSealedData {\n    const processedInput = convertBinaryInput(combined);\n    return AesCryptoModule.SealedData.fromCombined(processedInput, config);\n  }\n}\n\n/**\n * Encrypts the given plaintext using AES-GCM with the specified key.\n * @param plaintext The data to encrypt. When providing a string, it must be base64-encoded.\n * @param key The encryption key to use.\n * @param options Optional encryption parameters including nonce, tag length, and additional data.\n * @returns A promise that resolves to a SealedData instance containing the encrypted data.\n */\nexport function aesEncryptAsync(\n  plaintext: BinaryInput,\n  key: AESEncryptionKey,\n  options: AESEncryptOptions = {}\n): Promise<AESSealedData> {\n  type NativeEncryptOptions = Omit<AESEncryptOptions, 'nonce'> & {\n    nonce?: number | BinaryInput | undefined;\n  };\n\n  const { nonce: iv, additionalData: aad, ...rest } = options;\n  let nativeOptions: NativeEncryptOptions = { ...rest };\n  if (iv) {\n    const nonce = 'bytes' in iv ? convertBinaryInput(iv.bytes, true) : iv?.length;\n    nativeOptions = { ...nativeOptions, nonce };\n  }\n  if (aad) {\n    const additionalData = convertBinaryInput(aad, true);\n    nativeOptions = { ...nativeOptions, additionalData };\n  }\n  return AesCryptoModule.encryptAsync(convertBinaryInput(plaintext), key, nativeOptions);\n}\n\n/** @hidden */\nexport function aesDecryptAsync(\n  sealedData: AESSealedData,\n  key: AESEncryptionKey,\n  options: Base64DecryptOptions\n): Promise<string>;\n/** @hidden */\nexport function aesDecryptAsync(\n  sealedData: AESSealedData,\n  key: AESEncryptionKey,\n  options?: ArrayBufferDecryptOptions\n): Promise<Uint8Array>;\n/**\n * Decrypts the given sealed data using the specified key and options.\n * @param sealedData The data to decrypt.\n * @param key The key to use for decryption.\n * @param options Options for decryption, including output encoding and additional data.\n * @returns A promise that resolves to the decrypted data buffer or string, depending on encoding option.\n */\nexport function aesDecryptAsync(\n  sealedData: AESSealedData,\n  key: AESEncryptionKey,\n  options?: AESDecryptOptions\n): Promise<string | Uint8Array>;\n\nexport function aesDecryptAsync(\n  sealedData: AESSealedData,\n  key: AESEncryptionKey,\n  options: AESDecryptOptions = {}\n): Promise<string | Uint8Array> {\n  const { additionalData, ...rest } = options;\n\n  const nativeOptions = {\n    ...rest,\n    additionalData: additionalData ? convertBinaryInput(additionalData, true) : undefined,\n  };\n  return AesCryptoModule.decryptAsync(sealedData, key, nativeOptions);\n}\n\nfunction convertBinaryInput(input: BinaryInput, useBase64: boolean = false): BinaryInput {\n  // Native implementations don't support ArrayBuffers directly yet\n  const bytes = input instanceof ArrayBuffer ? new Uint8Array(input) : input;\n\n  if (typeof bytes !== 'string' && useBase64) {\n    return uint8ArrayToBase64(bytes);\n  }\n  return bytes;\n}\n"]}