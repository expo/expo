{"version":3,"file":"BluetoothEventHandler.js","sourceRoot":"","sources":["../src/BluetoothEventHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter, Subscription } from 'expo-core';\n\nimport { Central, NativePeripheral } from './Bluetooth.types';\nimport { BLUETOOTH_EVENT } from './BluetoothConstants';\nimport { getPeripherals } from './BluetoothLocalState';\nimport ExpoBluetooth from './ExpoBluetooth/ExpoBluetooth';\n\nconst eventEmitter = new EventEmitter(ExpoBluetooth);\n\nconst multiEventHandlers: any = {\n  everything: [],\n  centralState: [],\n};\n\nexport function firePeripheralObservers() {\n  for (const subscription of multiEventHandlers.everything) {\n    subscription({ peripherals: getPeripherals() });\n  }\n}\n\nexport function fireSingleEventHandlers(\n  event: string,\n  {\n    central,\n    peripheral,\n    error,\n  }: { central?: Central | null; peripheral?: NativePeripheral | null; error: any }\n) {\n  fireMultiEventHandlers(event, { central, peripheral, error });\n  resetHandlersForKey(event);\n}\n\nexport function fireMultiEventHandlers(\n  event: string,\n  {\n    central,\n    peripheral,\n    error,\n  }: { central?: Central | null; peripheral?: NativePeripheral | null; error: any }\n) {\n  ensureKey(event);\n  for (const callback of multiEventHandlers[event]) {\n    callback({ central, peripheral, error });\n  }\n}\n\nfunction ensureKey(key) {\n  if (!(key in multiEventHandlers)) {\n    multiEventHandlers[key] = [];\n  }\n}\n\nexport async function resetHandlersForKey(key) {\n  ensureKey(key);\n\n  let promises: any[] = [];\n  for (const listener of multiEventHandlers[key]) {\n    if (listener.remove instanceof Function) {\n      promises.push(listener.remove());\n    }\n  }\n  multiEventHandlers[key] = [];\n  return await Promise.all(promises);\n}\n\nexport async function _resetAllHandlers() {\n  for (const key of Object.keys(multiEventHandlers)) {\n    await resetHandlersForKey(key);\n  }\n}\n\nexport function addHandlerForKey(key: string, callback: (updates: any) => void): Subscription {\n  ensureKey(key);\n  multiEventHandlers[key].push(callback);\n\n  return {\n    remove() {\n      const index = multiEventHandlers[key].indexOf(callback);\n      if (index != -1) {\n        multiEventHandlers[key].splice(index, 1);\n      }\n    },\n  };\n}\n\nexport function addHandlerForID(\n  key: string,\n  id: string,\n  callback: (updates: any) => void\n): Subscription {\n  const _key = `${key}_${id}`;\n  ensureKey(_key);\n  multiEventHandlers[_key].push(callback);\n\n  return {\n    remove() {\n      const index = multiEventHandlers[_key].indexOf(callback);\n      if (index != -1) {\n        multiEventHandlers[_key].splice(index, 1);\n      }\n    },\n  };\n}\n\nexport function getHandlersForKey(key) {\n  ensureKey(key);\n  return multiEventHandlers[key];\n}\n\nexport function addListener(listener: (event: any) => void): Subscription {\n  return eventEmitter.addListener(BLUETOOTH_EVENT, listener);\n}\n\nexport function removeAllListeners(): void {\n  eventEmitter.removeAllListeners(BLUETOOTH_EVENT);\n}\n"]}