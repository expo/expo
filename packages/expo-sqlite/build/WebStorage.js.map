{"version":3,"file":"WebStorage.js","sourceRoot":"","sources":["../src/WebStorage.ts"],"names":[],"mappings":"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","sourcesContent":["import { installGlobal as install } from 'expo/internal/install-global';\n\nimport { Storage as KVStorage, type SQLiteStorage } from './Storage';\n\nclass Storage {\n  constructor(private readonly storage: SQLiteStorage) {}\n\n  clear(): void {\n    this.storage.clearSync();\n  }\n\n  getItem(key: string): string | null {\n    return this.storage.getItemSync(key);\n  }\n\n  key(index: number): string | null {\n    return this.storage.getKeyByIndexSync(index);\n  }\n\n  removeItem(key: string): void {\n    this.storage.removeItemSync(key);\n  }\n\n  setItem(key: string, value: string): void {\n    this.storage.setItemSync(key, String(value));\n  }\n\n  get length(): number {\n    return this.storage.getLengthSync();\n  }\n\n  toString(): string {\n    return '[object Storage]';\n  }\n}\n\n/**\n * A Proxy wrapper that allows property accessors to be used on the `WebStorageWrapper` object.\n */\nfunction withPropertyAccessors(obj: Storage): Storage & Record<string, string | undefined> {\n  if (typeof Proxy !== 'function') {\n    return obj as Storage & Record<string, string | undefined>;\n  }\n\n  const builtin = new Set();\n  let proto = obj;\n  while (proto) {\n    Object.getOwnPropertyNames(proto).forEach((name) => builtin.add(name));\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return new Proxy(obj as Storage & Record<string, string | undefined>, {\n    get(target, prop, receiver) {\n      if (typeof prop !== 'string' || builtin.has(prop)) {\n        return Reflect.get(target, prop, receiver);\n      }\n      // Values are always converted to strings so getItem returns null only when there is no value\n      const value = target.getItem(prop);\n      return value === null ? undefined : value;\n    },\n    set(target, prop, value, receiver) {\n      if (typeof prop !== 'string' || builtin.has(prop)) {\n        return Reflect.set(target, prop, value, receiver);\n      }\n      target.setItem(prop, String(value));\n      return true;\n    },\n    deleteProperty(target, prop) {\n      if (typeof prop !== 'string' || Reflect.ownKeys(target).includes(prop)) {\n        return Reflect.deleteProperty(target, prop);\n      }\n      target.removeItem(prop);\n      return true;\n    },\n    has(target, prop) {\n      if (typeof prop !== 'string' || builtin.has(prop)) {\n        return Reflect.has(target, prop);\n      }\n      return target.getItem(prop) !== null;\n    },\n  });\n}\n\n/**\n * The default instance of the [`SQLiteStorage`](#sqlitestorage-1) class is used as a drop-in implementation for the [`localStorage`](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) object from the Web.\n */\nexport const localStorage = withPropertyAccessors(new Storage(KVStorage));\n\n/**\n * Install the `localStorage` on the `globalThis` object.\n */\nexport function installGlobal() {\n  install('localStorage', () => localStorage);\n}\n"]}