{"version":3,"file":"SQLiteStatement.js","sourceRoot":"","sources":["../../src/next/SQLiteStatement.ts"],"names":[],"mappings":"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","sourcesContent":["import { NativeDatabase } from './NativeDatabase';\nimport {\n  SQLiteBindParams,\n  SQLiteBindValue,\n  NativeStatement,\n  SQLiteVariadicBindParams,\n  type SQLiteAnyDatabase,\n  type SQLiteRunResult,\n  SQLiteColumnValues,\n} from './NativeStatement';\nimport { composeRow, composeRows, normalizeParams } from './paramUtils';\n\nexport { SQLiteBindParams, SQLiteBindValue, SQLiteRunResult, SQLiteVariadicBindParams };\n\n/**\n * A prepared statement returned by [`SQLiteDatabase.prepareAsync()`](#prepareasyncsource) or [`SQLiteDatabase.prepareSync()`](#preparesyncsource) that can be binded with parameters and executed.\n */\nexport class SQLiteStatement {\n  constructor(\n    private readonly nativeDatabase: NativeDatabase,\n    private readonly nativeStatement: NativeStatement\n  ) {}\n\n  //#region Asynchronous API\n\n  /**\n   * Run the prepared statement and return the [`SQLiteExecuteAsyncResult`](#sqliteexecuteasyncresult) instance.\n   * @param params The parameters to bind to the prepared statement. You can pass values in array, object, or variadic arguments. See [`SQLiteBindValue`](#sqlitebindvalue) for more information about binding values.\n   */\n  public executeAsync<T>(params: SQLiteBindParams): Promise<SQLiteExecuteAsyncResult<T>>;\n  /**\n   * @hidden\n   */\n  public executeAsync<T>(...params: SQLiteVariadicBindParams): Promise<SQLiteExecuteAsyncResult<T>>;\n  public async executeAsync<T>(...params: unknown[]): Promise<SQLiteExecuteAsyncResult<T>> {\n    const { lastInsertRowId, changes, firstRowValues } = await this.nativeStatement.runAsync(\n      this.nativeDatabase,\n      ...normalizeParams(...params)\n    );\n    return createSQLiteExecuteAsyncResult<T>(\n      this.nativeDatabase,\n      this.nativeStatement,\n      lastInsertRowId,\n      changes,\n      firstRowValues\n    );\n  }\n\n  /**\n   * Get the column names of the prepared statement.\n   */\n  public getColumnNamesAsync(): Promise<string[]> {\n    return this.nativeStatement.getColumnNamesAsync();\n  }\n\n  /**\n   * Reset the prepared statement cursor. This will call the [`sqlite3_reset()`](https://www.sqlite.org/c3ref/reset.html) C function under the hood.\n   */\n  public async resetAsync(): Promise<void> {\n    await this.nativeStatement.resetAsync(this.nativeDatabase);\n  }\n\n  /**\n   * Finalize the prepared statement.\n   * > **Note:** Remember to finalize the prepared statement whenever you call `prepareAsync()` to avoid resource leaks.\n   */\n  public async finalizeAsync(): Promise<void> {\n    await this.nativeStatement.finalizeAsync(this.nativeDatabase);\n  }\n\n  //#endregion\n\n  //#region Synchronous API\n\n  /**\n   * Run the prepared statement and return the [`SQLiteExecuteSyncResult`](#sqliteexecutesyncresult) instance.\n   * > **Note:** Running heavy tasks with this function can block the JavaScript thread and affect performance.\n   * @param params The parameters to bind to the prepared statement. You can pass values in array, object, or variadic arguments. See [`SQLiteBindValue`](#sqlitebindvalue) for more information about binding values.\n   */\n  public executeSync<T>(params: SQLiteBindParams): SQLiteExecuteSyncResult<T>;\n  /**\n   * @hidden\n   */\n  public executeSync<T>(...params: SQLiteVariadicBindParams): SQLiteExecuteSyncResult<T>;\n  public executeSync<T>(...params: unknown[]): SQLiteExecuteSyncResult<T> {\n    const { lastInsertRowId, changes, firstRowValues } = this.nativeStatement.runSync(\n      this.nativeDatabase,\n      ...normalizeParams(...params)\n    );\n    return createSQLiteExecuteSyncResult<T>(\n      this.nativeDatabase,\n      this.nativeStatement,\n      lastInsertRowId,\n      changes,\n      firstRowValues\n    );\n  }\n\n  /**\n   * Get the column names of the prepared statement.\n   */\n  public getColumnNamesSync(): string[] {\n    return this.nativeStatement.getColumnNamesSync();\n  }\n\n  /**\n   * Reset the prepared statement cursor. This will call the [`sqlite3_reset()`](https://www.sqlite.org/c3ref/reset.html) C function under the hood.\n   */\n  public resetSync(): void {\n    this.nativeStatement.resetSync(this.nativeDatabase);\n  }\n\n  /**\n   * Finalize the prepared statement.\n   *\n   * > **Note:** Remember to finalize the prepared statement whenever you call `prepareSync()` to avoid resource leaks.\n   *\n   */\n  public finalizeSync(): void {\n    this.nativeStatement.finalizeSync(this.nativeDatabase);\n  }\n\n  //#endregion\n}\n\n/**\n * A result returned by [`SQLiteStatement.executeAsync()`](#executeasyncparams).\n *\n * @example\n * The result includes the [`lastInsertRowId`](https://www.sqlite.org/c3ref/last_insert_rowid.html) and [`changes`](https://www.sqlite.org/c3ref/changes.html) properties. You can get the information from the write operations.\n * ```ts\n * const statement = await db.prepareAsync('INSERT INTO Tests (value) VALUES (?)');\n * const result = await statement.executeAsync(101);\n * console.log('lastInsertRowId:', result.lastInsertRowId);\n * console.log('changes:', result.changes);\n * ```\n *\n * @example\n * The result implements the [`AsyncIterator`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/asyncIterator) interface, so you can use it in `for await...of` loops.\n * ```ts\n * const statement = await db.prepareAsync('SELECT value FROM Tests WHERE value > ?');\n * const result = await statement.executeAsync<{ value: number }>(100);\n * for await (const row of result) {\n *   console.log('row value:', row.value);\n * }\n * ```\n *\n * @example\n * If your write operations also return values, you can mix all of them together.\n * ```ts\n * const statement = await db.prepareAsync('INSERT INTO Tests (name, value) VALUES (?, ?) RETURNING name');\n * const result = await statement.executeAsync<{ name: string }>('John Doe', 101);\n * console.log('lastInsertRowId:', result.lastInsertRowId);\n * console.log('changes:', result.changes);\n * for await (const row of result) {\n *   console.log('name:', row.name);\n * }\n * ```\n */\nexport interface SQLiteExecuteAsyncResult<T> extends AsyncIterableIterator<T> {\n  /**\n   * The last inserted row ID. Returned from the [`sqlite3_last_insert_rowid()`](https://www.sqlite.org/c3ref/last_insert_rowid.html) function.\n   */\n  readonly lastInsertRowId: number;\n\n  /**\n   * The number of rows affected. Returned from the [`sqlite3_changes()`](https://www.sqlite.org/c3ref/changes.html) function.\n   */\n  readonly changes: number;\n\n  /**\n   * Get the first row of the result set.\n   */\n  getFirstAsync(): Promise<T | null>;\n\n  /**\n   * Get all rows of the result set.\n   */\n  getAllAsync(): Promise<T[]>;\n}\n\n/**\n * A result returned by [`SQLiteStatement.executeSync()`](#executesyncparams).\n * > **Note:** Running heavy tasks with this function can block the JavaScript thread and affect performance.\n\n * @example\n * The result includes the [`lastInsertRowId`](https://www.sqlite.org/c3ref/last_insert_rowid.html) and [`changes`](https://www.sqlite.org/c3ref/changes.html) properties. You can get the information from the write operations.\n * ```ts\n * const statement = db.prepareSync('INSERT INTO Tests (value) VALUES (?)');\n * const result = statement.executeSync(101);\n * console.log('lastInsertRowId:', result.lastInsertRowId);\n * console.log('changes:', result.changes);\n * ```\n *\n * @example\n * The result implements the [`Iterator`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Iterator) interface, so you can use it in `for...of` loops.\n * ```ts\n * const statement = db.prepareSync('SELECT value FROM Tests WHERE value > ?');\n * const result = statement.executeSync<{ value: number }>(100);\n * for (const row of result) {\n *   console.log('row value:', row.value);\n * }\n * ```\n *\n * @example\n * If your write operations also return values, you can mix all of them together.\n * ```ts\n * const statement = db.prepareSync('INSERT INTO Tests (name, value) VALUES (?, ?) RETURNING name');\n * const result = statement.executeSync<{ name: string }>('John Doe', 101);\n * console.log('lastInsertRowId:', result.lastInsertRowId);\n * console.log('changes:', result.changes);\n * for (const row of result) {\n *   console.log('name:', row.name);\n * }\n * ```\n */\nexport interface SQLiteExecuteSyncResult<T> extends IterableIterator<T> {\n  /**\n   * The last inserted row ID. Returned from the [`sqlite3_last_insert_rowid()`](https://www.sqlite.org/c3ref/last_insert_rowid.html) function.\n   */\n  readonly lastInsertRowId: number;\n\n  /**\n   * The number of rows affected. Returned from the [`sqlite3_changes()`](https://www.sqlite.org/c3ref/changes.html) function.\n   */\n  readonly changes: number;\n\n  /**\n   * Get the first row of the result set.\n   */\n  getFirstSync(): T | null;\n\n  /**\n   * Get all rows of the result set.\n   */\n  getAllSync(): T[];\n}\n\n//#region Internals for SQLiteExecuteAsyncResult and SQLiteExecuteSyncResult\n\n/**\n * Create the `SQLiteExecuteAsyncResult` instance.\n *\n * NOTE: Since Hermes does not support the `Symbol.asyncIterator` feature, we have to use an AsyncGenerator to implement the `AsyncIterableIterator` interface.\n * This is done by `Object.defineProperties` to add the properties to the AsyncGenerator.\n */\nasync function createSQLiteExecuteAsyncResult<T>(\n  database: SQLiteAnyDatabase,\n  statement: NativeStatement,\n  lastInsertRowId: number,\n  changes: number,\n  firstRowValues: SQLiteColumnValues | null\n): Promise<SQLiteExecuteAsyncResult<T>> {\n  const instance = new SQLiteExecuteAsyncResultImpl<T>(\n    database,\n    statement,\n    lastInsertRowId,\n    changes,\n    firstRowValues\n  );\n  const generator = instance.generatorAsync();\n  Object.defineProperties(generator, {\n    lastInsertRowId: { value: lastInsertRowId, enumerable: true, writable: false },\n    changes: { value: changes, enumerable: true, writable: false },\n    getFirstAsync: {\n      value: instance.getFirstAsync.bind(instance),\n      enumerable: true,\n      writable: false,\n      configurable: false,\n    },\n    getAllAsync: {\n      value: instance.getAllAsync.bind(instance),\n      enumerable: true,\n      writable: false,\n      configurable: false,\n    },\n  });\n\n  return generator as SQLiteExecuteAsyncResult<T>;\n}\n\n/**\n * Create the `SQLiteExecuteSyncResult` instance.\n */\nfunction createSQLiteExecuteSyncResult<T>(\n  database: SQLiteAnyDatabase,\n  statement: NativeStatement,\n  lastInsertRowId: number,\n  changes: number,\n  firstRowValues: SQLiteColumnValues | null\n): SQLiteExecuteSyncResult<T> {\n  const instance = new SQLiteExecuteSyncResultImpl<T>(\n    database,\n    statement,\n    lastInsertRowId,\n    changes,\n    firstRowValues\n  );\n  const generator = instance.generatorSync();\n  Object.defineProperties(generator, {\n    lastInsertRowId: { value: lastInsertRowId, enumerable: true, writable: false },\n    changes: { value: changes, enumerable: true, writable: false },\n    getFirstSync: {\n      value: instance.getFirstSync.bind(instance),\n      enumerable: true,\n      writable: false,\n      configurable: false,\n    },\n    getAllSync: {\n      value: instance.getAllSync.bind(instance),\n      enumerable: true,\n      writable: false,\n      configurable: false,\n    },\n  });\n\n  return generator as SQLiteExecuteSyncResult<T>;\n}\n\nclass SQLiteExecuteAsyncResultImpl<T> {\n  private columnNames: string[] | null = null;\n\n  constructor(\n    private readonly database: SQLiteAnyDatabase,\n    private readonly statement: NativeStatement,\n    public readonly lastInsertRowId: number,\n    public readonly changes: number,\n    private firstRowValues: SQLiteColumnValues | null\n  ) {}\n\n  async getFirstAsync(): Promise<T | null> {\n    const columnNames = await this.getColumnNamesAsync();\n    const firstRowValues = this.popFirstRowValues();\n    if (firstRowValues != null) {\n      return composeRow<T>(columnNames, firstRowValues);\n    }\n    const firstRow = await this.statement.stepAsync(this.database);\n    return firstRow != null ? composeRow<T>(columnNames, firstRow) : null;\n  }\n\n  async getAllAsync(): Promise<T[]> {\n    const columnNames = await this.getColumnNamesAsync();\n    const allRows = await this.statement.getAllAsync(this.database);\n    const firstRowValues = this.popFirstRowValues();\n    if (firstRowValues != null && firstRowValues.length > 0) {\n      return composeRows<T>(columnNames, [firstRowValues, ...allRows]);\n    }\n    return composeRows<T>(columnNames, allRows);\n  }\n\n  async *generatorAsync(): AsyncIterableIterator<T> {\n    const columnNames = await this.getColumnNamesAsync();\n    const firstRowValues = this.popFirstRowValues();\n    if (firstRowValues != null) {\n      yield composeRow<T>(columnNames, firstRowValues);\n    }\n\n    let result;\n    do {\n      result = await this.statement.stepAsync(this.database);\n      if (result != null) {\n        yield composeRow<T>(columnNames, result);\n      }\n    } while (result != null);\n  }\n\n  private popFirstRowValues(): SQLiteColumnValues | null {\n    if (this.firstRowValues != null) {\n      const firstRowValues = this.firstRowValues;\n      this.firstRowValues = null;\n      return firstRowValues.length > 0 ? firstRowValues : null;\n    }\n    return null;\n  }\n\n  private async getColumnNamesAsync(): Promise<string[]> {\n    if (this.columnNames == null) {\n      this.columnNames = await this.statement.getColumnNamesAsync();\n    }\n    return this.columnNames;\n  }\n}\n\nclass SQLiteExecuteSyncResultImpl<T> {\n  private columnNames: string[] | null = null;\n\n  constructor(\n    private readonly database: SQLiteAnyDatabase,\n    private readonly statement: NativeStatement,\n    public readonly lastInsertRowId: number,\n    public readonly changes: number,\n    private firstRowValues: SQLiteColumnValues | null\n  ) {}\n\n  getFirstSync(): T | null {\n    const columnNames = this.getColumnNamesSync();\n    const firstRowValues = this.popFirstRowValues();\n    if (firstRowValues != null) {\n      return composeRow<T>(columnNames, firstRowValues);\n    }\n    const firstRow = this.statement.stepSync(this.database);\n    return firstRow != null ? composeRow<T>(columnNames, firstRow) : null;\n  }\n\n  getAllSync(): T[] {\n    const columnNames = this.getColumnNamesSync();\n    const allRows = this.statement.getAllSync(this.database);\n    const firstRowValues = this.popFirstRowValues();\n    if (firstRowValues != null && firstRowValues.length > 0) {\n      return composeRows<T>(columnNames, [firstRowValues, ...allRows]);\n    }\n    return composeRows<T>(columnNames, allRows);\n  }\n\n  *generatorSync(): IterableIterator<T> {\n    const columnNames = this.getColumnNamesSync();\n    const firstRowValues = this.popFirstRowValues();\n    if (firstRowValues != null) {\n      yield composeRow<T>(columnNames, firstRowValues);\n    }\n    let result;\n    do {\n      result = this.statement.stepSync(this.database);\n      if (result != null) {\n        yield composeRow<T>(columnNames, result);\n      }\n    } while (result != null);\n  }\n\n  private popFirstRowValues(): SQLiteColumnValues | null {\n    if (this.firstRowValues != null) {\n      const firstRowValues = this.firstRowValues;\n      this.firstRowValues = null;\n      return firstRowValues.length > 0 ? firstRowValues : null;\n    }\n    return null;\n  }\n\n  private getColumnNamesSync(): string[] {\n    if (this.columnNames == null) {\n      this.columnNames = this.statement.getColumnNamesSync();\n    }\n    return this.columnNames;\n  }\n}\n\n//#endregion\n"]}