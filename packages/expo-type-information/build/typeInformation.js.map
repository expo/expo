{"version":3,"file":"typeInformation.js","sourceRoot":"","sources":["../src/typeInformation.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from 'fs';\nimport * as os from 'os';\nimport * as path from 'path';\n\nimport {\n  getSwiftFileTypeInformation,\n  preprocessSwiftFile,\n} from './swift/sourcekittenTypeInformation';\n\nexport enum IdentifierKind {\n  BASIC,\n  ENUM,\n  RECORD,\n  CLASS,\n}\n\nexport type ParametrizedType = {\n  name: TypeIdentifier;\n  types: Type[];\n};\n\nexport type Argument = { name: string | undefined; type: Type };\nexport type Field = Argument;\n\nexport type RecordType = {\n  name: string;\n  fields: Field[];\n};\n\nexport type EnumCase = string;\n\nexport type EnumType = {\n  name: string;\n  cases: EnumCase[];\n};\n\nexport type SumType = {\n  types: Type[];\n};\n\nexport type DictionaryType = {\n  key: Type;\n  value: Type;\n};\n\nexport type OptionalType = Type;\nexport type ArrayType = Type;\nexport type TypeIdentifier = string;\nexport type AnonymousType = ParametrizedType | SumType | OptionalType | DictionaryType | ArrayType;\n\nexport enum TypeKind {\n  BASIC,\n  IDENTIFIER,\n  SUM,\n  PARAMETRIZED,\n  OPTIONAL,\n  ARRAY,\n  DICTIONARY,\n}\n\nexport enum BasicType {\n  ANY,\n  STRING,\n  NUMBER,\n  BOOLEAN,\n  VOID,\n  UNDEFINED,\n  UNRESOLVED,\n}\n\nexport type Type = {\n  kind: TypeKind;\n  type: BasicType | TypeIdentifier | AnonymousType;\n};\n\nexport type PropertyDeclaration = ConstantDeclaration;\nexport type ViewDeclaration = ModuleClassDeclaration;\nexport type EventDeclaration = string;\n\nexport type ConstantDeclaration = {\n  name: string;\n  type: Type;\n};\n\nexport type FunctionDeclaration = {\n  name: string;\n  returnType: Type;\n  arguments: Argument[];\n  parameters: Type[];\n};\n\nexport type PropDeclaration = {\n  name: string;\n  arguments: Argument[];\n};\n\nexport type ConstructorDeclaration = {\n  arguments: Argument[];\n};\n\nexport type ClassDeclaration = {\n  name: string;\n  constructor: ConstructorDeclaration | null;\n  methods: FunctionDeclaration[];\n  asyncMethods: FunctionDeclaration[];\n  properties: PropertyDeclaration[];\n};\n\nexport type ModuleClassDeclaration = {\n  name: string;\n  constructor: ConstructorDeclaration | null;\n  constants: ConstantDeclaration[];\n  classes: ClassDeclaration[];\n  functions: FunctionDeclaration[];\n  asyncFunctions: FunctionDeclaration[];\n  properties: PropertyDeclaration[];\n  props: PropDeclaration[];\n  views: ViewDeclaration[];\n  events: EventDeclaration[];\n};\n\nexport type TypeIdentifierDefinitionMap = Map<\n  string,\n  { kind: IdentifierKind; definition: string | RecordType | EnumType | ClassDeclaration }\n>;\n\nexport type TypeIdentifierDefinitionList = [\n  string,\n  { kind: IdentifierKind; definition: string | RecordType | EnumType | ClassDeclaration },\n][];\n\nexport type FileTypeInformationSerialized = {\n  usedTypeIdentifiersList: string[];\n  declaredTypeIdentifiersList: string[];\n  typeParametersCountList: [string, number][];\n  typeIdentifierDefinitionList: TypeIdentifierDefinitionList;\n  moduleClasses: ModuleClassDeclaration[];\n  records: RecordType[];\n  enums: EnumType[];\n};\n\nexport type FileTypeInformation = {\n  usedTypeIdentifiers: Set<string>;\n  declaredTypeIdentifiers: Set<string>;\n  typeParametersCount: Map<string, number>;\n  typeIdentifierDefinitionMap: TypeIdentifierDefinitionMap;\n  moduleClasses: ModuleClassDeclaration[];\n  records: RecordType[];\n  enums: EnumType[];\n};\n\nexport function serializeTypeInformation({\n  usedTypeIdentifiers,\n  declaredTypeIdentifiers,\n  typeParametersCount,\n  typeIdentifierDefinitionMap,\n  moduleClasses,\n  records,\n  enums,\n}: FileTypeInformation): FileTypeInformationSerialized {\n  return {\n    usedTypeIdentifiersList: [...usedTypeIdentifiers.keys()].sort(),\n    declaredTypeIdentifiersList: [...declaredTypeIdentifiers.keys()].sort(),\n    typeParametersCountList: [...typeParametersCount.entries()].sort(),\n    typeIdentifierDefinitionList: [...typeIdentifierDefinitionMap.entries()].sort(),\n    moduleClasses,\n    records,\n    enums,\n  };\n}\n\nexport function deserializeTypeInformation({\n  usedTypeIdentifiersList,\n  declaredTypeIdentifiersList,\n  typeParametersCountList,\n  typeIdentifierDefinitionList,\n  moduleClasses,\n  records,\n  enums,\n}: FileTypeInformationSerialized): FileTypeInformation {\n  return {\n    usedTypeIdentifiers: new Set<string>(usedTypeIdentifiersList),\n    declaredTypeIdentifiers: new Set<string>(declaredTypeIdentifiersList),\n    typeParametersCount: new Map<string, number>(typeParametersCountList),\n    typeIdentifierDefinitionMap: new Map(typeIdentifierDefinitionList),\n    moduleClasses,\n    records,\n    enums,\n  };\n}\n\nexport function getFileTypeInformation(\n  absoluteFilePath: string,\n  preprocessFile: boolean = false\n): FileTypeInformation | null {\n  if (absoluteFilePath.endsWith('.swift')) {\n    if (preprocessFile) {\n      return getFileTypeInformationForString(fs.readFileSync(absoluteFilePath, 'utf-8'), 'swift');\n    }\n    return getSwiftFileTypeInformation(absoluteFilePath);\n  }\n  return null;\n}\n\nexport function getFileTypeInformationForString(\n  content: string,\n  language: 'swift'\n): FileTypeInformation | null {\n  if (language === 'swift') {\n    const tmp = os.tmpdir();\n    const filePath = path.resolve(tmp, 'TypeInformationTemporaryFile.swift');\n    const preprocessedContent = preprocessSwiftFile(content);\n    fs.writeFileSync(filePath, preprocessedContent, 'utf8');\n    const fileTypeInfo = getFileTypeInformation(filePath);\n    fs.rmSync(filePath);\n    return fileTypeInfo;\n  }\n  return null;\n}\n"]}