{"version":3,"file":"MainActivity.js","sourceRoot":"","sources":["../../src/android/MainActivity.ts"],"names":[],"mappings":"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","sourcesContent":["import { projectConfig } from '@react-native-community/cli-platform-android';\nimport fs from 'fs-extra';\nimport path from 'path';\n\nimport StateManager from '../StateManager';\nimport { ResizeMode } from '../constants';\nimport { insert, replace } from '../string-helpers';\n\n/**\n * Injects specific code to MainActivity that would trigger SplashScreen mounting process.\n */\nexport default async function configureMainActivity(\n  projectRootPath: string,\n  resizeMode: ResizeMode\n) {\n  // eslint-disable-next-line\n  const mainApplicationPath = projectConfig(projectRootPath)?.mainFilePath;\n\n  if (!mainApplicationPath) {\n    throw new Error(`Failed to configure 'MainActivity'.`);\n  }\n\n  const mainActivityPathJava = path.resolve(mainApplicationPath, '../MainActivity.java');\n  const mainActivityPathKotlin = path.resolve(mainApplicationPath, '../MainActivity.kt');\n\n  const isJava = await fs.pathExists(mainActivityPathJava);\n  const isKotlin = !isJava && (await fs.pathExists(mainActivityPathKotlin));\n\n  if (!isJava && !isKotlin) {\n    throw new Error(`Failed to find 'MainActivity' file.`);\n  }\n\n  const fileContent = await fs.readFile(\n    isJava ? mainActivityPathJava : mainActivityPathKotlin,\n    'utf-8'\n  );\n  const { state: newFileContent } = new StateManager<string, boolean>(fileContent)\n    // importing SplashScreen\n    .applyAction(content => {\n      const [succeeded, newContent] = replace(content, {\n        replacePattern: /^import expo\\.modules\\.splashscreen\\.SplashScreen.*?\\nimport expo\\.modules\\.splashscreen\\.SplashScreenImageResizeMode.*?$/m,\n        replaceContent: `import expo.modules.splashscreen.SplashScreen${isJava ? ';' : ''}\nimport expo.modules.splashscreen.SplashScreenImageResizeMode${isJava ? ';' : ''}`,\n      });\n      return [newContent, 'replacedSplashImports', succeeded];\n    })\n    .applyAction((content, { replacedSplashImports }) => {\n      if (replacedSplashImports) {\n        return [content, 'insertedSplashImports', false];\n      }\n      const [succeeded, newContent] = insert(content, {\n        insertPattern: isJava ? /(?=public class .* extends .* {.*$)/m : /(?=class .* : .* {.*$)/m,\n        insertContent: `import expo.modules.splashscreen.SplashScreen${isJava ? ';' : ''}\nimport expo.modules.splashscreen.SplashScreenImageResizeMode${isJava ? ';' : ''}\n\n`,\n      });\n      return [newContent, 'insertedSplashImports', succeeded];\n    })\n    // importing ReactRootView\n    .applyAction(content => {\n      const [succeeded, newContent] = replace(content, {\n        replacePattern: /^import com\\.facebook\\.react\\.ReactRootView.*?$/m,\n        replaceContent: `import com.facebook.react.ReactRootView${isJava ? ';' : ''}`,\n      });\n      return [newContent, 'replacedReactImport', succeeded];\n    })\n    .applyAction((content, { replacedReactImport }) => {\n      if (replacedReactImport) {\n        return [content, 'insertedReactImport', false];\n      }\n      const [succeeded, newContent] = insert(content, {\n        insertPattern: /(?<=import com\\.facebook\\.react\\.ReactActivity.*?$)/m,\n        insertContent: `\\nimport com.facebook.react.ReactRootView${isJava ? ';' : ''}`,\n      });\n      return [newContent, 'insertedReactImport', succeeded];\n    })\n    // registering SplashScreen in onCreate()\n    .applyAction(content => {\n      const [succeeded, newContent] = replace(content, {\n        replacePattern: /(?<=super\\.onCreate(.|\\n)*?)SplashScreen\\.show\\(this, SplashScreenImageResizeMode\\..*\\).*$/m,\n        replaceContent: `SplashScreen.show(this, SplashScreenImageResizeMode.${resizeMode.toUpperCase()}, ${\n          isJava ? 'ReactRootView.class);' : 'ReactRootView::class.java)'\n        }`,\n      });\n      return [newContent, 'replacedInOnCreate', succeeded];\n    })\n    .applyAction((content, { replacedInOnCreate }) => {\n      if (replacedInOnCreate) {\n        return [content, 'insertedInOnCreate', false];\n      }\n      const [succeeded, newContent] = insert(content, {\n        insertPattern: /(?<=^.*super\\.onCreate.*$)/m, // insert just below super.onCreate\n        insertContent: `\n    // SplashScreen.show(...) has to be called after super.onCreate(...)\n    // Below line is handled by 'expo-splash-screen' command and it's discouraged to modify it manually\n    SplashScreen.show(this, SplashScreenImageResizeMode.${resizeMode.toUpperCase()}, ${\n          isJava ? 'ReactRootView.class);' : 'ReactRootView::class.java)'\n        }`,\n      });\n      return [newContent, 'insertedInOnCreate', succeeded];\n    })\n    // inserting basic onCreate()\n    .applyAction((content, { replacedInOnCreate, insertedInOnCreate }) => {\n      if (replacedInOnCreate || insertedInOnCreate) {\n        return [content, 'insertedOnCreate', false];\n      }\n      const [succeeded, newContent] = insert(content, {\n        insertPattern: isJava\n          ? /(?<=public class .* extends .* {.*$)/m\n          : /(?<=class .* : .* {.*$)/m,\n        insertContent: `\n  ${\n    isJava\n      ? `@Override\n  protected void onCreate(Bundle savedInstanceState`\n      : 'override fun onCreate(savedInstanceState: Bundle?'\n  }) {\n    super.onCreate(savedInstanceState)${isJava ? ';' : ''}\n    // SplashScreen.show(...) has to be called after super.onCreate(...)\n    // Below line is handled by 'expo-splash-screen' command and it's discouraged to modify it manually\n    SplashScreen.show(this, SplashScreenImageResizeMode.${resizeMode.toUpperCase()}, ${\n          isJava ? 'ReactRootView.class);' : 'ReactRootView::class.java)'\n        }\n  }\n`,\n      });\n      return [newContent, 'insertedOnCreate', succeeded];\n    })\n    // importing Bundle\n    .applyAction((content, { replacedInOnCreate, insertedInOnCreate }) => {\n      if (replacedInOnCreate || insertedInOnCreate) {\n        return [content, 'replacedBundleImport', false];\n      }\n      const [succeeded, newContent] = replace(content, {\n        replacePattern: /import android\\.os\\.Bundle/m,\n        replaceContent: 'import android.os.Bundle',\n      });\n      return [newContent, 'replacedBundleImport', succeeded];\n    })\n    .applyAction((content, { replacedInOnCreate, insertedInOnCreate }) => {\n      if (replacedInOnCreate || insertedInOnCreate) {\n        return [content, 'insertedBundleImport', false];\n      }\n      const [succeeded, newContent] = insert(content, {\n        insertPattern: /(?<=(^.*?package .*?$))/m,\n        insertContent: `\\n\\nimport android.os.Bundle${isJava ? ';' : ''}`,\n      });\n      return [newContent, 'insertedBundleImport', succeeded];\n    });\n\n  await fs.writeFile(isJava ? mainActivityPathJava : mainActivityPathKotlin, newFileContent);\n}\n"]}