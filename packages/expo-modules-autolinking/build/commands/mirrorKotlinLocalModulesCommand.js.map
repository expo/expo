{"version":3,"file":"mirrorKotlinLocalModulesCommand.js","sourceRoot":"","sources":["../../src/commands/mirrorKotlinLocalModulesCommand.ts"],"names":[],"mappings":";;;;;AAaA,0EAgCC;AA5CD,4CAAoB;AACpB,gDAAwB;AAExB,6DAAgG;AAChG,6EAG6C;AAK7C,SAAgB,+BAA+B,CAAC,GAA8B;IAC5E,OAAO,IAAA,iDAA4B,EACjC,GAAG,CAAC,OAAO,CACT,yGAAyG,CAC1G,CACF,CAAC,MAAM,CACN,KAAK,EACH,0BAAkC,EAClC,oBAA4B,EAC5B,qBAA6B,EAC7B,EAAE;QACF,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC;QACtD,IAAI,CAAC,0BAA0B,IAAI,CAAC,oBAAoB,EAAE,CAAC;YACzD,MAAM,IAAI,KAAK,CAAC,sEAAsE,CAAC,CAAC;QAC1F,CAAC;QACD,IACE,CAAC,WAAW,CAAC,IAAI,CAAC,0BAA0B,CAAC;YAC7C,CAAC,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC,EACvC,CAAC;YACD,MAAM,IAAI,KAAK,CAAC,sDAAsD,CAAC,CAAC;QAC1E,CAAC;QACD,IAAI,CAAC,cAAI,CAAC,UAAU,CAAC,0BAA0B,CAAC,IAAI,CAAC,cAAI,CAAC,UAAU,CAAC,oBAAoB,CAAC,EAAE,CAAC;YAC3F,MAAM,IAAI,KAAK,CACb,wGAAwG,CACzG,CAAC;QACJ,CAAC;QAED,YAAE,CAAC,MAAM,CAAC,0BAA0B,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;QACxE,MAAM,IAAA,iDAA2B,EAAC,0BAA0B,EAAE,WAAW,CAAC,CAAC;QAC3E,MAAM,IAAA,kDAA4B,EAAC,oBAAoB,EAAE,WAAW,CAAC,CAAC;IACxE,CAAC,CACF,CAAC;AACJ,CAAC","sourcesContent":["import commander from 'commander';\nimport fs from 'fs';\nimport path from 'path';\n\nimport { AutolinkingCommonArguments, registerAutolinkingArguments } from './autolinkingOptions';\nimport {\n  createSymlinksToKotlinFiles,\n  generateLocalModulesListFile,\n} from '../localModules/androidLocalModules';\ninterface ResolveArguments extends AutolinkingCommonArguments {\n  json?: boolean | null;\n}\n\nexport function mirrorKotlinLocalModulesCommand(cli: commander.CommanderStatic) {\n  return registerAutolinkingArguments(\n    cli.command(\n      'mirror-kotlin-local-modules <kotlinFilesMirrorDirectory> <localModulesListPath> <watchedDirsSerialized>'\n    )\n  ).action(\n    async (\n      kotlinFilesMirrorDirectory: string,\n      localModulesListPath: string,\n      watchedDirsSerialized: string\n    ) => {\n      const watchedDirs = JSON.parse(watchedDirsSerialized);\n      if (!kotlinFilesMirrorDirectory || !localModulesListPath) {\n        throw new Error('Need to provide kotlinFilesMirrorDirectory and localModulesListPath!');\n      }\n      if (\n        !/.android./.test(kotlinFilesMirrorDirectory) ||\n        !/.android./.test(localModulesListPath)\n      ) {\n        throw new Error('Generation path is not inside any android directory!');\n      }\n      if (!path.isAbsolute(kotlinFilesMirrorDirectory) || !path.isAbsolute(localModulesListPath)) {\n        throw new Error(\n          'Need to provide the absolute path to both the local modules src mirror and generated mirror directory!'\n        );\n      }\n\n      fs.rmSync(kotlinFilesMirrorDirectory, { recursive: true, force: true });\n      await createSymlinksToKotlinFiles(kotlinFilesMirrorDirectory, watchedDirs);\n      await generateLocalModulesListFile(localModulesListPath, watchedDirs);\n    }\n  );\n}\n"]}