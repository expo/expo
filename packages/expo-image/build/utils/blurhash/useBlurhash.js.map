{"version":3,"file":"useBlurhash.js","sourceRoot":"","sources":["../../../src/utils/blurhash/useBlurhash.tsx"],"names":[],"mappings":"AAAA,gFAAgF;AAChF,oFAAoF;AACpF,qDAAqD;AAErD,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAE5C,OAAO,MAAM,MAAM,UAAU,CAAC;AAE9B,MAAM,UAAU,WAAW,CACzB,QAAmC,EACnC,QAAgB,EAAE,EAClB,SAAiB,EAAE,EACnB,QAAgB,CAAC;IAEjB,KAAK,GAAG,KAAK,IAAI,CAAC,CAAC;IAEnB,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,GAAG,QAAQ,CAAgB,IAAI,CAAC,CAAC;IAEpD,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,UAAU,GAAG,KAAK,CAAC;QAEvB,IAAI,CAAC,QAAQ;YAAE,OAAO;QAEtB,MAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;QAEtD,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;QACrB,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;QACvB,MAAM,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACxC,MAAM,SAAS,GAAG,OAAQ,CAAC,eAAe,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QAC1D,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC3B,OAAQ,CAAC,YAAY,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACvC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE;YACrB,IAAI,CAAC,UAAU,EAAE;gBACf,MAAM,CAAC,CAAC,MAAM,EAAE,EAAE;oBAChB,IAAI,MAAM,EAAE;wBACV,GAAG,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;qBAC7B;oBACD,OAAO,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;gBACnD,CAAC,CAAC,CAAC;aACJ;QACH,CAAC,CAAC,CAAC;QAEH,OAAO,SAAS,eAAe;YAC7B,UAAU,GAAG,IAAI,CAAC;YAClB,MAAM,CAAC,CAAC,MAAM,EAAE,EAAE;gBAChB,IAAI,MAAM,EAAE;oBACV,GAAG,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;iBAC7B;gBACD,OAAO,IAAI,CAAC;YACd,CAAC,CAAC,CAAC;QACL,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;IAErC,OAAO,GAAG,CAAC;AACb,CAAC","sourcesContent":["// adapted from https://gist.github.com/ngbrown/d62eb518753378eb0a9bf02bb4723235\n// modified from https://gist.github.com/WorldMaker/a3cbe0059acd827edee568198376b95a\n// https://github.com/woltapp/react-blurhash/issues/3\n\nimport { useEffect, useState } from 'react';\n\nimport decode from './decode';\n\nexport function useBlurhash(\n  blurhash: string | undefined | null,\n  width: number = 32,\n  height: number = 32,\n  punch: number = 1\n) {\n  punch = punch || 1;\n\n  const [url, setUrl] = useState<string | null>(null);\n\n  useEffect(() => {\n    let isCanceled = false;\n\n    if (!blurhash) return;\n\n    const pixels = decode(blurhash, width, height, punch);\n\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const context = canvas.getContext('2d');\n    const imageData = context!.createImageData(width, height);\n    imageData.data.set(pixels);\n    context!.putImageData(imageData, 0, 0);\n    canvas.toBlob((blob) => {\n      if (!isCanceled) {\n        setUrl((oldUrl) => {\n          if (oldUrl) {\n            URL.revokeObjectURL(oldUrl);\n          }\n          return blob ? URL.createObjectURL(blob) : oldUrl;\n        });\n      }\n    });\n\n    return function cleanupBlurhash() {\n      isCanceled = true;\n      setUrl((oldUrl) => {\n        if (oldUrl) {\n          URL.revokeObjectURL(oldUrl);\n        }\n        return null;\n      });\n    };\n  }, [blurhash, height, width, punch]);\n\n  return url;\n}\n"]}