{"version":3,"names":["_NativeEventEmitter","_interopRequireDefault","require","_Platform","_NativeWebSocketModule","_base64Js","originalRCTWebSocketConnect","NativeWebSocketModule","connect","originalRCTWebSocketSend","send","originalRCTWebSocketSendBinary","sendBinary","originalRCTWebSocketClose","close","eventEmitter","subscriptions","closeCallback","sendCallback","connectCallback","onOpenCallback","onMessageCallback","onErrorCallback","onCloseCallback","isInterceptorEnabled","WebSocketInterceptor","setCloseCallback","callback","setSendCallback","setConnectCallback","setOnOpenCallback","setOnMessageCallback","setOnErrorCallback","setOnCloseCallback","_unregisterEvents","forEach","e","remove","_registerEvents","addListener","ev","id","type","_arrayBufferToString","data","code","reason","message","enableInterception","NativeEventEmitter","Platform","OS","url","protocols","options","socketId","apply","arguments","length","value","base64","toByteArray","buffer","undefined","ArrayBuffer","Uint8Array","String","Array","from","disableInterception","module","exports"],"sources":["WebSocketInterceptor.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n */\n\nimport NativeEventEmitter from '../EventEmitter/NativeEventEmitter';\nimport Platform from '../Utilities/Platform';\nimport NativeWebSocketModule from './NativeWebSocketModule';\nimport base64 from 'base64-js';\n\nconst originalRCTWebSocketConnect = NativeWebSocketModule.connect;\nconst originalRCTWebSocketSend = NativeWebSocketModule.send;\nconst originalRCTWebSocketSendBinary = NativeWebSocketModule.sendBinary;\nconst originalRCTWebSocketClose = NativeWebSocketModule.close;\n\nlet eventEmitter;\nlet subscriptions;\n\nlet closeCallback;\nlet sendCallback;\nlet connectCallback;\nlet onOpenCallback;\nlet onMessageCallback;\nlet onErrorCallback;\nlet onCloseCallback;\n\nlet isInterceptorEnabled = false;\n\n/**\n * A network interceptor which monkey-patches RCTWebSocketModule methods\n * to gather all websocket network requests/responses, in order to show\n * their information in the React Native inspector development tool.\n */\n\nconst WebSocketInterceptor = {\n  /**\n   * Invoked when RCTWebSocketModule.close(...) is called.\n   */\n  setCloseCallback(callback) {\n    closeCallback = callback;\n  },\n\n  /**\n   * Invoked when RCTWebSocketModule.send(...) or sendBinary(...) is called.\n   */\n  setSendCallback(callback) {\n    sendCallback = callback;\n  },\n\n  /**\n   * Invoked when RCTWebSocketModule.connect(...) is called.\n   */\n  setConnectCallback(callback) {\n    connectCallback = callback;\n  },\n\n  /**\n   * Invoked when event \"websocketOpen\" happens.\n   */\n  setOnOpenCallback(callback) {\n    onOpenCallback = callback;\n  },\n\n  /**\n   * Invoked when event \"websocketMessage\" happens.\n   */\n  setOnMessageCallback(callback) {\n    onMessageCallback = callback;\n  },\n\n  /**\n   * Invoked when event \"websocketFailed\" happens.\n   */\n  setOnErrorCallback(callback) {\n    onErrorCallback = callback;\n  },\n\n  /**\n   * Invoked when event \"websocketClosed\" happens.\n   */\n  setOnCloseCallback(callback) {\n    onCloseCallback = callback;\n  },\n\n  isInterceptorEnabled() {\n    return isInterceptorEnabled;\n  },\n\n  _unregisterEvents() {\n    subscriptions.forEach(e => e.remove());\n    subscriptions = [];\n  },\n\n  /**\n   * Add listeners to the RCTWebSocketModule events to intercept them.\n   */\n  _registerEvents() {\n    subscriptions = [\n      eventEmitter.addListener('websocketMessage', ev => {\n        if (onMessageCallback) {\n          onMessageCallback(\n            ev.id,\n            ev.type === 'binary'\n              ? WebSocketInterceptor._arrayBufferToString(ev.data)\n              : ev.data,\n          );\n        }\n      }),\n      eventEmitter.addListener('websocketOpen', ev => {\n        if (onOpenCallback) {\n          onOpenCallback(ev.id);\n        }\n      }),\n      eventEmitter.addListener('websocketClosed', ev => {\n        if (onCloseCallback) {\n          onCloseCallback(ev.id, {code: ev.code, reason: ev.reason});\n        }\n      }),\n      eventEmitter.addListener('websocketFailed', ev => {\n        if (onErrorCallback) {\n          onErrorCallback(ev.id, {message: ev.message});\n        }\n      }),\n    ];\n  },\n\n  enableInterception() {\n    if (isInterceptorEnabled) {\n      return;\n    }\n    eventEmitter = new NativeEventEmitter(\n      // T88715063: NativeEventEmitter only used this parameter on iOS. Now it uses it on all platforms, so this code was modified automatically to preserve its behavior\n      // If you want to use the native module on other platforms, please remove this condition and test its behavior\n      Platform.OS !== 'ios' ? null : NativeWebSocketModule,\n    );\n    WebSocketInterceptor._registerEvents();\n\n    // Override `connect` method for all RCTWebSocketModule requests\n    // to intercept the request url, protocols, options and socketId,\n    // then pass them through the `connectCallback`.\n    NativeWebSocketModule.connect = function (\n      url,\n      protocols,\n      options,\n      socketId,\n    ) {\n      if (connectCallback) {\n        connectCallback(url, protocols, options, socketId);\n      }\n      originalRCTWebSocketConnect.apply(this, arguments);\n    };\n\n    // Override `send` method for all RCTWebSocketModule requests to intercept\n    // the data sent, then pass them through the `sendCallback`.\n    NativeWebSocketModule.send = function (data, socketId) {\n      if (sendCallback) {\n        sendCallback(data, socketId);\n      }\n      originalRCTWebSocketSend.apply(this, arguments);\n    };\n\n    // Override `sendBinary` method for all RCTWebSocketModule requests to\n    // intercept the data sent, then pass them through the `sendCallback`.\n    NativeWebSocketModule.sendBinary = function (data, socketId) {\n      if (sendCallback) {\n        sendCallback(WebSocketInterceptor._arrayBufferToString(data), socketId);\n      }\n      originalRCTWebSocketSendBinary.apply(this, arguments);\n    };\n\n    // Override `close` method for all RCTWebSocketModule requests to intercept\n    // the close information, then pass them through the `closeCallback`.\n    NativeWebSocketModule.close = function () {\n      if (closeCallback) {\n        if (arguments.length === 3) {\n          closeCallback(arguments[0], arguments[1], arguments[2]);\n        } else {\n          closeCallback(null, null, arguments[0]);\n        }\n      }\n      originalRCTWebSocketClose.apply(this, arguments);\n    };\n\n    isInterceptorEnabled = true;\n  },\n\n  _arrayBufferToString(data) {\n    const value = base64.toByteArray(data).buffer;\n    if (value === undefined || value === null) {\n      return '(no value)';\n    }\n    if (\n      typeof ArrayBuffer !== 'undefined' &&\n      typeof Uint8Array !== 'undefined' &&\n      value instanceof ArrayBuffer\n    ) {\n      return `ArrayBuffer {${String(Array.from(new Uint8Array(value)))}}`;\n    }\n    return value;\n  },\n\n  // Unpatch RCTWebSocketModule methods and remove the callbacks.\n  disableInterception() {\n    if (!isInterceptorEnabled) {\n      return;\n    }\n    isInterceptorEnabled = false;\n    NativeWebSocketModule.send = originalRCTWebSocketSend;\n    NativeWebSocketModule.sendBinary = originalRCTWebSocketSendBinary;\n    NativeWebSocketModule.close = originalRCTWebSocketClose;\n    NativeWebSocketModule.connect = originalRCTWebSocketConnect;\n\n    connectCallback = null;\n    closeCallback = null;\n    sendCallback = null;\n    onOpenCallback = null;\n    onMessageCallback = null;\n    onCloseCallback = null;\n    onErrorCallback = null;\n\n    WebSocketInterceptor._unregisterEvents();\n  },\n};\n\nmodule.exports = WebSocketInterceptor;\n"],"mappings":"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"}