{"version":3,"file":"css-modules.js","names":["RNW_CSS_CLASS_ID","transformCssModuleWeb","props","transform","cssResults","filename","code","Buffer","from","src","sourceMap","options","cssModules","dashedIdents","projectRoot","minify","codeAsString","toString","styles","variables","convertLightningCssToReactNativeWebStyleSheet","exports","outputModule","JSON","stringify","dev","runtimeCss","wrapDevelopmentCSS","output","css","map","input","Object","entries","key","value","className","name","composes","length","join","startsWith","$$css","matchCssModule","filePath","test"],"sources":["../../src/transform-worker/css-modules.ts"],"sourcesContent":["import { wrapDevelopmentCSS } from './css';\n\nconst RNW_CSS_CLASS_ID = '_';\n\nexport async function transformCssModuleWeb(props: {\n  filename: string;\n  src: string;\n  options: { projectRoot: string; minify: boolean; dev: boolean; sourceMap: boolean };\n}) {\n  const { transform } = await import('lightningcss');\n\n  // TODO: Add bundling to resolve imports\n  // https://lightningcss.dev/bundling.html#bundling-order\n\n  const cssResults = transform({\n    filename: props.filename,\n    code: Buffer.from(props.src),\n    sourceMap: props.options.sourceMap,\n    cssModules: {\n      // Prevent renaming CSS variables to ensure\n      // variables created in global files are available.\n      dashedIdents: false,\n    },\n    // cssModules: true,\n    projectRoot: props.options.projectRoot,\n    minify: props.options.minify,\n  });\n  const codeAsString = cssResults.code.toString();\n\n  const { styles, variables } = convertLightningCssToReactNativeWebStyleSheet(cssResults.exports!);\n\n  let outputModule = `module.exports=Object.assign(${JSON.stringify(styles)},${JSON.stringify(\n    variables\n  )});`;\n\n  if (props.options.dev) {\n    const runtimeCss = wrapDevelopmentCSS({\n      ...props,\n      src: codeAsString,\n    });\n\n    outputModule += '\\n' + runtimeCss;\n  }\n\n  return {\n    output: outputModule,\n    css: cssResults.code,\n    map: cssResults.map,\n  };\n}\n\nexport function convertLightningCssToReactNativeWebStyleSheet(\n  input: import('lightningcss').CSSModuleExports\n) {\n  const styles: Record<string, any> = {};\n  const variables: Record<string, string> = {};\n  // e.g. { container: { name: 'ahs8IW_container', composes: [], isReferenced: false }, }\n  Object.entries(input).map(([key, value]) => {\n    // order matters here\n    let className = value.name;\n\n    if (value.composes.length) {\n      className += ' ' + value.composes.map((value) => value.name).join(' ');\n    }\n\n    // CSS Variables will be `{string: string}`\n    if (key.startsWith('--')) {\n      variables[key] = className;\n    }\n\n    styles[key] = { $$css: true, [RNW_CSS_CLASS_ID]: className };\n    return {\n      [key]: { $$css: true, [RNW_CSS_CLASS_ID]: className },\n    };\n  });\n\n  return { styles, variables };\n}\n\nexport function matchCssModule(filePath: string): boolean {\n  return !!/\\.module(\\.(native|ios|android|web))?\\.css$/.test(filePath);\n}\n"],"mappings":";;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA2C;AAAA;AAE3C,MAAMA,gBAAgB,GAAG,GAAG;AAErB,eAAeC,qBAAqB,CAACC,KAI3C,EAAE;EACD,MAAM;IAAEC;EAAU,CAAC,GAAG,mEAAa,cAAc,GAAC;;EAElD;EACA;;EAEA,MAAMC,UAAU,GAAGD,SAAS,CAAC;IAC3BE,QAAQ,EAAEH,KAAK,CAACG,QAAQ;IACxBC,IAAI,EAAEC,MAAM,CAACC,IAAI,CAACN,KAAK,CAACO,GAAG,CAAC;IAC5BC,SAAS,EAAER,KAAK,CAACS,OAAO,CAACD,SAAS;IAClCE,UAAU,EAAE;MACV;MACA;MACAC,YAAY,EAAE;IAChB,CAAC;IACD;IACAC,WAAW,EAAEZ,KAAK,CAACS,OAAO,CAACG,WAAW;IACtCC,MAAM,EAAEb,KAAK,CAACS,OAAO,CAACI;EACxB,CAAC,CAAC;EACF,MAAMC,YAAY,GAAGZ,UAAU,CAACE,IAAI,CAACW,QAAQ,EAAE;EAE/C,MAAM;IAAEC,MAAM;IAAEC;EAAU,CAAC,GAAGC,6CAA6C,CAAChB,UAAU,CAACiB,OAAO,CAAE;EAEhG,IAAIC,YAAY,GAAI,gCAA+BC,IAAI,CAACC,SAAS,CAACN,MAAM,CAAE,IAAGK,IAAI,CAACC,SAAS,CACzFL,SAAS,CACT,IAAG;EAEL,IAAIjB,KAAK,CAACS,OAAO,CAACc,GAAG,EAAE;IACrB,MAAMC,UAAU,GAAG,IAAAC,yBAAkB,EAAC;MACpC,GAAGzB,KAAK;MACRO,GAAG,EAAEO;IACP,CAAC,CAAC;IAEFM,YAAY,IAAI,IAAI,GAAGI,UAAU;EACnC;EAEA,OAAO;IACLE,MAAM,EAAEN,YAAY;IACpBO,GAAG,EAAEzB,UAAU,CAACE,IAAI;IACpBwB,GAAG,EAAE1B,UAAU,CAAC0B;EAClB,CAAC;AACH;AAEO,SAASV,6CAA6C,CAC3DW,KAA8C,EAC9C;EACA,MAAMb,MAA2B,GAAG,CAAC,CAAC;EACtC,MAAMC,SAAiC,GAAG,CAAC,CAAC;EAC5C;EACAa,MAAM,CAACC,OAAO,CAACF,KAAK,CAAC,CAACD,GAAG,CAAC,CAAC,CAACI,GAAG,EAAEC,KAAK,CAAC,KAAK;IAC1C;IACA,IAAIC,SAAS,GAAGD,KAAK,CAACE,IAAI;IAE1B,IAAIF,KAAK,CAACG,QAAQ,CAACC,MAAM,EAAE;MACzBH,SAAS,IAAI,GAAG,GAAGD,KAAK,CAACG,QAAQ,CAACR,GAAG,CAAEK,KAAK,IAAKA,KAAK,CAACE,IAAI,CAAC,CAACG,IAAI,CAAC,GAAG,CAAC;IACxE;;IAEA;IACA,IAAIN,GAAG,CAACO,UAAU,CAAC,IAAI,CAAC,EAAE;MACxBtB,SAAS,CAACe,GAAG,CAAC,GAAGE,SAAS;IAC5B;IAEAlB,MAAM,CAACgB,GAAG,CAAC,GAAG;MAAEQ,KAAK,EAAE,IAAI;MAAE,CAAC1C,gBAAgB,GAAGoC;IAAU,CAAC;IAC5D,OAAO;MACL,CAACF,GAAG,GAAG;QAAEQ,KAAK,EAAE,IAAI;QAAE,CAAC1C,gBAAgB,GAAGoC;MAAU;IACtD,CAAC;EACH,CAAC,CAAC;EAEF,OAAO;IAAElB,MAAM;IAAEC;EAAU,CAAC;AAC9B;AAEO,SAASwB,cAAc,CAACC,QAAgB,EAAW;EACxD,OAAO,CAAC,CAAC,6CAA6C,CAACC,IAAI,CAACD,QAAQ,CAAC;AACvE"}