{"version":3,"file":"LaunchBrowserImplMacOS.js","names":["LaunchBrowserImplMacOS","LaunchBrowserTypes","CHROME","EDGE","isSupportedBrowser","browserType","result","osascript","execAsync","MAP","createTempBrowserDir","baseDirName","path","join","require","launchAsync","args","appDirectory","appPath","globSync","cwd","trim","absolute","Error","_process","spawn","stdio","close","kill","undefined"],"sources":["../src/LaunchBrowserImplMacOS.ts"],"sourcesContent":["import * as osascript from '@expo/osascript';\nimport { spawn, type ChildProcess } from 'child_process';\nimport { sync as globSync } from 'glob';\nimport path from 'path';\n\nimport {\n  LaunchBrowserTypes,\n  type LaunchBrowserImpl,\n  type LaunchBrowserInstance,\n} from './LaunchBrowser.types';\n\n/**\n * Browser implementation for macOS\n */\nexport default class LaunchBrowserImplMacOS implements LaunchBrowserImpl, LaunchBrowserInstance {\n  private _process: ChildProcess | undefined;\n\n  MAP = {\n    [LaunchBrowserTypes.CHROME]: 'google chrome',\n    [LaunchBrowserTypes.EDGE]: 'microsoft edge',\n  };\n\n  async isSupportedBrowser(browserType: LaunchBrowserTypes): Promise<boolean> {\n    let result = false;\n    try {\n      await osascript.execAsync(`id of application \"${this.MAP[browserType]}\"`);\n      result = true;\n    } catch {\n      result = false;\n    }\n    return result;\n  }\n\n  async createTempBrowserDir(baseDirName: string) {\n    return path.join(require('temp-dir'), baseDirName);\n  }\n\n  async launchAsync(\n    browserType: LaunchBrowserTypes,\n    args: string[]\n  ): Promise<LaunchBrowserInstance> {\n    const appDirectory = await osascript.execAsync(\n      `POSIX path of (path to application \"${this.MAP[browserType]}\")`\n    );\n    const appPath = globSync('Contents/MacOS/*', { cwd: appDirectory.trim(), absolute: true })?.[0];\n    if (!appPath) {\n      throw new Error(`Cannot find application path from ${appDirectory}Contents/MacOS`);\n    }\n    this._process = spawn(appPath, args, { stdio: 'ignore' });\n\n    return this;\n  }\n\n  async close(): Promise<void> {\n    this._process?.kill();\n    this._process = undefined;\n  }\n}\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAI+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAE/B;AACA;AACA;AACe,MAAMA,sBAAsB,CAAqD;EAAA;IAAA;IAAA,6BAGxF;MACJ,CAACC,mCAAkB,CAACC,MAAM,GAAG,eAAe;MAC5C,CAACD,mCAAkB,CAACE,IAAI,GAAG;IAC7B,CAAC;EAAA;EAED,MAAMC,kBAAkB,CAACC,WAA+B,EAAoB;IAC1E,IAAIC,MAAM,GAAG,KAAK;IAClB,IAAI;MACF,MAAMC,SAAS,GAACC,SAAS,CAAE,sBAAqB,IAAI,CAACC,GAAG,CAACJ,WAAW,CAAE,GAAE,CAAC;MACzEC,MAAM,GAAG,IAAI;IACf,CAAC,CAAC,MAAM;MACNA,MAAM,GAAG,KAAK;IAChB;IACA,OAAOA,MAAM;EACf;EAEA,MAAMI,oBAAoB,CAACC,WAAmB,EAAE;IAC9C,OAAOC,eAAI,CAACC,IAAI,CAACC,OAAO,CAAC,UAAU,CAAC,EAAEH,WAAW,CAAC;EACpD;EAEA,MAAMI,WAAW,CACfV,WAA+B,EAC/BW,IAAc,EACkB;IAAA;IAChC,MAAMC,YAAY,GAAG,MAAMV,SAAS,GAACC,SAAS,CAC3C,uCAAsC,IAAI,CAACC,GAAG,CAACJ,WAAW,CAAE,IAAG,CACjE;IACD,MAAMa,OAAO,gBAAG,IAAAC,YAAQ,EAAC,kBAAkB,EAAE;MAAEC,GAAG,EAAEH,YAAY,CAACI,IAAI,EAAE;MAAEC,QAAQ,EAAE;IAAK,CAAC,CAAC,8CAA1E,UAA6E,CAAC,CAAC;IAC/F,IAAI,CAACJ,OAAO,EAAE;MACZ,MAAM,IAAIK,KAAK,CAAE,qCAAoCN,YAAa,gBAAe,CAAC;IACpF;IACA,IAAI,CAACO,QAAQ,GAAG,IAAAC,sBAAK,EAACP,OAAO,EAAEF,IAAI,EAAE;MAAEU,KAAK,EAAE;IAAS,CAAC,CAAC;IAEzD,OAAO,IAAI;EACb;EAEA,MAAMC,KAAK,GAAkB;IAAA;IAC3B,sBAAI,CAACH,QAAQ,mDAAb,eAAeI,IAAI,EAAE;IACrB,IAAI,CAACJ,QAAQ,GAAGK,SAAS;EAC3B;AACF;AAAC"}