{"version":3,"file":"remoteDevtoolsCorsMiddleware.js","names":["_url","data","require","remoteDevtoolsCorsMiddleware","req","res","next","url","_url$pathname","parseUrl","origin","headers","isValidOrigin","includes","pathname","endsWith","setHeader","bind","key","args"],"sources":["../../src/middleware/remoteDevtoolsCorsMiddleware.ts"],"sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\nimport { parse as parseUrl } from 'url';\n\n// Middleware that accepts multiple Access-Control-Allow-Origin for processing *.map.\n// This is a hook middleware before metro processing *.map,\n// which originally allow only devtools://devtools\nexport function remoteDevtoolsCorsMiddleware(\n  req: IncomingMessage,\n  res: ServerResponse,\n  next: (err?: Error) => void\n) {\n  if (req.url) {\n    const url = parseUrl(req.url);\n    const origin = req.headers.origin;\n    const isValidOrigin =\n      origin &&\n      ['devtools://devtools', 'https://chrome-devtools-frontend.appspot.com'].includes(origin);\n    if (url.pathname?.endsWith('.map') && origin && isValidOrigin) {\n      res.setHeader('Access-Control-Allow-Origin', origin);\n\n      // Prevent metro overwrite Access-Control-Allow-Origin header\n      const setHeader = res.setHeader.bind(res);\n      res.setHeader = (key, ...args) => {\n        if (key !== 'Access-Control-Allow-Origin') {\n          setHeader(key, ...args);\n        }\n        return res;\n      };\n    }\n  }\n  next();\n}\n"],"mappings":";;;;;;AACA,SAAAA,KAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,IAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA;AACA;AACA;AACO,SAASE,4BAA4BA,CAC1CC,GAAoB,EACpBC,GAAmB,EACnBC,IAA2B,EAC3B;EACA,IAAIF,GAAG,CAACG,GAAG,EAAE;IAAA,IAAAC,aAAA;IACX,MAAMD,GAAG,GAAG,IAAAE,YAAQ,EAACL,GAAG,CAACG,GAAG,CAAC;IAC7B,MAAMG,MAAM,GAAGN,GAAG,CAACO,OAAO,CAACD,MAAM;IACjC,MAAME,aAAa,GACjBF,MAAM,IACN,CAAC,qBAAqB,EAAE,8CAA8C,CAAC,CAACG,QAAQ,CAACH,MAAM,CAAC;IAC1F,IAAI,CAAAF,aAAA,GAAAD,GAAG,CAACO,QAAQ,cAAAN,aAAA,eAAZA,aAAA,CAAcO,QAAQ,CAAC,MAAM,CAAC,IAAIL,MAAM,IAAIE,aAAa,EAAE;MAC7DP,GAAG,CAACW,SAAS,CAAC,6BAA6B,EAAEN,MAAM,CAAC;;MAEpD;MACA,MAAMM,SAAS,GAAGX,GAAG,CAACW,SAAS,CAACC,IAAI,CAACZ,GAAG,CAAC;MACzCA,GAAG,CAACW,SAAS,GAAG,CAACE,GAAG,EAAE,GAAGC,IAAI,KAAK;QAChC,IAAID,GAAG,KAAK,6BAA6B,EAAE;UACzCF,SAAS,CAACE,GAAG,EAAE,GAAGC,IAAI,CAAC;QACzB;QACA,OAAOd,GAAG;MACZ,CAAC;IACH;EACF;EACAC,IAAI,EAAE;AACR"}