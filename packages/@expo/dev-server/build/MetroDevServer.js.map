{"version":3,"file":"MetroDevServer.js","names":["_config","data","require","_chalk","_interopRequireDefault","_HermesBundler","_LogReporter","_importMetroFromProject","_devServerMiddleware","_middlwareMutations","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","_JsInspector","obj","__esModule","default","getExpoMetroConfig","projectRoot","logger","unversioned","importExpoMetroConfigFromProject","unversionedVersion","version","info","tag","chalk","gray","bold","runMetroDevServerAsync","options","Metro","importMetroFromProject","reporter","LogReporter","ExpoMetroConfig","metroConfig","loadAsync","middleware","attachToServer","messageSocketEndpoint","eventsSocketEndpoint","websocketEndpoints","createDevServerMiddleware","port","server","watchFolders","customEnhanceMiddleware","enhanceMiddleware","metroMiddleware","use","runServer","hmrEnabled","messageSocket","eventsSocket","reportEvent","nextBuildID","bundleAsync","expoConfig","bundles","metro","Server","importMetroServerFromProject","config","buildID","metroServer","runMetro","watch","buildAsync","bundle","_bundle$dev","_bundle$minify","_bundle$dev2","_bundle$minify2","isHermes","isEnableHermesManaged","platform","bundleOptions","DEFAULT_BUNDLE_OPTIONS","bundleType","entryFile","entryPoint","dev","minify","inlineSourceMap","sourceMapUrl","createModuleIdFactory","serializer","onProgress","transformedFileCount","totalFileCount","quiet","update","type","bundleDetails","code","map","build","assets","getAssets","maybeAddHermesBundleAsync","bundleOutput","_ref","_paths$dynamicConfigP","isHermesManaged","paths","getConfigFilePaths","configFilePath","dynamicConfigPath","staticConfigPath","maybeThrowFromInconsistentEngineAsync","_bundle$minify3","platformTag","ios","android","web","hermesBundleOutput","buildHermesBundleAsync","hermesBytecodeBundle","hbc","hermesSourcemap","sourcemap","intermediateOutputs","Promise","all","bundleOutputs","i","length","push","end","attachInspectorProxy","InspectorProxy","importInspectorProxyServerFromProject","inspectorProxy","addWebSocketListener","createWebSocketListeners","processRequest","bind"],"sources":["../src/MetroDevServer.ts"],"sourcesContent":["import type Log from '@expo/bunyan';\nimport { ExpoConfig, getConfigFilePaths } from '@expo/config';\nimport type { LoadOptions } from '@expo/metro-config';\nimport chalk from 'chalk';\nimport type { Server as ConnectServer } from 'connect';\nimport http from 'http';\nimport type Metro from 'metro';\nimport type { BundleOptions as MetroBundleOptions } from 'metro/src/shared/types';\n\nimport {\n  buildHermesBundleAsync,\n  isEnableHermesManaged,\n  maybeThrowFromInconsistentEngineAsync,\n} from './HermesBundler';\nimport LogReporter from './LogReporter';\nimport {\n  importExpoMetroConfigFromProject,\n  importInspectorProxyServerFromProject,\n  importMetroFromProject,\n  importMetroServerFromProject,\n} from './metro/importMetroFromProject';\nimport { createDevServerMiddleware } from './middleware/devServerMiddleware';\n\nexport type MetroDevServerOptions = LoadOptions & {\n  logger: Log;\n  quiet?: boolean;\n  unversioned?: boolean;\n};\nexport type BundleOptions = {\n  entryPoint: string;\n  platform: 'android' | 'ios' | 'web';\n  dev?: boolean;\n  minify?: boolean;\n  sourceMapUrl?: string;\n};\nexport type BundleAssetWithFileHashes = Metro.AssetData & {\n  fileHashes: string[]; // added by the hashAssets asset plugin\n};\nexport type BundleOutput = {\n  code: string;\n  map: string;\n  hermesBytecodeBundle?: Uint8Array;\n  hermesSourcemap?: string;\n  assets: readonly BundleAssetWithFileHashes[];\n};\nexport type MessageSocket = {\n  broadcast: (method: string, params?: Record<string, any> | undefined) => void;\n};\n\nfunction getExpoMetroConfig(\n  projectRoot: string,\n  { logger, unversioned }: Pick<MetroDevServerOptions, 'logger' | 'unversioned'>\n): typeof import('@expo/metro-config') {\n  if (!unversioned) {\n    try {\n      return importExpoMetroConfigFromProject(projectRoot);\n    } catch {\n      // If expo isn't installed, use the unversioned config and warn about installing expo.\n    }\n  }\n\n  const unversionedVersion = require('@expo/metro-config/package.json').version;\n  logger.info(\n    { tag: 'expo' },\n    chalk.gray(\n      `\\u203A Unversioned ${chalk.bold`@expo/metro-config@${unversionedVersion}`} is being used. Bundling apps may not work as expected, and is subject to breaking changes. Install ${chalk.bold`expo`} or set the app.json sdkVersion to use a stable version of @expo/metro-config.`\n    )\n  );\n\n  return require('@expo/metro-config');\n}\n\n/** @deprecated */\nexport async function runMetroDevServerAsync(\n  projectRoot: string,\n  options: MetroDevServerOptions\n): Promise<{\n  server: http.Server;\n  middleware: any;\n  messageSocket: MessageSocket;\n}> {\n  const Metro = importMetroFromProject(projectRoot);\n\n  const reporter = new LogReporter(options.logger);\n\n  const ExpoMetroConfig = getExpoMetroConfig(projectRoot, options);\n\n  const metroConfig = await ExpoMetroConfig.loadAsync(projectRoot, { reporter, ...options });\n\n  const {\n    middleware,\n    attachToServer,\n\n    // RN +68 -- Expo SDK +45\n    messageSocketEndpoint,\n    eventsSocketEndpoint,\n    websocketEndpoints,\n  } = createDevServerMiddleware(projectRoot, {\n    port: metroConfig.server.port,\n    watchFolders: metroConfig.watchFolders,\n    logger: options.logger,\n  });\n\n  const customEnhanceMiddleware = metroConfig.server.enhanceMiddleware;\n  // @ts-ignore can't mutate readonly config\n  metroConfig.server.enhanceMiddleware = (metroMiddleware: any, server: Metro.Server) => {\n    if (customEnhanceMiddleware) {\n      metroMiddleware = customEnhanceMiddleware(metroMiddleware, server);\n    }\n    return middleware.use(metroMiddleware);\n  };\n\n  const server = await Metro.runServer(metroConfig, {\n    hmrEnabled: true,\n    // @ts-expect-error: Inconsistent `websocketEndpoints` type between metro and @react-native-community/cli-server-api\n    websocketEndpoints,\n  });\n\n  if (attachToServer) {\n    // Expo SDK 44 and lower\n    const { messageSocket, eventsSocket } = attachToServer(server);\n    reporter.reportEvent = eventsSocket.reportEvent;\n\n    return {\n      server,\n      middleware,\n      messageSocket,\n    };\n  } else {\n    // RN +68 -- Expo SDK +45\n    reporter.reportEvent = eventsSocketEndpoint.reportEvent;\n\n    return {\n      server,\n      middleware,\n      messageSocket: messageSocketEndpoint,\n      // debuggerProxyEndpoint,\n    };\n  }\n}\n\nlet nextBuildID = 0;\n\n/** @deprecated */\nexport async function bundleAsync(\n  projectRoot: string,\n  expoConfig: ExpoConfig,\n  options: MetroDevServerOptions,\n  bundles: BundleOptions[]\n): Promise<BundleOutput[]> {\n  const metro = importMetroFromProject(projectRoot);\n  const Server = importMetroServerFromProject(projectRoot);\n\n  const reporter = new LogReporter(options.logger);\n  const ExpoMetroConfig = getExpoMetroConfig(projectRoot, options);\n\n  const config = await ExpoMetroConfig.loadAsync(projectRoot, { reporter, ...options });\n  const buildID = `bundle_${nextBuildID++}`;\n\n  const metroServer = await metro.runMetro(config, {\n    watch: false,\n  });\n\n  const buildAsync = async (bundle: BundleOptions): Promise<BundleOutput> => {\n    const isHermes = isEnableHermesManaged(expoConfig, bundle.platform);\n    const bundleOptions: MetroBundleOptions = {\n      ...Server.DEFAULT_BUNDLE_OPTIONS,\n      bundleType: 'bundle',\n      platform: bundle.platform,\n      entryFile: bundle.entryPoint,\n      dev: bundle.dev ?? false,\n      minify: !isHermes && (bundle.minify ?? !bundle.dev),\n      inlineSourceMap: false,\n      sourceMapUrl: bundle.sourceMapUrl,\n      createModuleIdFactory: config.serializer.createModuleIdFactory,\n      onProgress: (transformedFileCount: number, totalFileCount: number) => {\n        if (!options.quiet) {\n          reporter.update({\n            buildID,\n            type: 'bundle_transform_progressed',\n            transformedFileCount,\n            totalFileCount,\n          });\n        }\n      },\n    };\n    reporter.update({\n      buildID,\n      type: 'bundle_build_started',\n      bundleDetails: {\n        bundleType: bundleOptions.bundleType,\n        platform: bundle.platform,\n        entryFile: bundle.entryPoint,\n        dev: bundle.dev ?? false,\n        minify: !isHermes && (bundle.minify ?? !bundle.dev),\n      },\n    });\n    const { code, map } = await metroServer.build(bundleOptions);\n    const assets = (await metroServer.getAssets(\n      bundleOptions\n    )) as readonly BundleAssetWithFileHashes[];\n    reporter.update({\n      buildID,\n      type: 'bundle_build_done',\n    });\n    return { code, map, assets };\n  };\n\n  const maybeAddHermesBundleAsync = async (\n    bundle: BundleOptions,\n    bundleOutput: BundleOutput\n  ): Promise<BundleOutput> => {\n    const { platform } = bundle;\n    const isHermesManaged = isEnableHermesManaged(expoConfig, platform);\n\n    const paths = getConfigFilePaths(projectRoot);\n    const configFilePath = paths.dynamicConfigPath ?? paths.staticConfigPath ?? 'app.json';\n    await maybeThrowFromInconsistentEngineAsync(\n      projectRoot,\n      configFilePath,\n      platform,\n      isHermesManaged\n    );\n\n    if (isHermesManaged) {\n      const platformTag = chalk.bold(\n        { ios: 'iOS', android: 'Android', web: 'Web' }[platform] || platform\n      );\n      options.logger.info(\n        { tag: 'expo' },\n        `ðŸ’¿ ${platformTag} Building Hermes bytecode for the bundle`\n      );\n      const hermesBundleOutput = await buildHermesBundleAsync(\n        projectRoot,\n        bundleOutput.code,\n        bundleOutput.map,\n        bundle.minify ?? !bundle.dev\n      );\n      bundleOutput.hermesBytecodeBundle = hermesBundleOutput.hbc;\n      bundleOutput.hermesSourcemap = hermesBundleOutput.sourcemap;\n    }\n    return bundleOutput;\n  };\n\n  try {\n    const intermediateOutputs = await Promise.all(bundles.map((bundle) => buildAsync(bundle)));\n    const bundleOutputs: BundleOutput[] = [];\n    for (let i = 0; i < bundles.length; ++i) {\n      // hermesc does not support parallel building even we spawn processes.\n      // we should build them sequentially.\n      bundleOutputs.push(await maybeAddHermesBundleAsync(bundles[i], intermediateOutputs[i]));\n    }\n    return bundleOutputs;\n  } finally {\n    metroServer.end();\n  }\n}\n\n/**\n * Attach the inspector proxy to a development server.\n * Inspector proxy is used for viewing the JS context in a browser.\n * This must be attached after the server is listening.\n * Attaching consists of pushing custom middleware and appending WebSockets to the server.\n *\n *\n * @param projectRoot\n * @param props.server dev server to add WebSockets to\n * @param props.middleware dev server middleware to add extra middleware to\n */\nexport function attachInspectorProxy(\n  projectRoot: string,\n  { server, middleware }: { server: http.Server; middleware: ConnectServer }\n) {\n  const { InspectorProxy } = importInspectorProxyServerFromProject(projectRoot);\n  const inspectorProxy = new InspectorProxy(projectRoot);\n  if ('addWebSocketListener' in inspectorProxy) {\n    // metro@0.59.0\n    inspectorProxy.addWebSocketListener(server);\n  } else if ('createWebSocketListeners' in inspectorProxy) {\n    // metro@0.66.0\n    // TODO: This isn't properly support without a ws router.\n    inspectorProxy.createWebSocketListeners(server);\n  }\n  // TODO(hypuk): Refactor inspectorProxy.processRequest into separate request handlers\n  // so that we could provide routes (/json/list and /json/version) here.\n  // Currently this causes Metro to give warning about T31407894.\n  // $FlowFixMe[method-unbinding] added when improving typing for this parameters\n  middleware.use(inspectorProxy.processRequest.bind(inspectorProxy));\n\n  return { inspectorProxy };\n}\n\nexport { LogReporter, createDevServerMiddleware };\nexport * from './middlwareMutations';\nexport * from './JsInspector';\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,SAAAA,QAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,OAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA,SAAAE,OAAA;EAAA,MAAAF,IAAA,GAAAG,sBAAA,CAAAF,OAAA;EAAAC,MAAA,YAAAA,CAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAMA,SAAAI,eAAA;EAAA,MAAAJ,IAAA,GAAAC,OAAA;EAAAG,cAAA,YAAAA,CAAA;IAAA,OAAAJ,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAKA,SAAAK,aAAA;EAAA,MAAAL,IAAA,GAAAG,sBAAA,CAAAF,OAAA;EAAAI,YAAA,YAAAA,CAAA;IAAA,OAAAL,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAM,wBAAA;EAAA,MAAAN,IAAA,GAAAC,OAAA;EAAAK,uBAAA,YAAAA,CAAA;IAAA,OAAAN,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAMA,SAAAO,qBAAA;EAAA,MAAAP,IAAA,GAAAC,OAAA;EAAAM,oBAAA,YAAAA,CAAA;IAAA,OAAAP,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAgRA,IAAAQ,mBAAA,GAAAP,OAAA;AAAAQ,MAAA,CAAAC,IAAA,CAAAF,mBAAA,EAAAG,OAAA,WAAAC,GAAA;EAAA,IAAAA,GAAA,kBAAAA,GAAA;EAAA,IAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAC,YAAA,EAAAJ,GAAA;EAAA,IAAAA,GAAA,IAAAK,OAAA,IAAAA,OAAA,CAAAL,GAAA,MAAAJ,mBAAA,CAAAI,GAAA;EAAAH,MAAA,CAAAS,cAAA,CAAAD,OAAA,EAAAL,GAAA;IAAAO,UAAA;IAAAC,GAAA,WAAAA,CAAA;MAAA,OAAAZ,mBAAA,CAAAI,GAAA;IAAA;EAAA;AAAA;AACA,IAAAS,YAAA,GAAApB,OAAA;AAAAQ,MAAA,CAAAC,IAAA,CAAAW,YAAA,EAAAV,OAAA,WAAAC,GAAA;EAAA,IAAAA,GAAA,kBAAAA,GAAA;EAAA,IAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAC,YAAA,EAAAJ,GAAA;EAAA,IAAAA,GAAA,IAAAK,OAAA,IAAAA,OAAA,CAAAL,GAAA,MAAAS,YAAA,CAAAT,GAAA;EAAAH,MAAA,CAAAS,cAAA,CAAAD,OAAA,EAAAL,GAAA;IAAAO,UAAA;IAAAC,GAAA,WAAAA,CAAA;MAAA,OAAAC,YAAA,CAAAT,GAAA;IAAA;EAAA;AAAA;AAA8B,SAAAT,uBAAAmB,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AArP9B,SAASG,kBAAkBA,CACzBC,WAAmB,EACnB;EAAEC,MAAM;EAAEC;AAAmE,CAAC,EACzC;EACrC,IAAI,CAACA,WAAW,EAAE;IAChB,IAAI;MACF,OAAO,IAAAC,0DAAgC,EAACH,WAAW,CAAC;IACtD,CAAC,CAAC,MAAM;MACN;IAAA;EAEJ;EAEA,MAAMI,kBAAkB,GAAG7B,OAAO,CAAC,iCAAiC,CAAC,CAAC8B,OAAO;EAC7EJ,MAAM,CAACK,IAAI,CACT;IAAEC,GAAG,EAAE;EAAO,CAAC,EACfC,gBAAK,CAACC,IAAI,CACP,sBAAqBD,gBAAK,CAACE,IAAK,sBAAqBN,kBAAmB,EAAE,uGAAsGI,gBAAK,CAACE,IAAK,MAAM,gFAA+E,CAClR,CACF;EAED,OAAOnC,OAAO,CAAC,oBAAoB,CAAC;AACtC;;AAEA;AACO,eAAeoC,sBAAsBA,CAC1CX,WAAmB,EACnBY,OAA8B,EAK7B;EACD,MAAMC,KAAK,GAAG,IAAAC,gDAAsB,EAACd,WAAW,CAAC;EAEjD,MAAMe,QAAQ,GAAG,KAAIC,sBAAW,EAACJ,OAAO,CAACX,MAAM,CAAC;EAEhD,MAAMgB,eAAe,GAAGlB,kBAAkB,CAACC,WAAW,EAAEY,OAAO,CAAC;EAEhE,MAAMM,WAAW,GAAG,MAAMD,eAAe,CAACE,SAAS,CAACnB,WAAW,EAAE;IAAEe,QAAQ;IAAE,GAAGH;EAAQ,CAAC,CAAC;EAE1F,MAAM;IACJQ,UAAU;IACVC,cAAc;IAEd;IACAC,qBAAqB;IACrBC,oBAAoB;IACpBC;EACF,CAAC,GAAG,IAAAC,gDAAyB,EAACzB,WAAW,EAAE;IACzC0B,IAAI,EAAER,WAAW,CAACS,MAAM,CAACD,IAAI;IAC7BE,YAAY,EAAEV,WAAW,CAACU,YAAY;IACtC3B,MAAM,EAAEW,OAAO,CAACX;EAClB,CAAC,CAAC;EAEF,MAAM4B,uBAAuB,GAAGX,WAAW,CAACS,MAAM,CAACG,iBAAiB;EACpE;EACAZ,WAAW,CAACS,MAAM,CAACG,iBAAiB,GAAG,CAACC,eAAoB,EAAEJ,MAAoB,KAAK;IACrF,IAAIE,uBAAuB,EAAE;MAC3BE,eAAe,GAAGF,uBAAuB,CAACE,eAAe,EAAEJ,MAAM,CAAC;IACpE;IACA,OAAOP,UAAU,CAACY,GAAG,CAACD,eAAe,CAAC;EACxC,CAAC;EAED,MAAMJ,MAAM,GAAG,MAAMd,KAAK,CAACoB,SAAS,CAACf,WAAW,EAAE;IAChDgB,UAAU,EAAE,IAAI;IAChB;IACAV;EACF,CAAC,CAAC;EAEF,IAAIH,cAAc,EAAE;IAClB;IACA,MAAM;MAAEc,aAAa;MAAEC;IAAa,CAAC,GAAGf,cAAc,CAACM,MAAM,CAAC;IAC9DZ,QAAQ,CAACsB,WAAW,GAAGD,YAAY,CAACC,WAAW;IAE/C,OAAO;MACLV,MAAM;MACNP,UAAU;MACVe;IACF,CAAC;EACH,CAAC,MAAM;IACL;IACApB,QAAQ,CAACsB,WAAW,GAAGd,oBAAoB,CAACc,WAAW;IAEvD,OAAO;MACLV,MAAM;MACNP,UAAU;MACVe,aAAa,EAAEb;MACf;IACF,CAAC;EACH;AACF;;AAEA,IAAIgB,WAAW,GAAG,CAAC;;AAEnB;AACO,eAAeC,WAAWA,CAC/BvC,WAAmB,EACnBwC,UAAsB,EACtB5B,OAA8B,EAC9B6B,OAAwB,EACC;EACzB,MAAMC,KAAK,GAAG,IAAA5B,gDAAsB,EAACd,WAAW,CAAC;EACjD,MAAM2C,MAAM,GAAG,IAAAC,sDAA4B,EAAC5C,WAAW,CAAC;EAExD,MAAMe,QAAQ,GAAG,KAAIC,sBAAW,EAACJ,OAAO,CAACX,MAAM,CAAC;EAChD,MAAMgB,eAAe,GAAGlB,kBAAkB,CAACC,WAAW,EAAEY,OAAO,CAAC;EAEhE,MAAMiC,MAAM,GAAG,MAAM5B,eAAe,CAACE,SAAS,CAACnB,WAAW,EAAE;IAAEe,QAAQ;IAAE,GAAGH;EAAQ,CAAC,CAAC;EACrF,MAAMkC,OAAO,GAAI,UAASR,WAAW,EAAG,EAAC;EAEzC,MAAMS,WAAW,GAAG,MAAML,KAAK,CAACM,QAAQ,CAACH,MAAM,EAAE;IAC/CI,KAAK,EAAE;EACT,CAAC,CAAC;EAEF,MAAMC,UAAU,GAAG,MAAOC,MAAqB,IAA4B;IAAA,IAAAC,WAAA,EAAAC,cAAA,EAAAC,YAAA,EAAAC,eAAA;IACzE,MAAMC,QAAQ,GAAG,IAAAC,sCAAqB,EAACjB,UAAU,EAAEW,MAAM,CAACO,QAAQ,CAAC;IACnE,MAAMC,aAAiC,GAAG;MACxC,GAAGhB,MAAM,CAACiB,sBAAsB;MAChCC,UAAU,EAAE,QAAQ;MACpBH,QAAQ,EAAEP,MAAM,CAACO,QAAQ;MACzBI,SAAS,EAAEX,MAAM,CAACY,UAAU;MAC5BC,GAAG,GAAAZ,WAAA,GAAED,MAAM,CAACa,GAAG,cAAAZ,WAAA,cAAAA,WAAA,GAAI,KAAK;MACxBa,MAAM,EAAE,CAACT,QAAQ,MAAAH,cAAA,GAAKF,MAAM,CAACc,MAAM,cAAAZ,cAAA,cAAAA,cAAA,GAAI,CAACF,MAAM,CAACa,GAAG,CAAC;MACnDE,eAAe,EAAE,KAAK;MACtBC,YAAY,EAAEhB,MAAM,CAACgB,YAAY;MACjCC,qBAAqB,EAAEvB,MAAM,CAACwB,UAAU,CAACD,qBAAqB;MAC9DE,UAAU,EAAEA,CAACC,oBAA4B,EAAEC,cAAsB,KAAK;QACpE,IAAI,CAAC5D,OAAO,CAAC6D,KAAK,EAAE;UAClB1D,QAAQ,CAAC2D,MAAM,CAAC;YACd5B,OAAO;YACP6B,IAAI,EAAE,6BAA6B;YACnCJ,oBAAoB;YACpBC;UACF,CAAC,CAAC;QACJ;MACF;IACF,CAAC;IACDzD,QAAQ,CAAC2D,MAAM,CAAC;MACd5B,OAAO;MACP6B,IAAI,EAAE,sBAAsB;MAC5BC,aAAa,EAAE;QACbf,UAAU,EAAEF,aAAa,CAACE,UAAU;QACpCH,QAAQ,EAAEP,MAAM,CAACO,QAAQ;QACzBI,SAAS,EAAEX,MAAM,CAACY,UAAU;QAC5BC,GAAG,GAAAV,YAAA,GAAEH,MAAM,CAACa,GAAG,cAAAV,YAAA,cAAAA,YAAA,GAAI,KAAK;QACxBW,MAAM,EAAE,CAACT,QAAQ,MAAAD,eAAA,GAAKJ,MAAM,CAACc,MAAM,cAAAV,eAAA,cAAAA,eAAA,GAAI,CAACJ,MAAM,CAACa,GAAG;MACpD;IACF,CAAC,CAAC;IACF,MAAM;MAAEa,IAAI;MAAEC;IAAI,CAAC,GAAG,MAAM/B,WAAW,CAACgC,KAAK,CAACpB,aAAa,CAAC;IAC5D,MAAMqB,MAAM,GAAI,MAAMjC,WAAW,CAACkC,SAAS,CACzCtB,aAAa,CAC2B;IAC1C5C,QAAQ,CAAC2D,MAAM,CAAC;MACd5B,OAAO;MACP6B,IAAI,EAAE;IACR,CAAC,CAAC;IACF,OAAO;MAAEE,IAAI;MAAEC,GAAG;MAAEE;IAAO,CAAC;EAC9B,CAAC;EAED,MAAME,yBAAyB,GAAG,MAAAA,CAChC/B,MAAqB,EACrBgC,YAA0B,KACA;IAAA,IAAAC,IAAA,EAAAC,qBAAA;IAC1B,MAAM;MAAE3B;IAAS,CAAC,GAAGP,MAAM;IAC3B,MAAMmC,eAAe,GAAG,IAAA7B,sCAAqB,EAACjB,UAAU,EAAEkB,QAAQ,CAAC;IAEnE,MAAM6B,KAAK,GAAG,IAAAC,4BAAkB,EAACxF,WAAW,CAAC;IAC7C,MAAMyF,cAAc,IAAAL,IAAA,IAAAC,qBAAA,GAAGE,KAAK,CAACG,iBAAiB,cAAAL,qBAAA,cAAAA,qBAAA,GAAIE,KAAK,CAACI,gBAAgB,cAAAP,IAAA,cAAAA,IAAA,GAAI,UAAU;IACtF,MAAM,IAAAQ,sDAAqC,EACzC5F,WAAW,EACXyF,cAAc,EACd/B,QAAQ,EACR4B,eAAe,CAChB;IAED,IAAIA,eAAe,EAAE;MAAA,IAAAO,eAAA;MACnB,MAAMC,WAAW,GAAGtF,gBAAK,CAACE,IAAI,CAC5B;QAAEqF,GAAG,EAAE,KAAK;QAAEC,OAAO,EAAE,SAAS;QAAEC,GAAG,EAAE;MAAM,CAAC,CAACvC,QAAQ,CAAC,IAAIA,QAAQ,CACrE;MACD9C,OAAO,CAACX,MAAM,CAACK,IAAI,CACjB;QAAEC,GAAG,EAAE;MAAO,CAAC,EACd,MAAKuF,WAAY,0CAAyC,CAC5D;MACD,MAAMI,kBAAkB,GAAG,MAAM,IAAAC,uCAAsB,EACrDnG,WAAW,EACXmF,YAAY,CAACN,IAAI,EACjBM,YAAY,CAACL,GAAG,GAAAe,eAAA,GAChB1C,MAAM,CAACc,MAAM,cAAA4B,eAAA,cAAAA,eAAA,GAAI,CAAC1C,MAAM,CAACa,GAAG,CAC7B;MACDmB,YAAY,CAACiB,oBAAoB,GAAGF,kBAAkB,CAACG,GAAG;MAC1DlB,YAAY,CAACmB,eAAe,GAAGJ,kBAAkB,CAACK,SAAS;IAC7D;IACA,OAAOpB,YAAY;EACrB,CAAC;EAED,IAAI;IACF,MAAMqB,mBAAmB,GAAG,MAAMC,OAAO,CAACC,GAAG,CAACjE,OAAO,CAACqC,GAAG,CAAE3B,MAAM,IAAKD,UAAU,CAACC,MAAM,CAAC,CAAC,CAAC;IAC1F,MAAMwD,aAA6B,GAAG,EAAE;IACxC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGnE,OAAO,CAACoE,MAAM,EAAE,EAAED,CAAC,EAAE;MACvC;MACA;MACAD,aAAa,CAACG,IAAI,CAAC,MAAM5B,yBAAyB,CAACzC,OAAO,CAACmE,CAAC,CAAC,EAAEJ,mBAAmB,CAACI,CAAC,CAAC,CAAC,CAAC;IACzF;IACA,OAAOD,aAAa;EACtB,CAAC,SAAS;IACR5D,WAAW,CAACgE,GAAG,EAAE;EACnB;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,oBAAoBA,CAClChH,WAAmB,EACnB;EAAE2B,MAAM;EAAEP;AAA+D,CAAC,EAC1E;EACA,MAAM;IAAE6F;EAAe,CAAC,GAAG,IAAAC,+DAAqC,EAAClH,WAAW,CAAC;EAC7E,MAAMmH,cAAc,GAAG,IAAIF,cAAc,CAACjH,WAAW,CAAC;EACtD,IAAI,sBAAsB,IAAImH,cAAc,EAAE;IAC5C;IACAA,cAAc,CAACC,oBAAoB,CAACzF,MAAM,CAAC;EAC7C,CAAC,MAAM,IAAI,0BAA0B,IAAIwF,cAAc,EAAE;IACvD;IACA;IACAA,cAAc,CAACE,wBAAwB,CAAC1F,MAAM,CAAC;EACjD;EACA;EACA;EACA;EACA;EACAP,UAAU,CAACY,GAAG,CAACmF,cAAc,CAACG,cAAc,CAACC,IAAI,CAACJ,cAAc,CAAC,CAAC;EAElE,OAAO;IAAEA;EAAe,CAAC;AAC3B"}