{"version":3,"file":"JsInspector.js","names":["openingBrowserInstance","openJsInspector","app","devtoolsFrontendRev","urlBase","ws","webSocketDebuggerUrl","replace","url","encodeURIComponent","closeJsInspector","launchBrowserAsync","close","queryInspectorAppAsync","metroServerOrigin","appId","apps","queryAllInspectorAppsAsync","find","description","resp","fetch","transformApps","json","filter","title","deviceIdToAppId","deviceId","id","split","map"],"sources":["../src/JsInspector.ts"],"sourcesContent":["import fetch from 'node-fetch';\n\nimport { launchBrowserAsync, type LaunchBrowserInstance } from './LaunchBrowser';\n\nexport interface MetroInspectorProxyApp {\n  description: string;\n  devtoolsFrontendUrl: string;\n  faviconUrl: string;\n  id: string;\n  title: string;\n  type: 'node';\n  vm: 'Hermes' | \"don't use\";\n  webSocketDebuggerUrl: string;\n}\n\nlet openingBrowserInstance: LaunchBrowserInstance | null = null;\n\nexport async function openJsInspector(app: MetroInspectorProxyApp) {\n  // To update devtoolsFrontendRev, find the full commit hash in the url:\n  // https://chromium.googlesource.com/chromium/src.git/+log/refs/tags/{CHROME_VERSION}/chrome/VERSION\n  //\n  // 1. Replace {CHROME_VERSION} with the target chrome version\n  // 2. Click the first log item in the webpage\n  // 3. The full commit hash is the desired revision\n  const devtoolsFrontendRev = 'd9568d04d7dd79269c5a655d7ada69650c5a8336'; // Chrome 100.0.4896.75\n\n  const urlBase = `https://chrome-devtools-frontend.appspot.com/serve_rev/@${devtoolsFrontendRev}/inspector.html`;\n  const ws = app.webSocketDebuggerUrl.replace(/^ws:\\/\\//, '');\n  const url = `${urlBase}?panel=sources&v8only=true&ws=${encodeURIComponent(ws)}`;\n  await closeJsInspector();\n  openingBrowserInstance = await launchBrowserAsync(url);\n}\n\nexport async function closeJsInspector() {\n  await openingBrowserInstance?.close();\n  openingBrowserInstance = null;\n}\n\nexport async function queryInspectorAppAsync(\n  metroServerOrigin: string,\n  appId: string\n): Promise<MetroInspectorProxyApp | null> {\n  const apps = await queryAllInspectorAppsAsync(metroServerOrigin);\n  return apps.find((app) => app.description === appId) ?? null;\n}\n\nexport async function queryAllInspectorAppsAsync(\n  metroServerOrigin: string\n): Promise<MetroInspectorProxyApp[]> {\n  const resp = await fetch(`${metroServerOrigin}/json/list`);\n  const apps: MetroInspectorProxyApp[] = transformApps(await resp.json());\n  // Only use targets with better reloading support\n  return apps.filter((app) => app.title === 'React Native Experimental (Improved Chrome Reloads)');\n}\n\n// The description of `React Native Experimental (Improved Chrome Reloads)` target is `don't use` from metro.\n// This function tries to transform the unmeaningful description to appId\nfunction transformApps(apps: MetroInspectorProxyApp[]): MetroInspectorProxyApp[] {\n  const deviceIdToAppId: Record<string, string> = {};\n\n  for (const app of apps) {\n    if (app.description !== \"don't use\") {\n      const deviceId = app.id.split('-')[0];\n      const appId = app.description;\n      deviceIdToAppId[deviceId] = appId;\n    }\n  }\n\n  return apps.map((app) => {\n    if (app.description === \"don't use\") {\n      const deviceId = app.id.split('-')[0];\n      app.description = deviceIdToAppId[deviceId] ?? app.description;\n    }\n    return app;\n  });\n}\n"],"mappings":";;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAiF;AAajF,IAAIA,sBAAoD,GAAG,IAAI;AAExD,eAAeC,eAAe,CAACC,GAA2B,EAAE;EACjE;EACA;EACA;EACA;EACA;EACA;EACA,MAAMC,mBAAmB,GAAG,0CAA0C,CAAC,CAAC;;EAExE,MAAMC,OAAO,GAAI,2DAA0DD,mBAAoB,iBAAgB;EAC/G,MAAME,EAAE,GAAGH,GAAG,CAACI,oBAAoB,CAACC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;EAC3D,MAAMC,GAAG,GAAI,GAAEJ,OAAQ,iCAAgCK,kBAAkB,CAACJ,EAAE,CAAE,EAAC;EAC/E,MAAMK,gBAAgB,EAAE;EACxBV,sBAAsB,GAAG,MAAM,IAAAW,mCAAkB,EAACH,GAAG,CAAC;AACxD;AAEO,eAAeE,gBAAgB,GAAG;EAAA;EACvC,gCAAMV,sBAAsB,0DAAtB,sBAAwBY,KAAK,EAAE;EACrCZ,sBAAsB,GAAG,IAAI;AAC/B;AAEO,eAAea,sBAAsB,CAC1CC,iBAAyB,EACzBC,KAAa,EAC2B;EAAA;EACxC,MAAMC,IAAI,GAAG,MAAMC,0BAA0B,CAACH,iBAAiB,CAAC;EAChE,qBAAOE,IAAI,CAACE,IAAI,CAAEhB,GAAG,IAAKA,GAAG,CAACiB,WAAW,KAAKJ,KAAK,CAAC,mDAAI,IAAI;AAC9D;AAEO,eAAeE,0BAA0B,CAC9CH,iBAAyB,EACU;EACnC,MAAMM,IAAI,GAAG,MAAM,IAAAC,oBAAK,EAAE,GAAEP,iBAAkB,YAAW,CAAC;EAC1D,MAAME,IAA8B,GAAGM,aAAa,CAAC,MAAMF,IAAI,CAACG,IAAI,EAAE,CAAC;EACvE;EACA,OAAOP,IAAI,CAACQ,MAAM,CAAEtB,GAAG,IAAKA,GAAG,CAACuB,KAAK,KAAK,qDAAqD,CAAC;AAClG;;AAEA;AACA;AACA,SAASH,aAAa,CAACN,IAA8B,EAA4B;EAC/E,MAAMU,eAAuC,GAAG,CAAC,CAAC;EAElD,KAAK,MAAMxB,GAAG,IAAIc,IAAI,EAAE;IACtB,IAAId,GAAG,CAACiB,WAAW,KAAK,WAAW,EAAE;MACnC,MAAMQ,QAAQ,GAAGzB,GAAG,CAAC0B,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACrC,MAAMd,KAAK,GAAGb,GAAG,CAACiB,WAAW;MAC7BO,eAAe,CAACC,QAAQ,CAAC,GAAGZ,KAAK;IACnC;EACF;EAEA,OAAOC,IAAI,CAACc,GAAG,CAAE5B,GAAG,IAAK;IACvB,IAAIA,GAAG,CAACiB,WAAW,KAAK,WAAW,EAAE;MAAA;MACnC,MAAMQ,QAAQ,GAAGzB,GAAG,CAAC0B,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACrC3B,GAAG,CAACiB,WAAW,4BAAGO,eAAe,CAACC,QAAQ,CAAC,yEAAIzB,GAAG,CAACiB,WAAW;IAChE;IACA,OAAOjB,GAAG;EACZ,CAAC,CAAC;AACJ"}