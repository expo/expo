{"version":3,"file":"locales.js","names":["_jsonFile","data","_interopRequireDefault","require","_path","_warnings","e","__esModule","default","getResolvedLocalesAsync","projectRoot","input","forPlatform","locales","localizableStringsIOS","lang","localeJsonPath","Object","entries","locale","getLocales","android","ios","rest","localizableStringsEntry","otherEntries","extractIosLocalizableStrings","localesMap","JsonFile","readAsync","path","join","addWarningForPlatform","LOCALIZABLE_STR_ENTRY","undefined","isStringsMap","value","Array","isArray","values","every","item"],"sources":["../../src/utils/locales.ts"],"sourcesContent":["import { ExpoConfig } from '@expo/config-types';\nimport JsonFile, { JSONObject } from '@expo/json-file';\nimport path from 'path';\n\nimport { addWarningForPlatform } from './warnings';\n\n/**\n * on iOS only, we support a special case where\n * StringsMap contains a 'Localizable.strings'?: StringsMap; entry\n * Values written into `Localizable.strings` for iOS.\n */\nexport type StringsMap = Record<string, string>;\n\nexport type LocaleJson = Record<string, string> & {\n  ios?: StringsMap;\n  android?: StringsMap;\n};\n\nexport type ExpoConfigLocales = NonNullable<ExpoConfig['locales']>;\nexport type ResolvedLocalesJson = Record<string, LocaleJson>;\n\nexport async function getResolvedLocalesAsync(\n  projectRoot: string,\n  input: ExpoConfigLocales,\n  forPlatform: 'ios' | 'android'\n): Promise<{ localesMap: ResolvedLocalesJson; localizableStringsIOS?: ResolvedLocalesJson }> {\n  const locales: ResolvedLocalesJson = {};\n  const localizableStringsIOS: ResolvedLocalesJson = {};\n  for (const [lang, localeJsonPath] of Object.entries(input)) {\n    const locale = await getLocales(projectRoot, localeJsonPath, forPlatform, lang);\n    if (locale) {\n      const { android, ios, ...rest } = {\n        android: {},\n        ios: {},\n        ...locale,\n      };\n      if (forPlatform === 'ios') {\n        const { localizableStringsEntry, otherEntries } = extractIosLocalizableStrings({\n          ios,\n          lang,\n        });\n        if (localizableStringsEntry) {\n          localizableStringsIOS[lang] = localizableStringsEntry;\n        }\n        locales[lang] = { ...rest, ...otherEntries };\n      } else {\n        locales[lang] = { ...rest, ...android };\n      }\n    }\n  }\n\n  return { localesMap: locales, localizableStringsIOS };\n}\n\nasync function getLocales(\n  projectRoot: string,\n  localeJsonPath: string | JSONObject,\n  forPlatform: 'ios' | 'android',\n  lang: string\n): Promise<JSONObject | null> {\n  if (typeof localeJsonPath === 'string') {\n    try {\n      return await JsonFile.readAsync(path.join(projectRoot, localeJsonPath));\n    } catch {\n      // Add a warning when a json file cannot be parsed.\n      addWarningForPlatform(\n        forPlatform,\n        `locales.${lang}`,\n        `Failed to parse JSON of locale file for language: ${lang}`,\n        'https://docs.expo.dev/guides/localization/#translating-app-metadata'\n      );\n      return null;\n    }\n  }\n\n  // In the off chance that someone defined the locales json in the config, pass it directly to the object.\n  // We do this to make the types more elegant.\n  return localeJsonPath;\n}\n\nfunction extractIosLocalizableStrings({ ios, lang }: { ios: StringsMap; lang: string }): {\n  localizableStringsEntry?: StringsMap;\n  otherEntries: StringsMap;\n} {\n  const LOCALIZABLE_STR_ENTRY = 'Localizable.strings';\n  if (!(LOCALIZABLE_STR_ENTRY in ios)) {\n    return { localizableStringsEntry: undefined, otherEntries: ios };\n  }\n\n  const { [LOCALIZABLE_STR_ENTRY]: localizableStringsEntry, ...otherEntries } = ios;\n\n  if (!localizableStringsEntry) {\n    return { localizableStringsEntry: undefined, otherEntries };\n  }\n\n  if (!isStringsMap(localizableStringsEntry)) {\n    addWarningForPlatform(\n      'ios',\n      `locales.${lang}.ios['${LOCALIZABLE_STR_ENTRY}']`,\n      'Expected a JSON object mapping string keys to string values',\n      'https://docs.expo.dev/guides/localization/#translating-app-metadata'\n    );\n    return { localizableStringsEntry: undefined, otherEntries };\n  }\n\n  return { localizableStringsEntry, otherEntries };\n}\n\nfunction isStringsMap(value: unknown): value is StringsMap {\n  if (!value || typeof value !== 'object' || Array.isArray(value)) {\n    return false;\n  }\n  return Object.values(value).every((item) => typeof item === 'string');\n}\n"],"mappings":"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","ignoreList":[]}