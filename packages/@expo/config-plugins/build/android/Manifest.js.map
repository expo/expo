{"version":3,"file":"Manifest.js","names":["_assert","data","_interopRequireDefault","require","_fs","_path","XML","_interopRequireWildcard","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","writeAndroidManifestAsync","manifestPath","androidManifest","manifestXml","format","fs","promises","mkdir","path","dirname","recursive","writeFile","readAndroidManifestAsync","xml","readXMLAsync","isManifest","Error","manifest","getMainApplication","application","filter","$","endsWith","getMainApplicationOrThrow","mainApplication","assert","getMainActivityOrThrow","mainActivity","getMainActivity","hasMainActionIntentFilter","intentFilter","action","find","hasLauncherCategoryIntentFilter","category","getRunnableActivity","enabledActivities","activity","mainActionActivites","runnableActivities","reduce","prev","Array","isArray","isMainActionIntentFilter","isLauncherCategoryIntentFilter","push","length","enabledActivityAliases","activityAlias","targetActivity","target","addMetaDataItemToMainApplication","itemName","itemValue","itemType","existingMetaDataItem","newItem","prefixAndroidKeys","name","removeMetaDataItemFromMainApplication","index","findMetaDataItem","splice","findApplicationSubItem","parent","findIndex","findUsesLibraryItem","getMainApplicationMetaDataValue","item","addUsesLibraryItemToMainApplication","removeUsesLibraryItemFromMainApplication","head","entries","key","curr","ensureToolsAvailable","ensureManifestHasNamespace","namespace","url"],"sources":["../../src/android/Manifest.ts"],"sourcesContent":["import assert from 'assert';\nimport fs from 'fs';\nimport path from 'path';\n\nimport * as XML from '../utils/XML';\n\nexport type StringBoolean = 'true' | 'false';\n\ntype ManifestMetaDataAttributes = AndroidManifestAttributes & {\n  'android:value'?: string;\n  'android:resource'?: string;\n};\n\ntype AndroidManifestAttributes = {\n  'android:name': string | 'android.intent.action.VIEW';\n  'tools:node'?: string | 'remove';\n};\n\ntype ManifestAction = {\n  $: AndroidManifestAttributes;\n};\n\ntype ManifestCategory = {\n  $: AndroidManifestAttributes;\n};\n\ntype ManifestData = {\n  $: {\n    [key: string]: string | undefined;\n    'android:host'?: string;\n    'android:pathPrefix'?: string;\n    'android:scheme'?: string;\n  };\n};\n\ntype ManifestReceiver = {\n  $: AndroidManifestAttributes & {\n    'android:exported'?: StringBoolean;\n    'android:enabled'?: StringBoolean;\n  };\n  'intent-filter'?: ManifestIntentFilter[];\n};\n\nexport type ManifestIntentFilter = {\n  $?: {\n    'android:autoVerify'?: StringBoolean;\n    'data-generated'?: StringBoolean;\n  };\n  action?: ManifestAction[];\n  data?: ManifestData[];\n  category?: ManifestCategory[];\n};\n\nexport type ManifestMetaData = {\n  $: ManifestMetaDataAttributes;\n};\n\ntype ManifestServiceAttributes = AndroidManifestAttributes & {\n  'android:enabled'?: StringBoolean;\n  'android:exported'?: StringBoolean;\n  'android:permission'?: string;\n  'android:foregroundServiceType'?: string;\n  // ...\n};\n\ntype ManifestService = {\n  $: ManifestServiceAttributes;\n  'intent-filter'?: ManifestIntentFilter[];\n};\n\ntype ManifestApplicationAttributes = {\n  'android:name': string | '.MainApplication';\n  'android:icon'?: string;\n  'android:roundIcon'?: string;\n  'android:label'?: string;\n  'android:allowBackup'?: StringBoolean;\n  'android:largeHeap'?: StringBoolean;\n  'android:requestLegacyExternalStorage'?: StringBoolean;\n  'android:supportsPictureInPicture'?: StringBoolean;\n  'android:usesCleartextTraffic'?: StringBoolean;\n  [key: string]: string | undefined;\n};\n\nexport type ManifestActivity = {\n  $: ManifestApplicationAttributes & {\n    'android:exported'?: StringBoolean;\n    'android:launchMode'?: string;\n    'android:theme'?: string;\n    'android:windowSoftInputMode'?:\n      | string\n      | 'stateUnspecified'\n      | 'stateUnchanged'\n      | 'stateHidden'\n      | 'stateAlwaysHidden'\n      | 'stateVisible'\n      | 'stateAlwaysVisible'\n      | 'adjustUnspecified'\n      | 'adjustResize'\n      | 'adjustPan';\n    [key: string]: string | undefined;\n  };\n  'intent-filter'?: ManifestIntentFilter[];\n  // ...\n};\n\nexport type ManifestActivityAlias = {\n  $: ManifestActivity['$'] & {\n    'android:targetActivity'?: string;\n  };\n  'intent-filter'?: ManifestIntentFilter[];\n};\n\nexport type ManifestUsesLibrary = {\n  $: AndroidManifestAttributes & {\n    'android:required'?: StringBoolean;\n  };\n};\n\nexport type ManifestApplication = {\n  $: ManifestApplicationAttributes;\n  activity?: ManifestActivity[];\n  'activity-alias'?: ManifestActivityAlias[];\n  service?: ManifestService[];\n  receiver?: ManifestReceiver[];\n  'meta-data'?: ManifestMetaData[];\n  'uses-library'?: ManifestUsesLibrary[];\n  // ...\n};\n\ntype ManifestPermission = {\n  $: AndroidManifestAttributes & {\n    'android:protectionLevel'?: string | 'signature';\n  };\n};\n\nexport type ManifestUsesPermission = {\n  $: AndroidManifestAttributes;\n};\n\ntype ManifestUsesFeature = {\n  $: AndroidManifestAttributes & {\n    'android:glEsVersion'?: string;\n    'android:required': StringBoolean;\n  };\n};\n\nexport type AndroidManifest = {\n  manifest: {\n    // Probably more, but this is currently all we'd need for most cases in Expo.\n    $: {\n      'xmlns:android': string;\n      'xmlns:tools'?: string;\n      package?: string;\n      [key: string]: string | undefined;\n    };\n    permission?: ManifestPermission[];\n    'uses-permission'?: ManifestUsesPermission[];\n    'uses-permission-sdk-23'?: ManifestUsesPermission[];\n    'uses-feature'?: ManifestUsesFeature[];\n    queries: ManifestQuery[];\n    application?: ManifestApplication[];\n  };\n};\n\ntype ManifestQueryIntent = Omit<ManifestIntentFilter, '$'>;\n\nexport type ManifestQuery = {\n  package?: {\n    $: {\n      'android:name': string;\n    };\n  }[];\n  intent?: ManifestQueryIntent[];\n  provider?: {\n    $: {\n      'android:authorities': string;\n    };\n  }[];\n};\n\nexport async function writeAndroidManifestAsync(\n  manifestPath: string,\n  androidManifest: AndroidManifest\n): Promise<void> {\n  const manifestXml = XML.format(androidManifest);\n  await fs.promises.mkdir(path.dirname(manifestPath), { recursive: true });\n  await fs.promises.writeFile(manifestPath, manifestXml);\n}\n\nexport async function readAndroidManifestAsync(manifestPath: string): Promise<AndroidManifest> {\n  const xml = await XML.readXMLAsync({ path: manifestPath });\n  if (!isManifest(xml)) {\n    throw new Error('Invalid manifest found at: ' + manifestPath);\n  }\n  return xml;\n}\n\nfunction isManifest(xml: XML.XMLObject): xml is AndroidManifest {\n  // TODO: Maybe more validation\n  return !!xml.manifest;\n}\n\n/** Returns the `manifest.application` tag ending in `.MainApplication` */\nexport function getMainApplication(androidManifest: AndroidManifest): ManifestApplication | null {\n  return (\n    androidManifest?.manifest?.application?.filter((e) =>\n      e?.$?.['android:name'].endsWith('.MainApplication')\n    )[0] ?? null\n  );\n}\n\nexport function getMainApplicationOrThrow(androidManifest: AndroidManifest): ManifestApplication {\n  const mainApplication = getMainApplication(androidManifest);\n  assert(mainApplication, 'AndroidManifest.xml is missing the required MainApplication element');\n  return mainApplication;\n}\n\nexport function getMainActivityOrThrow(androidManifest: AndroidManifest): ManifestActivity {\n  const mainActivity = getMainActivity(androidManifest);\n  assert(mainActivity, 'AndroidManifest.xml is missing the required MainActivity element');\n  return mainActivity;\n}\n\nfunction hasMainActionIntentFilter(intentFilter: ManifestIntentFilter): boolean {\n  return !!intentFilter.action?.find(\n    (action) => action.$['android:name'] === 'android.intent.action.MAIN'\n  );\n}\n\nfunction hasLauncherCategoryIntentFilter(intentFilter: ManifestIntentFilter): boolean {\n  return !!intentFilter.category?.find(\n    (category) => category.$['android:name'] === 'android.intent.category.LAUNCHER'\n  );\n}\n\nexport function getRunnableActivity(androidManifest: AndroidManifest): ManifestActivity | null {\n  // Get enabled activities\n  const enabledActivities = androidManifest?.manifest?.application?.[0]?.activity?.filter?.(\n    (e: any) => e.$['android:enabled'] !== 'false' && e.$['android:enabled'] !== false\n  );\n\n  if (!enabledActivities) {\n    return null;\n  }\n\n  const { mainActionActivites, runnableActivities } = enabledActivities.reduce(\n    (prev, activity) => {\n      if (Array.isArray(activity['intent-filter'])) {\n        for (const intentFilter of activity['intent-filter']) {\n          const isMainActionIntentFilter = hasMainActionIntentFilter(intentFilter);\n          const isLauncherCategoryIntentFilter = hasLauncherCategoryIntentFilter(intentFilter);\n\n          if (isMainActionIntentFilter && isLauncherCategoryIntentFilter) {\n            prev.runnableActivities.push(activity);\n          }\n          if (isMainActionIntentFilter) {\n            prev.mainActionActivites.push(activity);\n          }\n        }\n      }\n      return prev;\n    },\n    { mainActionActivites: [] as ManifestActivity[], runnableActivities: [] as ManifestActivity[] }\n  );\n\n  if (runnableActivities.length) {\n    return runnableActivities[0];\n  }\n\n  // No runnable activity found, look for enabled activity aliases\n  const enabledActivityAliases = androidManifest?.manifest?.application?.[0]?.[\n    'activity-alias'\n  ]?.filter?.((e: any) => e.$['android:enabled'] !== 'false' && e.$['android:enabled'] !== false);\n\n  if (!enabledActivityAliases) {\n    return null;\n  }\n\n  // Look for the activity alias that has a runnable intent-filter\n  // and a targetActivity pointing to an existing main action activity\n  for (const activityAlias of enabledActivityAliases) {\n    if (Array.isArray(activityAlias['intent-filter'])) {\n      for (const intentFilter of activityAlias['intent-filter']) {\n        const isMainActionIntentFilter = hasMainActionIntentFilter(intentFilter);\n        const isLauncherCategoryIntentFilter = hasLauncherCategoryIntentFilter(intentFilter);\n        if (isMainActionIntentFilter && isLauncherCategoryIntentFilter) {\n          const targetActivity = activityAlias.$['android:targetActivity'];\n          if (targetActivity) {\n            const target = mainActionActivites.find((e) => e.$['android:name'] === targetActivity);\n            if (target) {\n              return target;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return null;\n}\n\nexport function getMainActivity(androidManifest: AndroidManifest): ManifestActivity | null {\n  const mainActivity = androidManifest?.manifest?.application?.[0]?.activity?.filter?.(\n    (e: any) => e.$['android:name'] === '.MainActivity'\n  );\n  return mainActivity?.[0] ?? null;\n}\n\nexport function addMetaDataItemToMainApplication(\n  mainApplication: ManifestApplication,\n  itemName: string,\n  itemValue: string,\n  itemType: 'resource' | 'value' = 'value'\n): ManifestApplication {\n  let existingMetaDataItem;\n  const newItem = {\n    $: prefixAndroidKeys({ name: itemName, [itemType]: itemValue }),\n  } as ManifestMetaData;\n  if (mainApplication['meta-data']) {\n    existingMetaDataItem = mainApplication['meta-data'].filter(\n      (e: any) => e.$['android:name'] === itemName\n    );\n    if (existingMetaDataItem.length) {\n      existingMetaDataItem[0].$[`android:${itemType}` as keyof ManifestMetaDataAttributes] =\n        itemValue;\n    } else {\n      mainApplication['meta-data'].push(newItem);\n    }\n  } else {\n    mainApplication['meta-data'] = [newItem];\n  }\n  return mainApplication;\n}\n\nexport function removeMetaDataItemFromMainApplication(mainApplication: any, itemName: string) {\n  const index = findMetaDataItem(mainApplication, itemName);\n  if (mainApplication?.['meta-data'] && index > -1) {\n    mainApplication['meta-data'].splice(index, 1);\n  }\n  return mainApplication;\n}\n\nfunction findApplicationSubItem(\n  mainApplication: ManifestApplication,\n  category: keyof ManifestApplication,\n  itemName: string\n): number {\n  const parent = mainApplication[category];\n  if (Array.isArray(parent)) {\n    const index = parent.findIndex((e: any) => e.$['android:name'] === itemName);\n\n    return index;\n  }\n  return -1;\n}\n\nexport function findMetaDataItem(mainApplication: any, itemName: string): number {\n  return findApplicationSubItem(mainApplication, 'meta-data', itemName);\n}\n\nexport function findUsesLibraryItem(mainApplication: any, itemName: string): number {\n  return findApplicationSubItem(mainApplication, 'uses-library', itemName);\n}\n\nexport function getMainApplicationMetaDataValue(\n  androidManifest: AndroidManifest,\n  name: string\n): string | null {\n  const mainApplication = getMainApplication(androidManifest);\n\n  if (mainApplication?.hasOwnProperty('meta-data')) {\n    const item = mainApplication?.['meta-data']?.find((e: any) => e.$['android:name'] === name);\n    return item?.$['android:value'] ?? null;\n  }\n\n  return null;\n}\n\nexport function addUsesLibraryItemToMainApplication(\n  mainApplication: ManifestApplication,\n  item: { name: string; required?: boolean }\n): ManifestApplication {\n  let existingMetaDataItem;\n  const newItem = {\n    $: prefixAndroidKeys(item),\n  } as ManifestUsesLibrary;\n\n  if (mainApplication['uses-library']) {\n    existingMetaDataItem = mainApplication['uses-library'].filter(\n      (e) => e.$['android:name'] === item.name\n    );\n    if (existingMetaDataItem.length) {\n      existingMetaDataItem[0].$ = newItem.$;\n    } else {\n      mainApplication['uses-library'].push(newItem);\n    }\n  } else {\n    mainApplication['uses-library'] = [newItem];\n  }\n  return mainApplication;\n}\n\nexport function removeUsesLibraryItemFromMainApplication(\n  mainApplication: ManifestApplication,\n  itemName: string\n) {\n  const index = findUsesLibraryItem(mainApplication, itemName);\n  if (mainApplication?.['uses-library'] && index > -1) {\n    mainApplication['uses-library'].splice(index, 1);\n  }\n  return mainApplication;\n}\n\nexport function prefixAndroidKeys<T extends Record<string, any> = Record<string, string>>(\n  head: T\n): Record<string, any> {\n  // prefix all keys with `android:`\n  return Object.entries(head).reduce(\n    (prev, [key, curr]) => ({ ...prev, [`android:${key}`]: curr }),\n    {} as T\n  );\n}\n\n/**\n * Ensure the `tools:*` namespace is available in the manifest.\n *\n * @param manifest AndroidManifest.xml\n * @returns manifest with the `tools:*` namespace available\n */\nexport function ensureToolsAvailable(manifest: AndroidManifest) {\n  return ensureManifestHasNamespace(manifest, {\n    namespace: 'xmlns:tools',\n    url: 'http://schemas.android.com/tools',\n  });\n}\n\n/**\n * Ensure a particular namespace is available in the manifest.\n *\n * @param manifest `AndroidManifest.xml`\n * @returns manifest with the provided namespace available\n */\nfunction ensureManifestHasNamespace(\n  manifest: AndroidManifest,\n  { namespace, url }: { namespace: string; url: string }\n) {\n  if (manifest?.manifest?.$?.[namespace]) {\n    return manifest;\n  }\n  manifest.manifest.$[namespace] = url;\n  return manifest;\n}\n"],"mappings":"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","ignoreList":[]}