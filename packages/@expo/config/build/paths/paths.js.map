{"version":3,"file":"paths.js","names":["ensureSlash","inputPath","needsSlash","hasSlash","endsWith","substr","length","getPossibleProjectRoot","fs","realpathSync","process","cwd","resolveEntryPoint","projectRoot","platform","pkg","getPackageJson","platforms","includes","extensions","getBareExtensions","main","entry","getFileWithExtensions","resolveFromSilentWithExtensions","ConfigError","resolveFrom","fromDirectory","moduleId","extension","modulePath","silent","path","join","existsSync"],"sources":["../../src/paths/paths.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport resolveFrom from 'resolve-from';\n\nimport { getPackageJson } from '../Config';\nimport { PackageJSONConfig } from '../Config.types';\nimport { ConfigError } from '../Errors';\nimport { getBareExtensions } from './extensions';\n\nexport function ensureSlash(inputPath: string, needsSlash: boolean): string {\n  const hasSlash = inputPath.endsWith('/');\n  if (hasSlash && !needsSlash) {\n    return inputPath.substr(0, inputPath.length - 1);\n  } else if (!hasSlash && needsSlash) {\n    return `${inputPath}/`;\n  } else {\n    return inputPath;\n  }\n}\n\nexport function getPossibleProjectRoot(): string {\n  return fs.realpathSync(process.cwd());\n}\n\n/** @returns the absolute entry file for an Expo project. */\nexport function resolveEntryPoint(\n  projectRoot: string,\n  {\n    platform,\n    pkg = getPackageJson(projectRoot),\n  }: {\n    platform?: string;\n    pkg?: PackageJSONConfig;\n  } = {}\n): string {\n  const platforms = !platform\n    ? []\n    : ['ios', 'android'].includes(platform)\n    ? [platform, 'native']\n    : [platform];\n  const extensions = getBareExtensions(platforms);\n\n  // If the config doesn't define a custom entry then we want to look at the `package.json`s `main` field, and try again.\n  const { main } = pkg;\n  if (main && typeof main === 'string') {\n    // Testing the main field against all of the provided extensions - for legacy reasons we can't use node module resolution as the package.json allows you to pass in a file without a relative path and expect it as a relative path.\n    let entry = getFileWithExtensions(projectRoot, main, extensions);\n    if (!entry) {\n      // Allow for paths like: `{ \"main\": \"expo/AppEntry\" }`\n      entry = resolveFromSilentWithExtensions(projectRoot, main, extensions);\n      if (!entry)\n        throw new ConfigError(\n          `Cannot resolve entry file: The \\`main\\` field defined in your \\`package.json\\` points to an unresolvable or non-existent path.`,\n          'ENTRY_NOT_FOUND'\n        );\n    }\n    return entry;\n  }\n\n  // Check for a root index.* file in the project root.\n  const entry = resolveFromSilentWithExtensions(projectRoot, './index', extensions);\n  if (entry) {\n    return entry;\n  }\n\n  try {\n    // If none of the default files exist then we will attempt to use the main Expo entry point.\n    // This requires `expo` to be installed in the project to work as it will use `node_module/expo/AppEntry.js`\n    // Doing this enables us to create a bare minimum Expo project.\n\n    // TODO(Bacon): We may want to do a check against `./App` and `expo` in the `package.json` `dependencies` as we can more accurately ensure that the project is expo-min without needing the modules installed.\n    return resolveFrom(projectRoot, 'expo/AppEntry');\n  } catch {\n    throw new ConfigError(\n      `The project entry file could not be resolved. Define it in the \\`main\\` field of the \\`package.json\\`, create an \\`index.js\\`, or install the \\`expo\\` package.`,\n      'ENTRY_NOT_FOUND'\n    );\n  }\n}\n\n// Resolve from but with the ability to resolve like a bundler\nfunction resolveFromSilentWithExtensions(\n  fromDirectory: string,\n  moduleId: string,\n  extensions: string[]\n): string | null {\n  for (const extension of extensions) {\n    const modulePath = resolveFrom.silent(fromDirectory, `${moduleId}.${extension}`);\n    if (modulePath?.endsWith(extension)) {\n      return modulePath;\n    }\n  }\n  return resolveFrom.silent(fromDirectory, moduleId) || null;\n}\n\n// Statically attempt to resolve a module but with the ability to resolve like a bundler.\n// This won't use node module resolution.\nexport function getFileWithExtensions(\n  fromDirectory: string,\n  moduleId: string,\n  extensions: string[]\n): string | null {\n  const modulePath = path.join(fromDirectory, moduleId);\n  if (fs.existsSync(modulePath)) {\n    return modulePath;\n  }\n  for (const extension of extensions) {\n    const modulePath = path.join(fromDirectory, `${moduleId}.${extension}`);\n    if (fs.existsSync(modulePath)) {\n      return modulePath;\n    }\n  }\n  return null;\n}\n"],"mappings":"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"}