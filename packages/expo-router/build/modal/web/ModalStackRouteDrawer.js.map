{"version":3,"file":"ModalStackRouteDrawer.js","sourceRoot":"","sources":["../../../src/modal/web/ModalStackRouteDrawer.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\nimport React from 'react';\nimport { Drawer } from 'vaul';\n\nimport modalStyles from './modalStyles';\nimport { CSSWithVars } from './types';\nimport { useIsDesktop } from './utils';\nimport { ExtendedStackNavigationOptions } from '../../layouts/StackClient';\n\nfunction ModalStackRouteDrawer({\n  routeKey,\n  options,\n  dismissible,\n  renderScreen,\n  onDismiss,\n  themeColors,\n}: {\n  routeKey: string;\n  options: ExtendedStackNavigationOptions;\n  renderScreen: () => React.ReactNode;\n  onDismiss: () => void;\n  themeColors: { card: string; background: string };\n  dismissible?: boolean;\n}) {\n  const [open, setOpen] = React.useState(true);\n  // Determine sheet vs. modal with an SSR-safe hook. The first render (during\n  // hydration) always assumes mobile/sheet to match the server markup; an\n  // effect then updates the state after mount if the viewport is desktop.\n  const isDesktop = useIsDesktop();\n  const isSheet = !isDesktop;\n\n  // Resolve snap points logic.\n  const allowed = options.sheetAllowedDetents;\n\n  const isArrayDetents = Array.isArray(allowed);\n  const useCustomSnapPoints = isArrayDetents && !(allowed.length === 1 && allowed[0] === 1);\n\n  let snapPoints: (number | string)[] | undefined = useCustomSnapPoints\n    ? (allowed as (number | string)[])\n    : undefined;\n\n  if (!isSheet) {\n    snapPoints = [1];\n  }\n\n  const [snap, setSnap] = React.useState<number | string | null>(\n    useCustomSnapPoints && isArrayDetents ? allowed[0] : 1\n  );\n\n  // Update the snap value when custom snap points change.\n  React.useEffect(() => {\n    if (isSheet) {\n      const next = useCustomSnapPoints && isArrayDetents ? allowed[0] : 1;\n      setSnap(next);\n    } else {\n      // Desktop modal always fixed snap at 1\n      setSnap(1);\n    }\n  }, [isSheet, useCustomSnapPoints, isArrayDetents, allowed]);\n\n  // Map react-native-screens ios sheet undimmed logic to Vaul's fadeFromIndex\n  const fadeFromIndex = isSheet\n    ? options.sheetLargestUndimmedDetentIndex === 'last'\n      ? (snapPoints?.length ?? 0)\n      : typeof options.sheetLargestUndimmedDetentIndex === 'number'\n        ? options.sheetLargestUndimmedDetentIndex + 1\n        : 0\n    : 0;\n\n  // --- Styling -----------------------------------------------------------\n\n  // Using CSS variables so defaults live in CSS and can be overridden via props.\n  const modalStyleVars: CSSWithVars = {\n    backgroundColor: themeColors.background,\n  };\n\n  if (!isSheet) {\n    if (options.webModalStyle?.width) {\n      modalStyleVars['--expo-router-modal-width'] =\n        typeof options.webModalStyle.width === 'number'\n          ? `${options.webModalStyle.width}px`\n          : options.webModalStyle.width;\n\n      modalStyleVars['--expo-router-modal-max-width'] =\n        typeof options.webModalStyle.width === 'number'\n          ? `${options.webModalStyle.width}px`\n          : options.webModalStyle.width;\n\n      // Also set explicit width so browsers that ignore CSS vars in `width` prop still work.\n      modalStyleVars.width =\n        typeof options.webModalStyle.width === 'number'\n          ? `${options.webModalStyle.width}px`\n          : options.webModalStyle.width;\n    }\n\n    // Min width override\n    if (options.webModalStyle?.minWidth) {\n      const mw =\n        typeof options.webModalStyle.minWidth === 'number'\n          ? `${options.webModalStyle.minWidth}px`\n          : options.webModalStyle.minWidth;\n      modalStyleVars['--expo-router-modal-min-width'] = mw;\n      modalStyleVars.minWidth = mw;\n    }\n\n    if (options.webModalStyle?.height) {\n      const h =\n        typeof options.webModalStyle.height === 'number'\n          ? `${options.webModalStyle.height}px`\n          : options.webModalStyle.height;\n      modalStyleVars['--expo-router-modal-height'] = h;\n      modalStyleVars.maxHeight = h;\n      modalStyleVars.height = h;\n      modalStyleVars.minHeight = h;\n    }\n\n    // Separate min-height override (takes precedence over modalHeight)\n    if (options.webModalStyle?.minHeight) {\n      const mh =\n        typeof options.webModalStyle.minHeight === 'number'\n          ? `${options.webModalStyle.minHeight}px`\n          : options.webModalStyle.minHeight;\n      modalStyleVars['--expo-router-modal-min-height'] = mh;\n      modalStyleVars.minHeight = mh;\n    }\n  }\n\n  const fitToContents = options.sheetAllowedDetents === 'fitToContents';\n\n  if (fitToContents) {\n    modalStyleVars.height = 'auto';\n    modalStyleVars.minHeight = 'auto';\n\n    // TODO:(@Hirbod) Clarify if we should limit maxHeight to sheets only\n    // Allow sheet to grow with content but never exceed viewport height\n    // dvh is important, otherwise it will scale over the visible viewport height\n    modalStyleVars.maxHeight = '100dvh';\n  }\n\n  // Apply corner radius (default 24px for iOS 26)\n  const radiusValue = options.sheetCornerRadius ?? 24;\n  const radiusCss = typeof radiusValue === 'number' ? `${radiusValue}px` : radiusValue;\n\n  if (options.webModalStyle?.border) {\n    modalStyleVars['--expo-router-modal-border'] = options.webModalStyle.border;\n  }\n\n  if (options.webModalStyle?.shadow) {\n    modalStyleVars['--expo-router-modal-shadow'] = options.webModalStyle.shadow;\n  }\n\n  if (isSheet) {\n    // Only top corners for mobile sheet\n    modalStyleVars.borderTopLeftRadius = radiusCss;\n    modalStyleVars.borderTopRightRadius = radiusCss;\n\n    // Always set CSS var to ensure consistency with default iOS 26 radius\n    modalStyleVars['--expo-router-modal-border-radius'] = radiusCss;\n  } else {\n    // All corners for desktop modal - always set CSS var for iOS 26 default\n    modalStyleVars['--expo-router-modal-border-radius'] = radiusCss;\n  }\n  // --- End Styling -----------------------------------------------------------\n\n  const handleOpenChange = (open: boolean) => {\n    if (!open) onDismiss();\n  };\n\n  // Props that only make sense for sheets\n  const sheetProps = isSheet\n    ? {\n        snapPoints: snapPoints as (number | string)[],\n        activeSnapPoint: snap,\n        setActiveSnapPoint: setSnap,\n        fadeFromIndex,\n      }\n    : {};\n\n  return (\n    <Drawer.Root\n      key={`${routeKey}-${isSheet ? 'sheet' : 'modal'}`}\n      open={open}\n      dismissible={dismissible ?? options.gestureEnabled ?? true}\n      onAnimationEnd={handleOpenChange}\n      shouldScaleBackground\n      autoFocus\n      onOpenChange={setOpen}\n      {...sheetProps}>\n      <Drawer.Portal>\n        <Drawer.Overlay\n          className={modalStyles.overlay}\n          style={\n            options.webModalStyle?.overlayBackground\n              ? ({\n                  '--expo-router-modal-overlay-background': options.webModalStyle.overlayBackground,\n                } as React.CSSProperties)\n              : undefined\n          }\n        />\n        <Drawer.Content\n          aria-describedby=\"modal-description\"\n          className={modalStyles.drawerContent}\n          style={{\n            pointerEvents: 'none',\n            // This needs to be limited to sheets, otherwise it will position the modal at the bottom of the screen\n            ...(isSheet && fitToContents ? { height: 'auto' } : null),\n          }}>\n          <div\n            className={modalStyles.modal}\n            data-presentation={isSheet ? 'formSheet' : 'modal'}\n            style={modalStyleVars}>\n            {/* TODO:(@Hirbod) Figure out how to add title and description to the modal for screen readers in a meaningful way */}\n            <Drawer.Title about=\"\" aria-describedby=\"\" className={modalStyles.srOnly} />\n            <Drawer.Description about=\"\" className={modalStyles.srOnly} />\n            {/* Render the screen content */}\n            <div className={modalStyles.modalBody}>{renderScreen()}</div>\n          </div>\n        </Drawer.Content>\n      </Drawer.Portal>\n    </Drawer.Root>\n  );\n}\n\nexport { ModalStackRouteDrawer };\n"]}