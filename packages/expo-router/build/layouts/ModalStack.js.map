{"version":3,"file":"ModalStack.js","sourceRoot":"","sources":["../../src/layouts/ModalStack.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  createNavigatorFactory,\n  ParamListBase,\n  StackNavigationState,\n  StackRouter,\n  useNavigationBuilder,\n  useTheme,\n} from '@react-navigation/native';\nimport { NativeStackView } from '@react-navigation/native-stack';\nimport React from 'react';\nimport { Platform } from 'react-native';\nimport { Drawer } from 'vaul';\n\nimport { ExtendedStackNavigationOptions } from './StackClient';\nimport { withLayoutContext } from './withLayoutContext';\nimport modalStyles from '../../assets/modal.module.css';\n\ntype Props = {\n  initialRouteName?: string;\n  screenOptions?: ExtendedStackNavigationOptions;\n  children: React.ReactNode;\n};\n\ntype CSSWithVars = React.CSSProperties & {\n  [key: `--${string}`]: string | number;\n};\n\nfunction ModalStackNavigator({ initialRouteName, children, screenOptions }: Props) {\n  const { state, navigation, descriptors, NavigationContent, describe } = useNavigationBuilder(\n    StackRouter,\n    {\n      children,\n      screenOptions,\n      initialRouteName,\n    }\n  );\n\n  return (\n    <NavigationContent>\n      <ModalStackView\n        state={state}\n        navigation={navigation}\n        descriptors={descriptors}\n        describe={describe}\n      />\n    </NavigationContent>\n  );\n}\n\nfunction ModalStackView({\n  state,\n  navigation,\n  descriptors,\n  describe,\n}: {\n  state: StackNavigationState<ParamListBase>;\n  navigation: any;\n  descriptors: Record<\n    string,\n    {\n      navigation: any;\n      route: any;\n      options: ExtendedStackNavigationOptions;\n      render: () => React.ReactNode;\n    }\n  >;\n  describe: any;\n}) {\n  const isWeb = Platform.OS === 'web';\n  const { colors } = useTheme();\n\n  const nonModalRoutes = state.routes.filter((route) => {\n    const { presentation } = descriptors[route.key].options || {};\n    const isModalType =\n      presentation === 'modal' ||\n      presentation === 'formSheet' ||\n      presentation === 'fullScreenModal' ||\n      presentation === 'containedModal';\n    return !(isWeb && isModalType);\n  });\n\n  let nonModalIndex = nonModalRoutes.findIndex((r) => r.key === state.routes[state.index]?.key);\n  if (nonModalIndex < 0) nonModalIndex = nonModalRoutes.length - 1;\n\n  const newStackState = { ...state, routes: nonModalRoutes, index: nonModalIndex };\n\n  return (\n    <div style={{ flex: 1, display: 'flex' }}>\n      <NativeStackView\n        state={newStackState}\n        navigation={navigation}\n        descriptors={descriptors as any}\n        describe={describe}\n      />\n      {isWeb &&\n        state.routes.map((route, i) => {\n          const { presentation } = descriptors[route.key].options || {};\n          const isModalType =\n            presentation === 'modal' ||\n            presentation === 'formSheet' ||\n            presentation === 'fullScreenModal' ||\n            presentation === 'containedModal';\n          const isActive = i === state.index && isModalType;\n          if (!isActive) return null;\n\n          return (\n            <RouteDrawer\n              key={route.key}\n              routeKey={route.key}\n              options={descriptors[route.key].options as ExtendedStackNavigationOptions}\n              renderScreen={descriptors[route.key].render}\n              onDismiss={() => navigation.goBack()}\n              themeColors={colors}\n            />\n          );\n        })}\n    </div>\n  );\n}\n\nconst createModalStack = createNavigatorFactory(ModalStackNavigator);\nconst RouterModal = withLayoutContext(createModalStack().Navigator);\n\nexport { RouterModal };\n\n// Internal helper component\n\nfunction RouteDrawer({\n  routeKey,\n  options,\n  renderScreen,\n  onDismiss,\n  themeColors,\n}: {\n  routeKey: string;\n  options: ExtendedStackNavigationOptions;\n  renderScreen: () => React.ReactNode;\n  onDismiss: () => void;\n  themeColors: { card: string; background: string };\n}) {\n  const [open, setOpen] = React.useState(true);\n  // Determine layout based on viewport width (desktop vs mobile)\n  const isDesktop = useIsDesktop();\n  const isSheet = !isDesktop;\n  // Resolve snap points logic.\n  const allowed = options.sheetAllowedDetents;\n\n  const isArrayDetents = Array.isArray(allowed);\n  const useCustomSnapPoints = isArrayDetents && !(allowed.length === 1 && allowed[0] === 1);\n\n  let snapPoints: (number | string)[] | undefined = useCustomSnapPoints\n    ? (allowed as (number | string)[])\n    : undefined;\n\n  if (!isSheet) {\n    snapPoints = [1];\n  }\n\n  const [snap, setSnap] = React.useState<number | string | null>(\n    useCustomSnapPoints && isArrayDetents ? allowed[0] : 1\n  );\n\n  // When the viewport flips between desktop <-> mobile, update snap value accordingly.\n  React.useEffect(() => {\n    if (isSheet) {\n      const next = useCustomSnapPoints && isArrayDetents ? allowed[0] : 1;\n      setSnap(next);\n    } else {\n      // Desktop modal always fixed snap at 1\n      setSnap(1);\n    }\n  }, [isSheet]);\n\n  // Map react-native-screens ios sheet undimmed logic to Vaul's fadeFromIndex\n  const fadeFromIndex = isSheet\n    ? options.sheetLargestUndimmedDetentIndex === 'last'\n      ? (snapPoints?.length ?? 0)\n      : typeof options.sheetLargestUndimmedDetentIndex === 'number'\n        ? options.sheetLargestUndimmedDetentIndex + 1\n        : 0\n    : 0;\n\n  // --- Styling -----------------------------------------------------------\n\n  // Using CSS variables so defaults live in CSS and can be overridden via props.\n  const modalStyleVars: CSSWithVars = {\n    backgroundColor: themeColors.background,\n  };\n\n  if (!isSheet) {\n    if (options.modalWidth) {\n      modalStyleVars['--expo-router-modal-width'] =\n        typeof options.modalWidth === 'number' ? `${options.modalWidth}px` : options.modalWidth;\n\n      modalStyleVars['--expo-router-modal-max-width'] =\n        typeof options.modalWidth === 'number' ? `${options.modalWidth}px` : options.modalWidth;\n\n      // Also set explicit width so browsers that ignore CSS vars in `width` prop still work.\n      modalStyleVars.width =\n        typeof options.modalWidth === 'number' ? `${options.modalWidth}px` : options.modalWidth;\n    }\n\n    // Min width override\n    if (options.modalMinWidth) {\n      const mw =\n        typeof options.modalMinWidth === 'number'\n          ? `${options.modalMinWidth}px`\n          : options.modalMinWidth;\n      modalStyleVars['--expo-router-modal-min-width'] = mw;\n      modalStyleVars.minWidth = mw;\n    }\n\n    if (options.modalHeight) {\n      const h =\n        typeof options.modalHeight === 'number' ? `${options.modalHeight}px` : options.modalHeight;\n      modalStyleVars['--expo-router-modal-height'] = h;\n      modalStyleVars.maxHeight = h;\n      modalStyleVars.height = h;\n      modalStyleVars.minHeight = h;\n    }\n\n    // Separate min-height override (takes precedence over modalHeight)\n    if (options.modalMinHeight) {\n      const mh =\n        typeof options.modalMinHeight === 'number'\n          ? `${options.modalMinHeight}px`\n          : options.modalMinHeight;\n      modalStyleVars['--expo-router-modal-min-height'] = mh;\n      modalStyleVars.minHeight = mh;\n    }\n  }\n\n  const fitToContents = isSheet && options.sheetAllowedDetents === 'fitToContents';\n\n  if (fitToContents) {\n    modalStyleVars.height = 'auto';\n    modalStyleVars.minHeight = 'auto';\n    // Allow sheet to grow with content but never exceed viewport height\n    modalStyleVars.maxHeight = 'calc(100vh)';\n  }\n\n  // Apply corner radius (default 10px)\n  const radiusValue = options.sheetCornerRadius ?? 10;\n  const radiusCss = typeof radiusValue === 'number' ? `${radiusValue}px` : radiusValue;\n\n  if (options.modalBorder) {\n    modalStyleVars['--expo-router-modal-border'] = options.modalBorder;\n  }\n\n  if (isSheet) {\n    // Only top corners for mobile sheet\n    modalStyleVars.borderTopLeftRadius = radiusCss;\n    modalStyleVars.borderTopRightRadius = radiusCss;\n\n    // Only apply CSS var override if a custom corner radius was provided\n    if (options.sheetCornerRadius) {\n      modalStyleVars['--expo-router-modal-radius'] = radiusCss;\n    }\n  } else {\n    // All corners for desktop modal\n    if (options.sheetCornerRadius) {\n      modalStyleVars.borderRadius = radiusCss;\n      modalStyleVars['--expo-router-modal-radius'] = radiusCss;\n    }\n  }\n  // --- End Styling -----------------------------------------------------------\n\n  const handleOpenChange = (open: boolean) => {\n    if (!open) onDismiss();\n  };\n\n  // Props that only make sense for sheets\n  const sheetProps = isSheet\n    ? {\n        snapPoints: snapPoints as (number | string)[],\n        activeSnapPoint: snap,\n        setActiveSnapPoint: setSnap,\n        fadeFromIndex,\n      }\n    : {};\n\n  return (\n    <Drawer.Root\n      key={`${routeKey}-${isSheet ? 'sheet' : 'modal'}`}\n      open={open}\n      dismissible={options.gestureEnabled ?? true}\n      onAnimationEnd={handleOpenChange}\n      onOpenChange={setOpen}\n      {...sheetProps}>\n      <Drawer.Portal>\n        <Drawer.Overlay\n          className={modalStyles.overlay}\n          style={\n            options.modalOverlayBackground\n              ? ({\n                  '--expo-router-modal-overlay-bg': options.modalOverlayBackground,\n                } as React.CSSProperties)\n              : undefined\n          }\n        />\n        <Drawer.Content\n          aria-describedby=\"modal-description\"\n          className={modalStyles.drawerContent}\n          style={{\n            pointerEvents: 'none',\n            ...(fitToContents ? { height: 'auto' } : null),\n          }}>\n          <div\n            className={modalStyles.modal}\n            data-presentation={isSheet ? 'formSheet' : 'modal'}\n            style={modalStyleVars}>\n            {/* Figure out how to add title and description to the modal for screen readers */}\n            <Drawer.Title about=\"\" aria-describedby=\"\" className={modalStyles.srOnly} />\n            <Drawer.Description about=\"\" className={modalStyles.srOnly} />\n            {/* Render the screen content */}\n            <div className={modalStyles.modalBody}>{renderScreen()}</div>\n          </div>\n        </Drawer.Content>\n      </Drawer.Portal>\n    </Drawer.Root>\n  );\n}\n\n/**\n * Hook that returns `true` when the viewport width is considered desktop-sized.\n * The default breakpoint is 1024 px (iPad landscape and larger).\n */\nfunction useIsDesktop(breakpoint: number = 768) {\n  const isWeb = Platform.OS === 'web';\n\n  const [isDesktop, setIsDesktop] = React.useState<boolean>(() => {\n    if (!isWeb || typeof window === 'undefined') return false;\n    return window.matchMedia(`(min-width: ${breakpoint}px)`).matches;\n  });\n\n  React.useEffect(() => {\n    if (!isWeb || typeof window === 'undefined') return;\n\n    const mql = window.matchMedia(`(min-width: ${breakpoint}px)`);\n    const listener = (e: MediaQueryListEvent) => setIsDesktop(e.matches);\n\n    mql.addEventListener('change', listener);\n\n    // Ensure state is current\n    setIsDesktop(mql.matches);\n\n    return () => {\n      mql.removeEventListener('change', listener);\n    };\n  }, [breakpoint, isWeb]);\n\n  return isDesktop;\n}\n"]}