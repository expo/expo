{"version":3,"file":"StackToolbarMenu.js","sourceRoot":"","sources":["../../../../src/layouts/stack-utils/toolbar/StackToolbarMenu.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\nimport type {\n  NativeStackHeaderItemMenu,\n  NativeStackHeaderItemMenuAction,\n  NativeStackHeaderItemMenuSubmenu,\n} from '@react-navigation/native-stack';\nimport type { ImageRef } from 'expo-image';\nimport { Children, useId, useMemo, type ReactNode } from 'react';\nimport {\n  StyleSheet,\n  type ColorValue,\n  type ImageSourcePropType,\n  type StyleProp,\n  type TextStyle,\n} from 'react-native';\nimport type { SFSymbol } from 'sf-symbols-typescript';\n\nimport { useToolbarPlacement } from './context';\nimport {\n  convertStackHeaderSharedPropsToRNSharedHeaderItem,\n  type StackHeaderItemSharedProps,\n} from './shared';\nimport { StackToolbarLabel, StackToolbarIcon, StackToolbarBadge } from './toolbar-primitives';\nimport { LinkMenuAction } from '../../../link/elements';\nimport { NativeLinkPreviewAction } from '../../../link/preview/native';\nimport {\n  filterAllowedChildrenElements,\n  getFirstChildOfType,\n  isChildOfType,\n} from '../../../utils/children';\n\n/**\n * Computes the label and menu title from children and title prop.\n *\n * - If only `title` prop is provided, it is used for both the label (button text) and menu title\n * - If only `.Label` child is provided, it is used for the label and the menu title is an empty string\n * - If both `.Label` child and `title` prop are provided. `.Label` is used for the label, and `title` is used for the menu title\n */\nfunction computeMenuLabelAndTitle(\n  children: ReactNode,\n  title: string | undefined\n): { label: string; menuTitle: string } {\n  const labelChild = getFirstChildOfType(children, StackToolbarLabel);\n  const labelFromChild = labelChild?.props.children;\n  return {\n    label: labelFromChild ?? title ?? '',\n    menuTitle: title ?? '',\n  };\n}\n\nexport interface StackToolbarMenuProps {\n  accessibilityLabel?: string;\n  accessibilityHint?: string;\n  /**\n   * Menu content - can include icons, labels, badges and menu actions.\n   *\n   * @example\n   * ```tsx\n   * <Stack.Toolbar.Menu>\n   *   <Stack.Toolbar.Icon sfSymbol=\"ellipsis.circle\" />\n   *   <Stack.Toolbar.Label>Options</Stack.Toolbar.Label>\n   *   <Stack.Toolbar.MenuAction onPress={() => {}}>Action 1</Stack.Toolbar.MenuAction>\n   * </Stack.Toolbar.Menu>\n   * ```\n   */\n  children?: ReactNode;\n  /**\n   * If `true`, the menu item will be displayed as destructive.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenuelement/attributes/destructive) for more information.\n   */\n  destructive?: boolean;\n  disabled?: boolean;\n  // TODO(@ubax): Add useImage support in a follow-up PR.\n  /**\n   * Image to display for the menu item.\n   *\n   * > **Note**: This prop is only supported in toolbar with `placement=\"bottom\"`.\n   */\n  image?: ImageRef;\n  /**\n   * Whether to hide the shared background.\n   *\n   * @see [Official Apple documentation](https://developer.apple.com/documentation/uikit/uibarbuttonitem/hidessharedbackground) for more information.\n   *\n   * @platform iOS 26+\n   */\n  hidesSharedBackground?: boolean;\n  /**\n   * Whether the menu should be hidden.\n   *\n   * @default false\n   */\n  hidden?: boolean;\n  /**\n   * Icon for the menu item.\n   *\n   * Can be an SF Symbol name or an image source.\n   *\n   * > **Note**: When used in `placement=\"bottom\"`, only string SFSymbols are supported. Use the `image` prop to provide custom images.\n   */\n  icon?: StackHeaderItemSharedProps['icon'];\n  /**\n   * Controls how image-based icons are rendered on iOS.\n   *\n   * - `'template'`: iOS applies tint color to the icon (useful for monochrome icons)\n   * - `'original'`: Preserves original icon colors (useful for multi-color icons)\n   *\n   * **Default behavior:**\n   * - If `tintColor` is specified, defaults to `'template'`\n   * - If no `tintColor`, defaults to `'original'`\n   *\n   * This prop only affects image-based icons (not SF Symbols).\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uiimage/renderingmode-swift.enum) for more information.\n   *\n   * @platform ios\n   */\n  iconRenderingMode?: 'template' | 'original';\n  /**\n   * If `true`, the menu will be displayed inline.\n   * This means that the menu will not be collapsed\n   *\n   * > **Note**: Inline menus are only supported in submenus.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenu/options-swift.struct/displayinline) for more information.\n   */\n  inline?: boolean;\n  /**\n   * If `true`, the menu will be displayed as a palette.\n   * This means that the menu will be displayed as one row\n   *\n   * > **Note**: Palette menus are only supported in submenus.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenu/options-swift.struct/displayaspalette) for more information.\n   */\n  palette?: boolean;\n  /**\n   * Whether to separate the background of this item from other header items.\n   *\n   * @default false\n   */\n  separateBackground?: boolean;\n  /**\n   * Style for the label of the header item.\n   */\n  style?: StackHeaderItemSharedProps['style'];\n  /**\n   * The tint color to apply to the button item\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uibarbuttonitem/tintcolor) for more information.\n   */\n  tintColor?: StackHeaderItemSharedProps['tintColor'];\n  /**\n   * Optional title to show on top of the menu.\n   */\n  title?: string;\n  /**\n   * @default 'plain'\n   */\n  variant?: StackHeaderItemSharedProps['variant'];\n  // TODO(@ubax): Add elementSize support in react-native-screens for header menus.\n  /**\n   * The preferred size of the menu elements.\n   *\n   * > **Note**: This prop is only supported in `Stack.Toolbar.Bottom`.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenu/preferredelementsize) for more information.\n   *\n   * @platform iOS 16.0+\n   */\n  elementSize?: 'auto' | 'small' | 'medium' | 'large';\n}\n\n/**\n * Use as `Stack.Toolbar.Menu` to provide menus in iOS toolbar.\n * It accepts `Stack.Toolbar.MenuAction` and nested `Stack.Toolbar.Menu`\n * elements. Menu can be configured using both component props and child\n * elements.\n *\n * @example\n * ```tsx\n * import { Stack } from 'expo-router';\n * import { Alert } from 'react-native';\n *\n * export default function Page() {\n *   return (\n *     <>\n *       <Stack.Toolbar placement=\"right\">\n *         <Stack.Toolbar.Menu icon=\"ellipsis.circle\">\n *           <Stack.Toolbar.MenuAction onPress={() => Alert.alert('Action pressed!')}>\n *             Action 1\n *           </Stack.Toolbar.MenuAction>\n *         </Stack.Toolbar.Menu>\n *       </Stack.Toolbar>\n *       <ScreenContent />\n *     </>\n *   );\n * }\n * ```\n *\n * @see [Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/menus) for more information about menus on iOS.\n *\n * @platform ios\n */\nexport const StackToolbarMenu: React.FC<StackToolbarMenuProps> = (props) => {\n  const placement = useToolbarPlacement();\n\n  if (placement !== 'bottom') {\n    // For placement other than bottom, this component will not render, and should be\n    // converted to RN header item using convertStackToolbarMenuPropsToRNHeaderItem.\n    // So if we reach here, it means we're not inside a toolbar or something else is wrong.\n    throw new Error('Stack.Toolbar.Menu must be used inside a Stack.Toolbar');\n  }\n\n  const validChildren = useMemo(\n    () => filterAllowedChildrenElements(props.children, ALLOWED_CHILDREN),\n    [props.children]\n  );\n\n  const sharedProps = convertStackToolbarMenuPropsToRNHeaderItem(props);\n\n  const computedLabel = sharedProps?.label;\n  const computedMenuTitle = sharedProps?.menu?.title;\n  const icon = sharedProps?.icon?.type === 'sfSymbol' ? sharedProps.icon.name : undefined;\n\n  if (process.env.NODE_ENV !== 'production') {\n    const allChildren = Children.toArray(props.children);\n    if (allChildren.length !== validChildren.length) {\n      throw new Error(\n        `Stack.Toolbar.Menu only accepts Stack.Toolbar.Menu, Stack.Toolbar.MenuAction, Stack.Toolbar.Label, Stack.Toolbar.Icon, and Stack.Toolbar.Badge as its children.`\n      );\n    }\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    const hasBadge = getFirstChildOfType(props.children, StackToolbarBadge);\n    if (hasBadge) {\n      console.warn(\n        'Stack.Toolbar.Badge is not supported in bottom toolbar (iOS limitation). The badge will be ignored.'\n      );\n    }\n  }\n\n  // TODO(@ubax): Handle image loading using useImage in a follow-up PR.\n  return (\n    <NativeToolbarMenu\n      {...props}\n      icon={icon}\n      image={props.image}\n      imageRenderingMode={props.iconRenderingMode}\n      label={computedLabel}\n      title={computedMenuTitle}\n      children={validChildren}\n    />\n  );\n};\n\nexport function convertStackToolbarMenuPropsToRNHeaderItem(\n  props: StackToolbarMenuProps\n): NativeStackHeaderItemMenu | undefined {\n  if (props.hidden) {\n    return undefined;\n  }\n  const { title, ...rest } = props;\n  const actions = Children.toArray(props.children).filter(\n    (child) =>\n      isChildOfType(child, StackToolbarMenuAction) || isChildOfType(child, StackToolbarMenu)\n  );\n\n  const { label: computedLabel, menuTitle: computedMenuTitle } = computeMenuLabelAndTitle(\n    props.children,\n    title\n  );\n\n  const sharedProps = convertStackHeaderSharedPropsToRNSharedHeaderItem(rest);\n\n  const item: NativeStackHeaderItemMenu = {\n    ...sharedProps,\n    label: computedLabel,\n    type: 'menu',\n    menu: {\n      multiselectable: true,\n      items: actions\n        .map((action) => {\n          if (isChildOfType(action, StackToolbarMenu)) {\n            return convertStackToolbarSubmenuMenuPropsToRNHeaderItem(action.props);\n          }\n          return convertStackToolbarMenuActionPropsToRNHeaderItem(action.props);\n        })\n        .filter((i) => !!i),\n    },\n  };\n  if (computedMenuTitle) {\n    item.menu.title = computedMenuTitle;\n  }\n\n  return item;\n}\n\nfunction convertStackToolbarSubmenuMenuPropsToRNHeaderItem(\n  props: StackToolbarMenuProps\n): NativeStackHeaderItemMenuSubmenu | undefined {\n  if (props.hidden) {\n    return undefined;\n  }\n  const sharedProps = convertStackHeaderSharedPropsToRNSharedHeaderItem(props);\n  const actions = Children.toArray(props.children).filter(\n    (child) =>\n      isChildOfType(child, StackToolbarMenuAction) || isChildOfType(child, StackToolbarMenu)\n  );\n\n  const item: NativeStackHeaderItemMenuSubmenu = {\n    type: 'submenu',\n    items: actions\n      .map((action) => {\n        if (isChildOfType(action, StackToolbarMenu)) {\n          return convertStackToolbarSubmenuMenuPropsToRNHeaderItem(action.props);\n        }\n        return convertStackToolbarMenuActionPropsToRNHeaderItem(action.props);\n      })\n      .filter((i) => !!i),\n    label: sharedProps.label || props.title || '',\n    multiselectable: true,\n  };\n\n  if (props.inline !== undefined) {\n    item.inline = props.inline;\n  }\n  if (props.palette !== undefined) {\n    item.layout = props.palette ? 'palette' : 'default';\n  }\n  if (props.destructive !== undefined) {\n    item.destructive = props.destructive;\n  }\n  // TODO: Add elementSize to react-native-screens\n\n  if (sharedProps.icon) {\n    // Only SF Symbols are supported in submenu icons\n    // TODO(@ubax): Add support for other images in react-native-screens\n    if (sharedProps.icon.type === 'sfSymbol') {\n      item.icon = sharedProps.icon;\n    } else {\n      console.warn(\n        'When Icon is used inside Stack.Toolbar.Menu used as a submenu, only sfSymbol icons are supported. This is a limitation of React Native Screens.'\n      );\n    }\n  }\n\n  return item;\n}\n\nexport interface StackToolbarMenuActionProps {\n  /**\n   * Can be an Icon, Label or string title.\n   */\n  children?: ReactNode;\n  /**\n   * If `true`, the menu item will be disabled and not selectable.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenuelement/attributes/disabled) for more information.\n   */\n  disabled?: boolean;\n  icon?: SFSymbol | ImageSourcePropType;\n  // TODO(@ubax): Add useImage support in a follow-up PR.\n  /**\n   * Image to display for the menu action.\n   *\n   * > **Note**: This prop is only supported in `Stack.Toolbar.Bottom`.\n   */\n  image?: ImageRef;\n  /**\n   * Controls how image-based icons are rendered on iOS.\n   *\n   * - `'template'`: iOS applies tint color to the icon (useful for monochrome icons)\n   * - `'original'`: Preserves original icon colors (useful for multi-color icons)\n   *\n   * **Default behavior:**\n   * - If `tintColor` is specified, defaults to `'template'`\n   * - If no `tintColor`, defaults to `'original'`\n   *\n   * This prop only affects image-based icons (not SF Symbols).\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uiimage/renderingmode-swift.enum) for more information.\n   *\n   * @platform ios\n   */\n  iconRenderingMode?: 'template' | 'original';\n  /**\n   * If `true`, the menu item will be displayed as destructive.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenuelement/attributes/destructive) for more information.\n   */\n  destructive?: boolean;\n  /**\n   * If `true`, the menu will be kept presented after the action is selected.\n   *\n   * This is marked as unstable, because when action is selected it will recreate the menu,\n   * which will close all opened submenus and reset the scroll position.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenuelement/attributes/keepsmenupresented) for more information.\n   */\n  unstable_keepPresented?: boolean;\n  /**\n   * If `true`, the menu item will be displayed as selected.\n   */\n  isOn?: boolean;\n  onPress?: () => void;\n  /**\n   * An elaborated title that explains the purpose of the action.\n   */\n  discoverabilityLabel?: string;\n  /**\n   * An optional subtitle for the menu item.\n   *\n   * @see [Apple documentation](https://developer.apple.com/documentation/uikit/uimenuelement/subtitle) for more information.\n   */\n  subtitle?: string;\n  hidden?: boolean;\n}\n\n/**\n * An action item for a `Stack.Toolbar.Menu`.\n *\n * @example\n * ```tsx\n * import { Stack } from 'expo-router';\n *\n * export default function Page() {\n *   return (\n *     <>\n *       <Stack.Toolbar placement=\"right\">\n *         <Stack.Toolbar.Menu icon=\"ellipsis.circle\">\n *           <Stack.Toolbar.MenuAction onPress={() => alert('Action pressed!')}>\n *             Action 1\n *           </Stack.Toolbar.MenuAction>\n *         </Stack.Toolbar.Menu>\n *       </Stack.Toolbar>\n *       <ScreenContent />\n *     </>\n *   );\n * }\n * ```\n *\n * @platform ios\n */\nexport const StackToolbarMenuAction: React.FC<StackToolbarMenuActionProps> = (props) => {\n  const placement = useToolbarPlacement();\n\n  if (placement !== 'bottom') {\n    throw new Error('Stack.Toolbar.MenuAction must be used inside a Stack.Toolbar.Menu');\n  }\n\n  // TODO(@ubax): Handle image loading using useImage in a follow-up PR.\n  const icon = typeof props.icon === 'string' ? props.icon : undefined;\n  return (\n    <NativeToolbarMenuAction\n      {...props}\n      icon={icon}\n      image={props.image}\n      imageRenderingMode={props.iconRenderingMode}\n    />\n  );\n};\n\nexport function convertStackToolbarMenuActionPropsToRNHeaderItem(\n  props: StackToolbarMenuActionProps\n): NativeStackHeaderItemMenuAction {\n  const { children, isOn, unstable_keepPresented, icon, ...rest } = props;\n  const sharedProps = convertStackHeaderSharedPropsToRNSharedHeaderItem(props);\n  const item: NativeStackHeaderItemMenuAction = {\n    ...rest,\n    type: 'action',\n    label: sharedProps.label,\n    state: isOn ? 'on' : 'off',\n    onPress: props.onPress ?? (() => {}),\n  };\n  if (unstable_keepPresented !== undefined) {\n    item.keepsMenuPresented = unstable_keepPresented;\n  }\n  if (sharedProps.icon) {\n    // Only SF Symbols are supported in submenu icons\n    // TODO(@ubax): Add support for other images in react-native-screens\n    if (sharedProps.icon.type === 'sfSymbol') {\n      item.icon = sharedProps.icon;\n    } else {\n      console.warn(\n        'When Icon is used inside Stack.Toolbar.MenuAction, only sfSymbol icons are supported. This is a limitation of React Native Screens.'\n      );\n    }\n  }\n  return item;\n}\n\n// #region NativeToolbarMenu\n\ninterface NativeToolbarMenuProps {\n  accessibilityLabel?: string;\n  accessibilityHint?: string;\n  children?: ReactNode;\n  subtitle?: string;\n  destructive?: boolean;\n  disabled?: boolean;\n  hidden?: boolean;\n  hidesSharedBackground?: boolean;\n  icon?: SFSymbol;\n  // TODO(@ubax): Add useImage support in a follow-up PR.\n  /**\n   * Image to display for the menu item.\n   */\n  image?: ImageRef;\n  imageRenderingMode?: 'template' | 'original';\n  inline?: boolean;\n  label?: string;\n  palette?: boolean;\n  separateBackground?: boolean;\n  style?: StyleProp<TextStyle>;\n  title?: string;\n  tintColor?: ColorValue;\n  variant?: 'plain' | 'done' | 'prominent';\n  elementSize?: 'auto' | 'small' | 'medium' | 'large';\n}\n\n/**\n * Native toolbar menu component for bottom toolbar.\n * Renders as NativeLinkPreviewAction.\n */\nconst NativeToolbarMenu: React.FC<NativeToolbarMenuProps> = ({\n  accessibilityHint,\n  accessibilityLabel,\n  separateBackground,\n  hidesSharedBackground,\n  palette,\n  inline,\n  hidden,\n  subtitle,\n  title,\n  label,\n  destructive,\n  children,\n  icon,\n  image,\n  imageRenderingMode,\n  tintColor,\n  variant,\n  style,\n  elementSize,\n}) => {\n  const identifier = useId();\n\n  const titleStyle = StyleSheet.flatten(style);\n  const renderingMode = imageRenderingMode ?? (tintColor !== undefined ? 'template' : 'original');\n  return (\n    <NativeLinkPreviewAction\n      sharesBackground={!separateBackground}\n      hidesSharedBackground={hidesSharedBackground}\n      hidden={hidden}\n      icon={icon}\n      // TODO(@ubax): Handle image loading using useImage in a follow-up PR.\n      image={image}\n      imageRenderingMode={renderingMode}\n      destructive={destructive}\n      subtitle={subtitle}\n      accessibilityLabel={accessibilityLabel}\n      accessibilityHint={accessibilityHint}\n      displayAsPalette={palette}\n      displayInline={inline}\n      preferredElementSize={elementSize}\n      tintColor={tintColor}\n      titleStyle={titleStyle}\n      barButtonItemStyle={variant === 'done' ? 'prominent' : variant}\n      title={title ?? ''}\n      label={label}\n      onSelected={() => {}}\n      children={children}\n      identifier={identifier}\n    />\n  );\n};\n\n// #endregion\n\n// #region NativeToolbarMenuAction\n\n/**\n * Native toolbar menu action - reuses LinkMenuAction.\n */\nconst NativeToolbarMenuAction = LinkMenuAction;\n\n// #endregion\n\nconst ALLOWED_CHILDREN = [\n  StackToolbarMenu,\n  StackToolbarMenuAction,\n  NativeToolbarMenu,\n  NativeToolbarMenuAction,\n  StackToolbarLabel,\n  StackToolbarIcon,\n  StackToolbarBadge,\n];\n"]}