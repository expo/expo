{"version":3,"file":"TabRouter.js","sourceRoot":"","sources":["../../src/ui/TabRouter.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  CommonNavigationAction,\n  ParamListBase,\n  TabRouter as RNTabRouter,\n  Router,\n  TabActionType as RNTabActionType,\n  TabNavigationState,\n  TabRouterOptions as RNTabRouterOptions,\n  type StackActionType,\n  type NavigationAction,\n} from '@react-navigation/native';\n\nimport { TriggerMap } from './common';\n\nexport type ExpoTabRouterOptions = RNTabRouterOptions & {\n  triggerMap: TriggerMap;\n};\n\ntype ReplaceAction = Extract<StackActionType, { type: 'REPLACE' }>;\n\nexport type ExpoTabActionType =\n  | RNTabActionType\n  | CommonNavigationAction\n  | ReplaceAction\n  | {\n      type: 'JUMP_TO';\n      source?: string;\n      target?: string;\n      payload: {\n        name: string;\n        resetOnFocus?: boolean;\n        params?: object;\n      };\n    };\n\nexport function ExpoTabRouter(options: ExpoTabRouterOptions) {\n  const rnTabRouter = RNTabRouter(options);\n\n  const router: Router<\n    TabNavigationState<ParamListBase>,\n    ExpoTabActionType | CommonNavigationAction\n  > = {\n    ...rnTabRouter,\n    getStateForAction(state, action, options) {\n      if (isReplaceAction(action)) {\n        action = {\n          ...action,\n          type: 'JUMP_TO',\n        };\n        // Generate the state as if we were using JUMP_TO\n        const nextState = rnTabRouter.getStateForAction(state, action, options);\n\n        if (!nextState || nextState.index === undefined || !Array.isArray(nextState.history)) {\n          return null;\n        }\n\n        // We can assert that nextState is TabNavigationState here, because we checked for index and history above\n        state = nextState as TabNavigationState<ParamListBase>;\n\n        // If the state is valid and we didn't JUMP_TO a single history state,\n        // then remove the previous state.\n        if (state.index !== 0) {\n          const previousIndex = state.index - 1;\n\n          state = {\n            ...state,\n            key: `${state.key}-replace`,\n            // Omit the previous history entry that we are replacing\n            history: [\n              ...state.history.slice(0, previousIndex),\n              ...state.history.splice(state.index),\n            ],\n          };\n        }\n      } else if (action.type !== 'JUMP_TO') {\n        return rnTabRouter.getStateForAction(state, action, options);\n      }\n\n      const route = state.routes.find((route) => route.name === action.payload.name);\n\n      if (!route || !state) {\n        // This shouldn't occur, but lets just hand it off to the next navigator in case.\n        return null;\n      }\n\n      // We should reset if this is the first time visiting the route\n      let shouldReset = !state.history?.some((item) => item.key === route?.key) && !route.state;\n\n      if (!shouldReset && 'resetOnFocus' in action.payload && action.payload.resetOnFocus) {\n        shouldReset = state.routes[state.index ?? 0].key !== route.key;\n      }\n\n      if (shouldReset) {\n        options.routeParamList[route.name] = {\n          ...options.routeParamList[route.name],\n        };\n        state = {\n          ...state,\n          routes: state.routes.map((r) => {\n            if (r.key !== route.key) {\n              return r;\n            }\n            return { ...r, state: undefined };\n          }),\n        };\n        return rnTabRouter.getStateForAction(state, action, options);\n      } else {\n        return rnTabRouter.getStateForRouteFocus(state, route.key);\n      }\n    },\n  };\n\n  return router;\n}\n\nfunction isReplaceAction(action: NavigationAction): action is ReplaceAction {\n  return action.type === 'REPLACE';\n}\n"]}