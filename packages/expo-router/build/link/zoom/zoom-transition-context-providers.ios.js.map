{"version":3,"file":"zoom-transition-context-providers.ios.js","sourceRoot":"","sources":["../../../src/link/zoom/zoom-transition-context-providers.ios.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\n\nimport { useCallback, useId, useMemo, useRef, useState } from 'react';\n\nimport { isZoomTransitionEnabled } from './ZoomTransitionEnabler.ios';\nimport {\n  ZoomTransitionSourceContext,\n  ZoomTransitionTargetContext,\n  type ZoomTransitionSourceContextValueType,\n  type DismissalBoundsRect,\n} from './zoom-transition-context';\nimport type {\n  ZoomTransitionSourceContextProviderProps,\n  ZoomTransitionTargetContextProviderProps,\n} from './zoom-transition-context-providers.types';\nimport {\n  getInternalExpoRouterParams,\n  INTERNAL_EXPO_ROUTER_ZOOM_TRANSITION_SCREEN_ID_PARAM_NAME,\n  INTERNAL_EXPO_ROUTER_ZOOM_TRANSITION_SOURCE_ID_PARAM_NAME,\n} from '../../navigationParams';\nimport { shouldLinkExternally } from '../../utils/url';\nimport { useIsPreview } from '../preview/PreviewRouteContext';\n\nexport function ZoomTransitionSourceContextProvider({\n  children,\n  linkProps,\n}: ZoomTransitionSourceContextProviderProps) {\n  const { href, asChild } = linkProps;\n  const isExternalHref =\n    typeof href === 'string' ? shouldLinkExternally(href) : shouldLinkExternally(href.pathname);\n  const numberOfSources = useRef(0);\n  const [hasZoomSource, setHasZoomSource] = useState(false);\n\n  const zoomTransitionId = useId();\n\n  const addSource = useCallback(() => {\n    if (!isZoomTransitionEnabled()) {\n      throw new Error('[expo-router] Zoom transitions are not enabled.');\n    }\n    if (numberOfSources.current >= 1) {\n      throw new Error(\n        '[expo-router] Only one Link.ZoomTransitionSource can be used within a single Link component.'\n      );\n    }\n    if (!asChild) {\n      throw new Error(\n        '[expo-router] Link must be used with `asChild` prop to enable zoom transitions.'\n      );\n    }\n    if (isExternalHref) {\n      throw new Error('[expo-router] Zoom transitions can only be used with internal links.');\n    }\n    numberOfSources.current += 1;\n    setHasZoomSource(true);\n  }, [asChild, isExternalHref]);\n\n  const removeSource = useCallback(() => {\n    numberOfSources.current -= 1;\n    if (numberOfSources.current <= 0) {\n      setHasZoomSource(false);\n    }\n  }, []);\n\n  const value = useMemo<ZoomTransitionSourceContextValueType>(\n    () => ({\n      identifier: zoomTransitionId,\n      hasZoomSource,\n      addSource,\n      removeSource,\n    }),\n    [zoomTransitionId, hasZoomSource, addSource, removeSource]\n  );\n\n  return <ZoomTransitionSourceContext value={value}>{children}</ZoomTransitionSourceContext>;\n}\n\nexport function ZoomTransitionTargetContextProvider({\n  route,\n  children,\n}: ZoomTransitionTargetContextProviderProps) {\n  const [dismissalBoundsRect, setDismissalBoundsRect] = useState<DismissalBoundsRect | null>(null);\n  const isPreview = useIsPreview();\n  if (\n    isZoomTransitionEnabled() &&\n    !isPreview &&\n    route &&\n    typeof route === 'object' &&\n    'params' in route &&\n    typeof route.params === 'object' &&\n    'key' in route &&\n    typeof route.key === 'string'\n  ) {\n    const params = route.params ?? {};\n    const internalParams = getInternalExpoRouterParams(params);\n    const zoomTransitionId =\n      internalParams[INTERNAL_EXPO_ROUTER_ZOOM_TRANSITION_SOURCE_ID_PARAM_NAME];\n    const zoomTransitionScreenId =\n      internalParams[INTERNAL_EXPO_ROUTER_ZOOM_TRANSITION_SCREEN_ID_PARAM_NAME];\n    const hasZoomTransition = !!zoomTransitionId && zoomTransitionScreenId === route.key;\n    if (hasZoomTransition && typeof zoomTransitionId === 'string') {\n      return (\n        <ZoomTransitionTargetContext\n          value={{\n            identifier: zoomTransitionId,\n            dismissalBoundsRect,\n            setDismissalBoundsRect,\n          }}>\n          {children}\n        </ZoomTransitionTargetContext>\n      );\n    }\n  }\n  return children;\n}\n"]}