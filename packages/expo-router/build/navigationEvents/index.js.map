{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/navigationEvents/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { PageWillRender, PageFocusedEvent, PageBlurredEvent, PageRemoved } from './types';\n\nexport { PageWillRender, PageFocusedEvent, PageBlurredEvent, PageRemoved };\n\nexport type AnalyticsEvent = PageWillRender | PageFocusedEvent | PageBlurredEvent | PageRemoved;\n\nconst availableEvents: AnalyticsEvent['type'][] = [\n  'pageWillRender',\n  'pageFocused',\n  'pageBlurred',\n  'pageRemoved',\n];\n\ntype EventTypeName = AnalyticsEvent['type'];\ntype Payload<T extends EventTypeName> = Omit<Extract<AnalyticsEvent, { type: T }>, 'type'>;\n\nconst subscribers: {\n  [K in EventTypeName]?: Set<(event: Payload<K>) => void>;\n} = {};\n\nfunction addListener<EventType extends EventTypeName>(\n  eventType: EventType,\n  callback: (event: Payload<EventType>) => void\n) {\n  if (!availableEvents.includes(eventType)) {\n    throw new Error(`Unsupported event type: ${eventType}`);\n  }\n  if (!subscribers[eventType]) {\n    subscribers[eventType] = new Set() as (typeof subscribers)[EventType];\n  }\n  subscribers[eventType]!.add(callback);\n  return () => {\n    subscribers[eventType]!.delete(callback);\n    if (subscribers[eventType]!.size === 0) {\n      delete subscribers[eventType];\n    }\n  };\n}\n\nexport function emit<EventType extends EventTypeName>(type: EventType, event: Payload<EventType>) {\n  const subscribersForEvent = subscribers[type];\n  if (subscribersForEvent) {\n    for (const callback of subscribersForEvent) {\n      callback(event);\n    }\n  }\n}\n\nlet enabled = false;\n\nlet currentPathname: string | undefined = undefined;\nlet currentParams: Record<string, string> | undefined = undefined;\nlet currentPathnameListener: ReturnType<typeof addListener> | undefined = undefined;\n\nexport const unstable_navigationEvents = {\n  addListener,\n  emit,\n  enable: () => {\n    enabled = true;\n  },\n  isEnabled: () => {\n    return enabled;\n  },\n  saveCurrentPathname: () => {\n    if (!enabled || currentPathnameListener) return;\n    currentPathnameListener = addListener('pageFocused', (event) => {\n      currentPathname = event.pathname;\n      currentParams = event.params;\n    });\n  },\n  get currentPathname() {\n    return currentPathname;\n  },\n  get currentParams() {\n    return currentParams;\n  },\n};\n\nif (globalThis.expo) {\n  globalThis.expo.router = globalThis.expo.router || {};\n\n  if (!('navigationEvents' in globalThis.expo.router)) {\n    Object.defineProperties(globalThis.expo.router, {\n      navigationEvents: {\n        get() {\n          return unstable_navigationEvents;\n        },\n        enumerable: true,\n      },\n      currentPathname: {\n        get() {\n          return currentPathname;\n        },\n        enumerable: true,\n      },\n      currentParams: {\n        get() {\n          return currentParams;\n        },\n        enumerable: true,\n      },\n    });\n  }\n}\n"]}