// Copyright 2022-present 650 Industries. All rights reserved.

extension UIColor: ConvertibleArgument {
  public static func convert(from value: Any?) throws -> Self {
    if let value = value as? String {
      if let namedColorComponents = namedColors[value] {
        return uiColorWithComponents(namedColorComponents)
      }
      return try Conversions.toColor(hexString: value) as! Self
    }
    if let components = value as? [Double] {
      return uiColorWithComponents(components) as! Self
    }
    if let value = value as? Int {
      return try Conversions.toColor(argb: UInt64(value)) as! Self
    }
    throw Conversions.ConvertingException<UIColor>(value)
  }
}

extension CGColor: ConvertibleArgument {
  public static func convert(from value: Any?) throws -> Self {
    do {
      return try UIColor.convert(from: value).cgColor as! Self
    } catch _ as Conversions.ConvertingException<UIColor> {
      // Rethrow `ConvertingError` with proper type
      throw Conversions.ConvertingException<CGColor>(value)
    }
  }
}

private func uiColorWithComponents<ColorType: UIColor>(_ components: [Double]) -> ColorType {
  let alpha = components.count > 3 ? components[3] : 1.0
  return UIColor(red: components[0], green: components[1], blue: components[2], alpha: alpha) as! ColorType
}

/**
 Color components for named colors following the [CSS3/SVG specification](https://www.w3.org/TR/css-color-3/#svg-color)
 and additionally the transparent color.
 */
private let namedColors: [String: [Double]] = [
  "aliceblue": [0.9411764705882353, 0.9725490196078431, 1.0, 1.0],
  "antiquewhite": [0.9803921568627451, 0.9215686274509803, 0.8431372549019608, 1.0],
  "aqua": [0.0, 1.0, 1.0, 1.0],
  "aquamarine": [0.4980392156862745, 1.0, 0.8313725490196079, 1.0],
  "azure": [0.9411764705882353, 1.0, 1.0, 1.0],
  "beige": [0.9607843137254902, 0.9607843137254902, 0.8627450980392157, 1.0],
  "bisque": [1.0, 0.8941176470588236, 0.7686274509803922, 1.0],
  "black": [0.0, 0.0, 0.0, 1.0],
  "blanchedalmond": [1.0, 0.9215686274509803, 0.803921568627451, 1.0],
  "blue": [0.0, 0.0, 1.0, 1.0],
  "blueviolet": [0.5411764705882353, 0.16862745098039217, 0.8862745098039215, 1.0],
  "brown": [0.6470588235294118, 0.16470588235294117, 0.16470588235294117, 1.0],
  "burlywood": [0.8705882352941177, 0.7215686274509804, 0.5294117647058824, 1.0],
  "cadetblue": [0.37254901960784315, 0.6196078431372549, 0.6274509803921569, 1.0],
  "chartreuse": [0.4980392156862745, 1.0, 0.0, 1.0],
  "chocolate": [0.8235294117647058, 0.4117647058823529, 0.11764705882352941, 1.0],
  "coral": [1.0, 0.4980392156862745, 0.3137254901960784, 1.0],
  "cornflowerblue": [0.39215686274509803, 0.5843137254901961, 0.9294117647058824, 1.0],
  "cornsilk": [1.0, 0.9725490196078431, 0.8627450980392157, 1.0],
  "crimson": [0.8627450980392157, 0.0784313725490196, 0.23529411764705882, 1.0],
  "cyan": [0.0, 1.0, 1.0, 1.0],
  "darkblue": [0.0, 0.0, 0.5450980392156862, 1.0],
  "darkcyan": [0.0, 0.5450980392156862, 0.5450980392156862, 1.0],
  "darkgoldenrod": [0.7215686274509804, 0.5254901960784314, 0.043137254901960784, 1.0],
  "darkgray": [0.6627450980392157, 0.6627450980392157, 0.6627450980392157, 1.0],
  "darkgreen": [0.0, 0.39215686274509803, 0.0, 1.0],
  "darkgrey": [0.6627450980392157, 0.6627450980392157, 0.6627450980392157, 1.0],
  "darkkhaki": [0.7411764705882353, 0.7176470588235294, 0.4196078431372549, 1.0],
  "darkmagenta": [0.5450980392156862, 0.0, 0.5450980392156862, 1.0],
  "darkolivegreen": [0.3333333333333333, 0.4196078431372549, 0.1843137254901961, 1.0],
  "darkorange": [1.0, 0.5490196078431373, 0.0, 1.0],
  "darkorchid": [0.6, 0.19607843137254902, 0.8, 1.0],
  "darkred": [0.5450980392156862, 0.0, 0.0, 1.0],
  "darksalmon": [0.9137254901960784, 0.5882352941176471, 0.47843137254901963, 1.0],
  "darkseagreen": [0.5607843137254902, 0.7372549019607844, 0.5607843137254902, 1.0],
  "darkslateblue": [0.2823529411764706, 0.23921568627450981, 0.5450980392156862, 1.0],
  "darkslategray": [0.1843137254901961, 0.30980392156862746, 0.30980392156862746, 1.0],
  "darkslategrey": [0.1843137254901961, 0.30980392156862746, 0.30980392156862746, 1.0],
  "darkturquoise": [0.0, 0.807843137254902, 0.8196078431372549, 1.0],
  "darkviolet": [0.5803921568627451, 0.0, 0.8274509803921568, 1.0],
  "deeppink": [1.0, 0.0784313725490196, 0.5764705882352941, 1.0],
  "deepskyblue": [0.0, 0.7490196078431373, 1.0, 1.0],
  "dimgray": [0.4117647058823529, 0.4117647058823529, 0.4117647058823529, 1.0],
  "dimgrey": [0.4117647058823529, 0.4117647058823529, 0.4117647058823529, 1.0],
  "dodgerblue": [0.11764705882352941, 0.5647058823529412, 1.0, 1.0],
  "firebrick": [0.6980392156862745, 0.13333333333333333, 0.13333333333333333, 1.0],
  "floralwhite": [1.0, 0.9803921568627451, 0.9411764705882353, 1.0],
  "forestgreen": [0.13333333333333333, 0.5450980392156862, 0.13333333333333333, 1.0],
  "fuchsia": [1.0, 0.0, 1.0, 1.0],
  "gainsboro": [0.8627450980392157, 0.8627450980392157, 0.8627450980392157, 1.0],
  "ghostwhite": [0.9725490196078431, 0.9725490196078431, 1.0, 1.0],
  "gold": [1.0, 0.8431372549019608, 0.0, 1.0],
  "goldenrod": [0.8549019607843137, 0.6470588235294118, 0.12549019607843137, 1.0],
  "gray": [0.5019607843137255, 0.5019607843137255, 0.5019607843137255, 1.0],
  "green": [0.0, 0.5019607843137255, 0.0, 1.0],
  "greenyellow": [0.6784313725490196, 1.0, 0.1843137254901961, 1.0],
  "grey": [0.5019607843137255, 0.5019607843137255, 0.5019607843137255, 1.0],
  "honeydew": [0.9411764705882353, 1.0, 0.9411764705882353, 1.0],
  "hotpink": [1.0, 0.4117647058823529, 0.7058823529411765, 1.0],
  "indianred": [0.803921568627451, 0.3607843137254902, 0.3607843137254902, 1.0],
  "indigo": [0.29411764705882354, 0.0, 0.5098039215686274, 1.0],
  "ivory": [1.0, 1.0, 0.9411764705882353, 1.0],
  "khaki": [0.9411764705882353, 0.9019607843137255, 0.5490196078431373, 1.0],
  "lavender": [0.9019607843137255, 0.9019607843137255, 0.9803921568627451, 1.0],
  "lavenderblush": [1.0, 0.9411764705882353, 0.9607843137254902, 1.0],
  "lawngreen": [0.48627450980392156, 0.9882352941176471, 0.0, 1.0],
  "lemonchiffon": [1.0, 0.9803921568627451, 0.803921568627451, 1.0],
  "lightblue": [0.6784313725490196, 0.8470588235294118, 0.9019607843137255, 1.0],
  "lightcoral": [0.9411764705882353, 0.5019607843137255, 0.5019607843137255, 1.0],
  "lightcyan": [0.8784313725490196, 1.0, 1.0, 1.0],
  "lightgoldenrodyellow": [0.9803921568627451, 0.9803921568627451, 0.8235294117647058, 1.0],
  "lightgray": [0.8274509803921568, 0.8274509803921568, 0.8274509803921568, 1.0],
  "lightgreen": [0.5647058823529412, 0.9333333333333333, 0.5647058823529412, 1.0],
  "lightgrey": [0.8274509803921568, 0.8274509803921568, 0.8274509803921568, 1.0],
  "lightpink": [1.0, 0.7137254901960784, 0.7568627450980392, 1.0],
  "lightsalmon": [1.0, 0.6274509803921569, 0.47843137254901963, 1.0],
  "lightseagreen": [0.12549019607843137, 0.6980392156862745, 0.6666666666666666, 1.0],
  "lightskyblue": [0.5294117647058824, 0.807843137254902, 0.9803921568627451, 1.0],
  "lightslategray": [0.4666666666666667, 0.5333333333333333, 0.6, 1.0],
  "lightslategrey": [0.4666666666666667, 0.5333333333333333, 0.6, 1.0],
  "lightsteelblue": [0.6901960784313725, 0.7686274509803922, 0.8705882352941177, 1.0],
  "lightyellow": [1.0, 1.0, 0.8784313725490196, 1.0],
  "lime": [0.0, 1.0, 0.0, 1.0],
  "limegreen": [0.19607843137254902, 0.803921568627451, 0.19607843137254902, 1.0],
  "linen": [0.9803921568627451, 0.9411764705882353, 0.9019607843137255, 1.0],
  "magenta": [1.0, 0.0, 1.0, 1.0],
  "maroon": [0.5019607843137255, 0.0, 0.0, 1.0],
  "mediumaquamarine": [0.4, 0.803921568627451, 0.6666666666666666, 1.0],
  "mediumblue": [0.0, 0.0, 0.803921568627451, 1.0],
  "mediumorchid": [0.7294117647058823, 0.3333333333333333, 0.8274509803921568, 1.0],
  "mediumpurple": [0.5764705882352941, 0.4392156862745098, 0.8588235294117647, 1.0],
  "mediumseagreen": [0.23529411764705882, 0.7019607843137254, 0.44313725490196076, 1.0],
  "mediumslateblue": [0.4823529411764706, 0.40784313725490196, 0.9333333333333333, 1.0],
  "mediumspringgreen": [0.0, 0.9803921568627451, 0.6039215686274509, 1.0],
  "mediumturquoise": [0.2823529411764706, 0.8196078431372549, 0.8, 1.0],
  "mediumvioletred": [0.7803921568627451, 0.08235294117647059, 0.5215686274509804, 1.0],
  "midnightblue": [0.09803921568627451, 0.09803921568627451, 0.4392156862745098, 1.0],
  "mintcream": [0.9607843137254902, 1.0, 0.9803921568627451, 1.0],
  "mistyrose": [1.0, 0.8941176470588236, 0.8823529411764706, 1.0],
  "moccasin": [1.0, 0.8941176470588236, 0.7098039215686275, 1.0],
  "navajowhite": [1.0, 0.8705882352941177, 0.6784313725490196, 1.0],
  "navy": [0.0, 0.0, 0.5019607843137255, 1.0],
  "oldlace": [0.9921568627450981, 0.9607843137254902, 0.9019607843137255, 1.0],
  "olive": [0.5019607843137255, 0.5019607843137255, 0.0, 1.0],
  "olivedrab": [0.4196078431372549, 0.5568627450980392, 0.13725490196078433, 1.0],
  "orange": [1.0, 0.6470588235294118, 0.0, 1.0],
  "orangered": [1.0, 0.27058823529411763, 0.0, 1.0],
  "orchid": [0.8549019607843137, 0.4392156862745098, 0.8392156862745098, 1.0],
  "palegoldenrod": [0.9333333333333333, 0.9098039215686274, 0.6666666666666666, 1.0],
  "palegreen": [0.596078431372549, 0.984313725490196, 0.596078431372549, 1.0],
  "paleturquoise": [0.6862745098039216, 0.9333333333333333, 0.9333333333333333, 1.0],
  "palevioletred": [0.8588235294117647, 0.4392156862745098, 0.5764705882352941, 1.0],
  "papayawhip": [1.0, 0.9372549019607843, 0.8352941176470589, 1.0],
  "peachpuff": [1.0, 0.8549019607843137, 0.7254901960784313, 1.0],
  "peru": [0.803921568627451, 0.5215686274509804, 0.24705882352941178, 1.0],
  "pink": [1.0, 0.7529411764705882, 0.796078431372549, 1.0],
  "plum": [0.8666666666666667, 0.6274509803921569, 0.8666666666666667, 1.0],
  "powderblue": [0.6901960784313725, 0.8784313725490196, 0.9019607843137255, 1.0],
  "purple": [0.5019607843137255, 0.0, 0.5019607843137255, 1.0],
  "rebeccapurple": [0.4, 0.2, 0.6, 1.0],
  "red": [1.0, 0.0, 0.0, 1.0],
  "rosybrown": [0.7372549019607844, 0.5607843137254902, 0.5607843137254902, 1.0],
  "royalblue": [0.2549019607843137, 0.4117647058823529, 0.8823529411764706, 1.0],
  "saddlebrown": [0.5450980392156862, 0.27058823529411763, 0.07450980392156863, 1.0],
  "salmon": [0.9803921568627451, 0.5019607843137255, 0.4470588235294118, 1.0],
  "sandybrown": [0.9568627450980393, 0.6431372549019608, 0.3764705882352941, 1.0],
  "seagreen": [0.1803921568627451, 0.5450980392156862, 0.3411764705882353, 1.0],
  "seashell": [1.0, 0.9607843137254902, 0.9333333333333333, 1.0],
  "sienna": [0.6274509803921569, 0.3215686274509804, 0.17647058823529413, 1.0],
  "silver": [0.7529411764705882, 0.7529411764705882, 0.7529411764705882, 1.0],
  "skyblue": [0.5294117647058824, 0.807843137254902, 0.9215686274509803, 1.0],
  "slateblue": [0.41568627450980394, 0.35294117647058826, 0.803921568627451, 1.0],
  "slategray": [0.4392156862745098, 0.5019607843137255, 0.5647058823529412, 1.0],
  "slategrey": [0.4392156862745098, 0.5019607843137255, 0.5647058823529412, 1.0],
  "snow": [1.0, 0.9803921568627451, 0.9803921568627451, 1.0],
  "springgreen": [0.0, 1.0, 0.4980392156862745, 1.0],
  "steelblue": [0.27450980392156865, 0.5098039215686274, 0.7058823529411765, 1.0],
  "tan": [0.8235294117647058, 0.7058823529411765, 0.5490196078431373, 1.0],
  "teal": [0.0, 0.5019607843137255, 0.5019607843137255, 1.0],
  "thistle": [0.8470588235294118, 0.7490196078431373, 0.8470588235294118, 1.0],
  "tomato": [1.0, 0.38823529411764707, 0.2784313725490196, 1.0],
  "transparent": [0.0, 0.0, 0.0, 0.0],
  "turquoise": [0.25098039215686274, 0.8784313725490196, 0.8156862745098039, 1.0],
  "violet": [0.9333333333333333, 0.5098039215686274, 0.9333333333333333, 1.0],
  "wheat": [0.9607843137254902, 0.8705882352941177, 0.7019607843137254, 1.0],
  "white": [1.0, 1.0, 1.0, 1.0],
  "whitesmoke": [0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 1.0],
  "yellow": [1.0, 1.0, 0.0, 1.0],
  "yellowgreen": [0.6039215686274509, 0.803921568627451, 0.19607843137254902, 1.0],
]
