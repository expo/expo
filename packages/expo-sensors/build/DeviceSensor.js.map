{"version":3,"file":"DeviceSensor.js","sourceRoot":"","sources":["../src/DeviceSensor.ts"],"names":[],"mappings":"AAAA,OAAO,EAEL,gBAAgB,EAChB,YAAY,EAEZ,QAAQ,GAET,MAAM,mBAAmB,CAAC;AAS3B;;;GAGG;AACH,MAAM,CAAC,OAAO,OAAO,YAAY;IAC/B,aAAa,CAAqB;IAClC,cAAc,CAAe;IAC7B,gBAAgB,CAAS;IACzB,cAAc,CAAS;IAEvB,YAAY,kBAAsC,EAAE,eAAuB;QACzE,IAAI,CAAC,aAAa,GAAG,kBAAkB,CAAC;QACxC,IAAI,CAAC,cAAc,GAAG,IAAI,YAAY,CAAC,kBAAkB,CAAC,CAAC;QAC3D,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;QACxC,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC;IAC1B,CAAC;IAED,WAAW,GAAG,CAAC,QAAqB,EAAgB,EAAE;QACpD,MAAM,YAAY,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;QACtF,YAAY,CAAC,MAAM,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC;QAClE,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,OAAO,YAAY,CAAC;IACtB,CAAC,CAAC;IAEF;;OAEG;IACH,YAAY,GAAG,GAAY,EAAE;QAC3B,OAAO,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC;IACjC,CAAC,CAAC;IAEF;;OAEG;IACH,gBAAgB,GAAG,GAAW,EAAE;QAC9B,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B,CAAC,CAAC;IAEF;;OAEG;IACH,kBAAkB,GAAG,GAAS,EAAE;QAC9B,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC;QACxB,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAChE,CAAC,CAAC;IAEF;;;OAGG;IACH,kBAAkB,GAAG,CAAC,YAA0B,EAAQ,EAAE;QACxD,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC;IACvD,CAAC,CAAC;IAEF;;;OAGG;IACH,iBAAiB,GAAG,CAAC,UAAkB,EAAQ,EAAE;QAC/C,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,iBAAiB,EAAE;YACzC,OAAO,CAAC,IAAI,CAAC,yDAAyD,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC;SACtF;aAAM;YACL,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC;SAClD;IACH,CAAC,CAAC;IAEF;;;OAGG;IACH,gBAAgB,GAAG,KAAK,IAAsB,EAAE;QAC9C,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,EAAE;YACxC,OAAO,KAAK,CAAC;SACd;aAAM;YACL,OAAO,MAAM,IAAI,CAAC,aAAa,CAAC,gBAAgB,EAAE,CAAC;SACpD;IACH,CAAC,CAAC;IAEF;;OAEG;IACH,mBAAmB,GAAG,KAAK,IAAiC,EAAE;QAC5D,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,mBAAmB,EAAE;YAC3C,OAAO,0BAA0B,CAAC;SACnC;aAAM;YACL,OAAO,MAAM,IAAI,CAAC,aAAa,CAAC,mBAAmB,EAAE,CAAC;SACvD;IACH,CAAC,CAAC;IAEF;;OAEG;IACH,uBAAuB,GAAG,KAAK,IAAiC,EAAE;QAChE,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,uBAAuB,EAAE;YAC/C,OAAO,0BAA0B,CAAC;SACnC;aAAM;YACL,OAAO,MAAM,IAAI,CAAC,aAAa,CAAC,uBAAuB,EAAE,CAAC;SAC3D;IACH,CAAC,CAAC;CACH;AAED,MAAM,0BAA0B,GAAuB;IACrD,OAAO,EAAE,IAAI;IACb,OAAO,EAAE,OAAO;IAChB,WAAW,EAAE,IAAI;IACjB,MAAM,EAAE,gBAAgB,CAAC,OAAO;CACjC,CAAC;AAEF,OAAO,EAA4C,gBAAgB,EAAgB,CAAC","sourcesContent":["import {\n  PermissionResponse,\n  PermissionStatus,\n  EventEmitter,\n  Subscription,\n  Platform,\n  PermissionExpiration,\n} from 'expo-modules-core';\n\n/**\n * @hidden\n */\nexport type Listener<E> = (event: E) => void;\n\ntype NativeSensorModule = any;\n\n/**\n * A base class for subscribable sensors. The events emitted by this class are measurements\n * specified by the parameter type `M`.\n */\nexport default class DeviceSensor<M> {\n  _nativeModule: NativeSensorModule;\n  _nativeEmitter: EventEmitter;\n  _nativeEventName: string;\n  _listenerCount: number;\n\n  constructor(nativeSensorModule: NativeSensorModule, nativeEventName: string) {\n    this._nativeModule = nativeSensorModule;\n    this._nativeEmitter = new EventEmitter(nativeSensorModule);\n    this._nativeEventName = nativeEventName;\n    this._listenerCount = 0;\n  }\n\n  addListener = (listener: Listener<M>): Subscription => {\n    const subscription = this._nativeEmitter.addListener(this._nativeEventName, listener);\n    subscription.remove = () => this.removeSubscription(subscription);\n    this._listenerCount++;\n    return subscription;\n  };\n\n  /**\n   * Returns boolean which signifies if sensor has any listeners registered.\n   */\n  hasListeners = (): boolean => {\n    return this._listenerCount > 0;\n  };\n\n  /**\n   * Returns the registered listeners count.\n   */\n  getListenerCount = (): number => {\n    return this._listenerCount;\n  };\n\n  /**\n   * Removes all registered listeners.\n   */\n  removeAllListeners = (): void => {\n    this._listenerCount = 0;\n    this._nativeEmitter.removeAllListeners(this._nativeEventName);\n  };\n\n  /**\n   * Removes the given subscription.\n   * @param subscription A subscription to remove.\n   */\n  removeSubscription = (subscription: Subscription): void => {\n    this._listenerCount--;\n    this._nativeEmitter.removeSubscription(subscription);\n  };\n\n  /**\n   * Set the sensor update interval.\n   * @param intervalMs Desired interval value in milliseconds.\n   */\n  setUpdateInterval = (intervalMs: number): void => {\n    if (!this._nativeModule.setUpdateInterval) {\n      console.warn(`expo-sensors: setUpdateInterval() is not supported on ${Platform.OS}`);\n    } else {\n      this._nativeModule.setUpdateInterval(intervalMs);\n    }\n  };\n\n  /**\n   * > **info** You should always check the sensor availability before attempting to use it.\n   * @return A promise that resolves to a `boolean` denoting the availability of the sensor.\n   */\n  isAvailableAsync = async (): Promise<boolean> => {\n    if (!this._nativeModule.isAvailableAsync) {\n      return false;\n    } else {\n      return await this._nativeModule.isAvailableAsync();\n    }\n  };\n\n  /**\n   * Checks user's permissions for accessing sensor.\n   */\n  getPermissionsAsync = async (): Promise<PermissionResponse> => {\n    if (!this._nativeModule.getPermissionsAsync) {\n      return defaultPermissionsResponse;\n    } else {\n      return await this._nativeModule.getPermissionsAsync();\n    }\n  };\n\n  /**\n   * Asks the user to grant permissions for accessing sensor.\n   */\n  requestPermissionsAsync = async (): Promise<PermissionResponse> => {\n    if (!this._nativeModule.requestPermissionsAsync) {\n      return defaultPermissionsResponse;\n    } else {\n      return await this._nativeModule.requestPermissionsAsync();\n    }\n  };\n}\n\nconst defaultPermissionsResponse: PermissionResponse = {\n  granted: true,\n  expires: 'never',\n  canAskAgain: true,\n  status: PermissionStatus.GRANTED,\n};\n\nexport { PermissionExpiration, PermissionResponse, PermissionStatus, Subscription };\n"]}