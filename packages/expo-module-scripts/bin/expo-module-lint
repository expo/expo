#!/usr/bin/env node
'use strict';

import process from 'node:process';
import fs from 'node:fs';

import { getExtraModuleBuildTypes } from './expo-module-utils.js';
import { expoModuleEslint } from './expo-module-eslint';

function expoModuleLint() {
  const args = [];

  const maybeBuildType = process.argv[1];

  if (getExtraModuleBuildTypes().includes(maybeBuildType)) {
    args = process.argv.slice(2);
    args.push(`${maybeBuildType}/src`);

    if (!fs.existsSync(maybeBuildType))  {
      console.log("\n\x1b[1;33mThe \`$found_target/src\` folder does not exist in this project; please create it and try again.\x1b[0m\n\n");
      process.exit(0)
    }
  } else {
    args = [...process.argv, 'src'];
  }

  expoModuleEslint(args);
}

if (import.meta.main) {
  expoModuleLint(process.argv);
}