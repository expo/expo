#!/usr/bin/env node
'use strict';

import { commandRunner } from "../util/commandUtils.js";
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

export const dirname = path.dirname(fileURLToPath(import.meta.url));

process.env.EXPO_NONINTERACTIVE = 1;

const run = async () => {
  console.log('expo-module-scripts: Configuring module');
  await commandRunner(path.join(dirname, 'expo-module-clean'));
  await commandRunner(path.join(dirname, 'expo-module-configure'));
  await commandRunner(path.join(dirname, 'expo-module-build'));

  if (fs.existsSync(path.join(process.cwd(), 'plugin'))) {
    console.log('expo-module-scripts: Configuring plugin');
    await commandRunner(path.join(dirname, 'expo-module-clean'), ['plugin']);
    await commandRunner(path.join(dirname, 'expo-module-build'), ['plugin']);
  }
}

run();
