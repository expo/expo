#!/usr/bin/env node
'use strict';

const childProcess = require('child_process');
const fs = require('fs');
const path = require('path');
const process = require('process');

const args = process.argv.slice(2);

// If the command is used like `yarn test plugin`, set the --rootDir option to the `plugin` directory
if (args[0] === 'plugin') {
  args.unshift();
  args.push('--rootDir', 'plugin');

  const jestPath = path.join(process.cwd(), 'plugin', 'jest.config.js');
  if (fs.existsSync(jestPath)) {
    args.push('--config', 'plugin/jest.config.js');
  }
}

// Run in watch mode when not running on CI or in not in non-interactive
if (!process.env.CI && !process.env.EXPO_NONINTERACTIVE && require.main === module.parent) {
  args.push('--watch');
}

childProcess.spawnSync(path.join(__dirname, 'expo-module-jest'), args, { stdio: 'inherit' });

/*
#!/usr/bin/env bash

set -eo pipefail

script_dir="$(dirname "$0")"

args=("$@")

# If the command is used like `yarn test plugin`, set the --rootDir option to the `plugin` directory
if [ "$1" == "plugin" ]; then
  args=()
  args+=("--rootDir")
  args+=("plugin")

  if [[ -f plugin/jest.config.js ]]; then
    args+=("--config")
    args+=("plugin/jest.config.js")
  fi

  # Push the rest of the arguments minus the `plugin` arg
  args+=("${@:2}")
fi

if [[ -t 1 && (-z "$CI" && -z "$EXPO_NONINTERACTIVE") ]]; then
  args+=("--watch")
fi

"$script_dir/expo-module-jest" "${args[@]}"
*/
