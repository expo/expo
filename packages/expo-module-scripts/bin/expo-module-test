#!/usr/bin/env node
'use strict';

import process from 'node:process';
import fs from 'node:fs';

function expoModuleTest(args) {
  const maybeBuildType = args[1];

  if (getExtraModuleBuildTypes().includes(maybeBuildType)) {
    const buildType = maybeBuildType;

    args = [];

    args.push('--rootDir');
    args.push(buildType);

    if (fs.existsSync(`${buildType}/jest.config.js`)) {
      args.push('--config')
      args.push(`${buildType}/jest.config.js`);
    } else {
      args.push('--config');
      args.push(require.resolve(`expo-module-scripts/jest-preset-${buildType}.js`))
    }

    args.push(...argv.slice(2));
  }

  if (isInterativeSession()) {
    args.push('--watch');
  }

  expoModuleJest(args);
}

if (import.meta.main) {
  expoModuleTest(process.argv);
}