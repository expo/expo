#!/usr/bin/env node
'use strict';

import { commandRunner, getArgs } from "../util/commandUtils.js";
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

export const dirname = path.dirname(fileURLToPath(import.meta.url));

let args = getArgs();

if (args[0] === 'plugin') {
  const pluginDir = path.join(process.cwd(), 'plugin');
  const configPath = path.join(pluginDir, 'jest.config.js');
  if (fs.existsSync(configPath)) {
    args = ['--rootDir', pluginDir, '--config', configPath, ...args.splice(1)]
  } else {
    args = ['--rootDir', pluginDir, ...args.splice(1)]
  }
}

if (
  process.stdout.isTTY &&
  !process.env.CI &&
  !process.env.EXPO_NONINTERACTIVE
) {
  args.push('--watch')
}

await commandRunner(path.join(process.cwd(), 'expo-module-jest'), args);
